"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2023,3564],{62023:(A,E,r)=>{var m,c;m=[r(74344),r(31369),r(7927),r(50431),r(59006),r(32230),r(62526)],c=function(i,p,u,b,S,t){const o={};return o.get=s=>i.get(`/topics/${s}/thumbs`,{}),o.getByPid=s=>i.get(`/posts/${s}`,{}).then(e=>o.get(e.tid)),o.delete=(s,e)=>i.del(`/topics/${s}/thumbs`,{path:e}),o.deleteAll=s=>{o.get(s).then(e=>{Promise.all(e.map(n=>o.delete(s,n.url)))})},o.upload=s=>new Promise(e=>{b.show({title:"[[topic:composer.thumb_title]]",method:"put",route:config.relative_path+`/api/v3/topics/${s}/thumbs`},function(n){e(n)})}),o.modal={},o.modal.open=function(s){const{id:e,pid:n}=s;let{modal:l}=s,d;return new Promise(f=>{Promise.all([o.get(e),n?o.getByPid(n):[]]).then(a=>new Promise(h=>{const g=a.reduce((P,C)=>P.concat(C));d=g.length,h(g)})).then(a=>S.render("modals/topic-thumbs",{thumbs:a})).then(a=>{l?t.translate(a,function(h){l.find(".bootbox-body").html(h),o.modal.handleSort({modal:l,numThumbs:d})}):(l=p.dialog({title:"[[modules:thumbs.modal.title]]",message:a,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(o.upload(e).then(()=>{o.modal.open({...s,modal:l}),Promise.all([r.e(4074),r.e(2143),r.e(5482),r.e(1521),r.e(6918)]).then(function(){var h=[r(44541)];(g=>{g.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`)),f()}).apply(null,h)}).catch(r.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),o.modal.handleDelete({...s,modal:l}),o.modal.handleSort({modal:l,numThumbs:d}))})})},o.modal.handleDelete=s=>{s.modal.get(0).addEventListener("click",n=>{n.target.closest('button[data-action="remove"]')&&p.confirm("[[modules:thumbs.modal.confirm-remove]]",l=>{if(!l)return;const d=n.target.closest(".media[data-id]").getAttribute("data-id"),f=n.target.closest(".media[data-path]").getAttribute("data-path");i.del(`/topics/${d}/thumbs`,{path:f}).then(()=>{o.modal.open(s)}).catch(u.error)})})},o.modal.handleSort=({modal:s,numThumbs:e})=>{if(e>1){const n=s.find(".topic-thumbs-modal");n.sortable({items:"[data-id]"}),n.on("sortupdate",o.modal.handleSortChange)}},o.modal.handleSortChange=(s,e)=>{const n=e.item.get(0).parentNode.querySelectorAll("[data-id]");Array.from(n).forEach((l,d)=>{const f=l.getAttribute("data-id");let a=l.getAttribute("data-path");a=a.replace(new RegExp(`^${config.upload_url}`),""),i.put(`/topics/${f}/thumbs/order`,{path:a,order:d}).catch(u.error)})},o}.apply(E,m),c!==void 0&&(A.exports=c)},50431:(A,E,r)=>{var m,c;m=[r(86569)],c=function(){const i={};i.show=function(t,o){const s=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:s,title:t.title||"[[global:upload_file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const n=e.find("#uploadForm");n.attr("action",t.route),n.find("#params").val(JSON.stringify(t.params)),e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),n.submit()}),n.submit(function(){return p(e,s,o),!1})})},i.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function p(t,o,s){u(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const e=t.find("#fileInput");if(!e.val())return u(t,"error","[[uploads:select-file-to-upload]]");if(!S(e[0],o))return u(t,"error","[[error:file-too-big, "+o+"]]");i.ajaxSubmit(t,s)}function u(t,o,s){i.hideAlerts(t),o==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),t.find("#alert-"+o).translateText(s).removeClass("hide")}i.ajaxSubmit=function(t,o){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=b(e),u(t,"error",e.responseJSON?e.responseJSON.error||e.statusText:"error uploading, code : "+e.status)},uploadProgress:function(e,n,l,d){t.find("#upload-progress-bar").css("width",d+"%")},success:function(e){let n=b(e);e.hasOwnProperty("response")&&e.hasOwnProperty("status")&&e.status.code==="ok"&&(n=e.response.images),o(n[0].url),u(t,"success","[[uploads:upload-success]]"),setTimeout(function(){i.hideAlerts(t),t.modal("hide")},750)}})};function b(t){if(typeof t=="string")try{return $.parseJSON(t)}catch{return{error:"[[error:parse-error]]"}}return t}function S(t,o){return window.FileReader&&o?t.files[0].size<=o*1e3:!0}return i}.apply(E,m),c!==void 0&&(A.exports=c)}}]);
