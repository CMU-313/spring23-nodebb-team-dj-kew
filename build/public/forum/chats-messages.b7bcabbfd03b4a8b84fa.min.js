"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[565,7214,9617,6503,6028,3014,8786,5655,8306,831,6862],{46862:(k,v,m)=>{var h,f;h=[m(7237),m(32230),m(59006),m(85233),m(31369),m(7927),m(44882),m(74344)],f=function(t,s,a,c,u,r,g,_){const e={};e.sendMessage=async function(n,o){let d=o.val(),y=o.attr("data-mid");if(!d.trim().length)return;o.val(""),o.removeAttr("data-mid"),e.updateRemainingLength(o.parent());const A={roomId:n,message:d,mid:y};c.fire("action:chat.sent",A),{roomId:n,message:d,mid:y}=await c.fire("filter:chat.send",A),y?_.put(`/chats/${n}/messages/${y}`,{message:d}).catch(I=>(o.val(d),o.attr("data-mid",y),e.updateRemainingLength(o.parent()),r.error(I))):_.post(`/chats/${n}`,{message:d}).catch(I=>(o.val(d),e.updateRemainingLength(o.parent()),I.message==="[[error:email-not-confirmed-chat]]"?g.showEmailConfirmWarning(I.message):r.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:I.message,type:"danger",timeout:1e4})))},e.updateRemainingLength=function(n){const o=n.find('[component="chat/input"]');n.find('[component="chat/message/length"]').text(o.val().length),n.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-o.val().length),c.fire("action:chat.updateRemainingLength",{parent:n})},e.appendChatMessage=function(n,o){const d=parseInt(n.find(".chat-message").last().attr("data-uid"),10),y=parseInt(n.find(".chat-message").last().attr("data-timestamp"),10);Array.isArray(o)||(o.newSet=d!==parseInt(o.fromuid,10)||parseInt(o.timestamp,10)>parseInt(y,10)+1e3*60*3),e.parseMessage(o,function(A){l(n,A)})};function l(n,o){const d=$(o),y=e.isAtBottom(n);d.appendTo(n),d.find(".timeago").timeago(),d.find("img:not(.not-responsive)").addClass("img-responsive"),y&&e.scrollToBottom(n),c.fire("action:chat.received",{messageEl:d})}e.parseMessage=function(n,o){function d(y){s.translate(y,o)}Array.isArray(n)?a.render("partials/chats/message"+(Array.isArray(n)?"s":""),{messages:n}).then(d):a.render("partials/chats/"+(n.system?"system-message":"message"),{messages:n}).then(d)},e.isAtBottom=function(n,o){if(n.length)return n[0].scrollHeight-(n.outerHeight()+n.scrollTop())<(o||100)},e.scrollToBottom=function(n){n&&n.length&&(n.scrollTop(n[0].scrollHeight-n.height()),n.parent().find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},e.toggleScrollUpAlert=function(n){const o=e.isAtBottom(n,300);n.parent().find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",o)},e.prepEdit=function(n,o,d){socket.emit("modules.chats.getRaw",{mid:o,roomId:d},function(y,A){if(y)return r.error(y);n.val().length===0&&(n.attr("data-mid",o).addClass("editing"),n.val(A).focus(),c.fire("action:chat.prepEdit",{inputEl:n,messageId:o,roomId:d}))})},e.addSocketListeners=function(){socket.removeListener("event:chats.edit",i),socket.on("event:chats.edit",i),socket.removeListener("event:chats.delete",p),socket.on("event:chats.delete",p),socket.removeListener("event:chats.restore",S),socket.on("event:chats.restore",S)};function i(n){n.messages.forEach(function(o){const d=parseInt(o.fromuid,10)===parseInt(app.user.uid,10);o.self=d?1:0,e.parseMessage(o,function(y){const A=t.get("chat/message",o.messageId);A.length&&(A.replaceWith(y),t.get("chat/message",o.messageId).find(".timeago").timeago())})})}function p(n){t.get("chat/message",n).toggleClass("deleted",!0).find('[component="chat/message/body"]').translateHtml("[[modules:chat.message-deleted]]")}function S(n){t.get("chat/message",n.messageId).toggleClass("deleted",!1).find('[component="chat/message/body"]').html(n.content)}return e.delete=function(n,o){s.translate("[[modules:chat.delete_message_confirm]]",function(d){u.confirm(d,function(y){y&&_.delete(`/chats/${o}/messages/${n}`,{}).then(()=>{t.get("chat/message",n).toggleClass("deleted",!0)}).catch(r.error)})})},e.restore=function(n,o){_.post(`/chats/${o}/messages/${n}`,{}).then(()=>{t.get("chat/message",n).toggleClass("deleted",!1)}).catch(r.error)},e}.apply(v,h),f!==void 0&&(k.exports=f)},7927:(k,v,m)=>{var h,f;h=[m(32230),m(7237),m(85233)],f=function(t,s,a){const c={};c.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:new Date().getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const l=$("#"+e.alert_id);l.length?r(l,e):u(e)},c.success=function(e,l){c.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:l||5e3})},c.error=function(e,l){if(e=e&&e.message||e,e==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}c.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:l||1e4})},c.remove=function(e){$("#alert_button_"+e).remove()};function u(e){app.parseAndTranslate("alert",e,function(l){let i=$("#"+e.alert_id);if(i.length)return r(i,e);i=l,i.fadeIn(200),s.get("toaster/tray").prepend(i),typeof e.closefn=="function"&&i.find("button").on("click",function(){return e.closefn(),g(i),!1}),e.timeout&&_(i,e),typeof e.clickfn=="function"&&i.addClass("pointer").on("click",function(p){$(p.target).is(".close")||e.clickfn(i,e),g(i)}),a.fire("action:alert.new",{alert:i,params:e})})}function r(e,l){e.find("strong").translateHtml(l.title),e.find("p").translateHtml(l.message),e.attr("class","alert alert-dismissable alert-"+l.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),l.timeout&&_(e,l),a.fire("action:alert.update",{alert:e,params:l}),e.off("click").removeClass("pointer"),typeof l.clickfn=="function"&&e.addClass("pointer").on("click",function(i){$(i.target).is(".close")||l.clickfn(),g(e)})}function g(e){e.fadeOut(500,function(){$(this).remove()})}function _(e,l){const i=l.timeout,p=setTimeout(function(){g(e),typeof l.timeoutfn=="function"&&l.timeoutfn(e,l)},i);e.attr("timeoutId",p),e.css("transition-property","none"),e.removeClass("animate"),setTimeout(function(){e.css("transition-property",""),e.css("transition","width "+(i+450)+"ms linear, background-color "+(i+450)+"ms ease-in"),e.addClass("animate"),a.fire("action:alert.animate",{alert:e,params:l})},50),e.on("mouseenter",function(){$(this).css("transition-duration",0)})}return c}.apply(v,h),f!==void 0&&(k.exports=f)},74344:(k,v,m)=>{var h,f;h=[m(85233)],f=(t=>{const s={},a=config.relative_path+"/api/v3";function c(u,r){u.url=u.url.startsWith("/api")?config.relative_path+u.url:a+u.url;async function g(_){({options:u}=await t.fire("filter:api.options",{options:u})),$.ajax(u).done(e=>{_(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let l;e.responseJSON&&(l=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),_(new Error(l||e.statusText))})}if(typeof r=="function"){g(r);return}return new Promise((_,e)=>{g(function(l,i){l?e(l):_(i)})})}return s.get=(u,r,g)=>c({url:u+(r&&Object.keys(r).length?"?"+$.param(r):"")},g),s.head=(u,r,g)=>c({url:u+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"head"},g),s.post=(u,r,g)=>c({url:u,method:"post",data:JSON.stringify(r||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),s.patch=(u,r,g)=>c({url:u,method:"patch",data:JSON.stringify(r||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),s.put=(u,r,g)=>c({url:u,method:"put",data:JSON.stringify(r||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),s.del=(u,r,g)=>c({url:u,method:"delete",data:JSON.stringify(r),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},g),s.delete=s.del,s}).apply(v,h),f!==void 0&&(k.exports=f)},7237:(k,v,m)=>{var h;h=function(){const f={};return f.core={"topic/teaser":function(t){return t?$('[component="category/topic"][data-tid="'+t+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(t,s){return $('[component="topic"][data-'+t+'="'+s+'"]')},post:function(t,s){return $('[component="post"][data-'+t+'="'+s+'"]')},"post/content":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/content"]')},"post/header":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/header"]')},"post/anchor":function(t){return $('[component="post"][data-index="'+t+'"] [component="post/anchor"]')},"post/vote-count":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/vote-count"]')},"post/bookmark-count":function(t){return $('[component="post"][data-pid="'+t+'"] [component="post/bookmark-count"]')},"user/postcount":function(t){return $('[component="user/postcount"][data-uid="'+t+'"]')},"user/reputation":function(t){return $('[component="user/reputation"][data-uid="'+t+'"]')},"category/topic":function(t,s){return $('[component="category/topic"][data-'+t+'="'+s+'"]')},"categories/category":function(t,s){return $('[component="categories/category"][data-'+t+'="'+s+'"]')},"chat/message":function(t){return $('[component="chat/message"][data-mid="'+t+'"]')},"chat/message/body":function(t){return $('[component="chat/message"][data-mid="'+t+'"] [component="chat/message/body"]')},"chat/recent/room":function(t){return $('[component="chat/recent/room"][data-roomid="'+t+'"]')}},f.get=function(){const t=Array.prototype.slice.call(arguments,1);return f.core[arguments[0]]&&t.length?f.core[arguments[0]].apply(this,t):$('[component="'+arguments[0]+'"]')},f}.call(v,m,v,k),h!==void 0&&(k.exports=h)},44882:(k,v,m)=>{var h,f;h=[m(31369),m(32230),m(66603),m(7927),m(85233)],f=function(t,s,a,c,u){const r={};let g,_;r.show=function(){u.one("action:ajaxify.end",()=>{l(),e(),r.showEmailConfirmWarning()})},r.showEmailConfirmWarning=function(i){if(!config.emailPrompt||!app.user.uid||parseInt(a.getItem("email-confirm-dismiss"),10)===1)return;const p={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{a.setItem("email-confirm-dismiss",1)}};app.user.email?!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(p.message=i||"[[error:email-not-confirmed]]",p.clickfn=function(){c.remove("email_confirm"),ajaxify.go("/me/edit/email")},c.alert(p)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(p.message="[[error:email-not-confirmed-email-sent]]",c.alert(p)):(p.message="[[error:no-email-to-confirm]]",p.clickfn=function(){c.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},c.alert(p))};function e(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||a.getItem("cookieconsent")==="1"||(config.cookies.message=s.unescape(config.cookies.message),config.cookies.dismiss=s.unescape(config.cookies.dismiss),config.cookies.link=s.unescape(config.cookies.link),config.cookies.link_url=s.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(i){$(document.body).append(i),$(document.body).addClass("cookie-consent-open");const p=$(".cookie-consent");p.find("button").on("click",function(){a.setItem("cookieconsent","1"),p.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function l(){const i=utils.params({full:!0});g=i.has("loggedin"),_=i.get("register"),g&&(c.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),i.delete("loggedin")),_&&(t.alert({message:utils.escapeHTML(decodeURIComponent(_))}),i.delete("register")),i.has("lang")&&i.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${i.get("lang")}", but that is already the forum default language.`),i.delete("lang"));const p=i.toString();ajaxify.updateHistory(ajaxify.currentPage+(p?`?${p}`:"")+document.location.hash,!0)}return r.showInvalidSession=function(){t.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},r.showSessionMismatch=function(){t.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},r}.apply(v,h),f!==void 0&&(k.exports=f)},66603:(k,v,m)=>{var h;h=function(){function f(){this._store={},this._keys=[]}f.prototype.isMock=!0,f.prototype.setItem=function(a,c){a=String(a),this._keys.indexOf(a)===-1&&this._keys.push(a),this._store[a]=c},f.prototype.getItem=function(a){return a=String(a),this._keys.indexOf(a)===-1?null:this._store[a]},f.prototype.removeItem=function(a){a=String(a),this._keys=this._keys.filter(function(c){return c!==a}),this._store[a]=null},f.prototype.clear=function(){this._keys=[],this._store={}},f.prototype.key=function(a){return a=parseInt(a,10)||0,this._keys[a]},Object.defineProperty&&Object.defineProperty(f.prototype,"length",{get:function(){return this._keys.length}});let t;const s=Date.now().toString();try{if(t=window.localStorage,t.setItem(s,s),t.getItem(s)!==s)throw Error("localStorage behaved unexpectedly");return t.removeItem(s),t}catch(a){console.warn(a),console.warn("localStorage failed, falling back on sessionStorage");try{if(t=window.sessionStorage,t.setItem(s,s),t.getItem(s)!==s)throw Error("sessionStorage behaved unexpectedly");return t.removeItem(s),t}catch(c){return console.warn(c),console.warn("sessionStorage failed, falling back on memory storage"),new f}}}.call(v,m,v,k),h!==void 0&&(k.exports=h)}}]);
