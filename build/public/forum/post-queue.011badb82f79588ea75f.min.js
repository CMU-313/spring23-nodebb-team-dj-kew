"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[5517,7214,9617,6503,3014,2256,6623,9286,8786,5655,831],{2525:(y,C,p)=>{var g,d;g=[p(39941),p(50548),p(74344),p(7927),p(31369)],d=function(s,f,m,r,c){const a={};a.init=function(){$('[data-toggle="tooltip"]').tooltip(),s.init($('[component="category/dropdown"]'),{privilege:"moderate"}),t(),$(".posts-list").on("click","[data-action]",async function(){function e(){return new Promise(_=>{const E=c.dialog({title:"[[post-queue:notify-user]]",message:'<textarea class="form-control"></textarea>',buttons:{OK:{label:"[[modules:bootbox.send]]",callback:function(){const A=E.find("textarea").val();A&&_(A)}}}})})}const o=$(this).parents("[data-id]"),l=$(this).attr("data-action"),u=o.attr("data-id"),h=o.get(0).parentNode;if(!(!["accept","reject","notify"].includes(l)||l==="reject"&&!await n("[[post-queue:confirm-reject]]")))return socket.emit("posts."+l,{id:u,message:l==="notify"?await e():void 0},function(_){if(_)return r.error(_);(l==="accept"||l==="reject")&&o.remove(),h.childElementCount===0&&(ajaxify.data.singlePost?ajaxify.go("/post-queue"+window.location.search):ajaxify.refresh())}),!1}),i(".post-content",".post-content-editable","textarea"),i(".topic-title",".topic-title-editable","input"),$(".posts-list").on("click",".topic-category[data-editable]",function(){const e=$(this),o=e.parents("[data-id]").attr("data-id");return f.modal({onSubmit:function(l){Promise.all([m.get(`/categories/${l.cid}`,{}),socket.emit("posts.editQueuedContent",{id:o,cid:l.cid})]).then(function(u){const h=u[0];app.parseAndTranslate("post-queue","posts",{posts:[{category:h}]},function(_){e.find(".category-text").length?e.find(".category-text").text(_.find(".topic-category .category-text").text()):e.replaceWith(_.find(".topic-category"))})}).catch(r.error)}}),!1}),$('[component="post/content"] img:not(.not-responsive)').addClass("img-responsive")};function n(e){return new Promise(o=>{c.confirm(e,o)})}function i(e,o,l){$(".posts-list").on("click",e,function(){const u=$(this),h=u.parent().find(o);h.length&&(u.addClass("hidden"),h.removeClass("hidden").find(l).focus())}),$(".posts-list").on("blur",o+" "+l,function(){const u=$(this),h=u.parent().parent().find(e),_=u.parents("[data-id]").attr("data-id"),E=e===".topic-title";socket.emit("posts.editQueuedContent",{id:_,title:E?u.val():void 0,content:E?void 0:u.val()},function(A,b){if(A)return r.error(A);E?h.find(".title-text").length?h.find(".title-text").text(b.postData.title):h.html(b.postData.title):h.html(b.postData.content),u.parent().addClass("hidden"),h.removeClass("hidden")})})}function t(){$('[component="post-queue/bulk-actions"]').on("click","[data-action]",async function(){const e=$(this).attr("data-action");let o=$(".posts-list [data-id]");(e==="accept-selected"||e==="reject-selected")&&(o=o.filter((E,A)=>$(A).find('input[type="checkbox"]').is(":checked")));const l=o.map((E,A)=>$(A).attr("data-id")).get(),u=e==="reject-all"||e==="reject-selected";if(!l.length||u&&!await n(`[[post-queue:${e}-confirm, ${l.length}]]`))return;const h=e.split("-")[0],_=l.map(E=>socket.emit("posts."+h,{id:E}));Promise.allSettled(_).then(function(E){const A=E.filter(k=>k.status==="fulfilled").length,b=E.filter(k=>k.status==="rejected");A&&(r.success(`[[post-queue:bulk-${h}-success, ${A}]]`),ajaxify.refresh()),b.forEach(k=>r.error(k.reason))})})}return a}.apply(C,g),d!==void 0&&(y.exports=d)},7927:(y,C,p)=>{var g,d;g=[p(32230),p(7237),p(85233)],d=function(s,f,m){const r={};r.alert=function(t){t.alert_id="alert_button_"+(t.alert_id?t.alert_id:new Date().getTime()),t.title=t.title&&t.title.trim()||"",t.message=t.message?t.message.trim():"",t.type=t.type||"info";const e=$("#"+t.alert_id);e.length?a(e,t):c(t)},r.success=function(t,e){r.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:t,type:"success",timeout:e||5e3})},r.error=function(t,e){if(t=t&&t.message||t,t==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}r.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:t,type:"danger",timeout:e||1e4})},r.remove=function(t){$("#alert_button_"+t).remove()};function c(t){app.parseAndTranslate("alert",t,function(e){let o=$("#"+t.alert_id);if(o.length)return a(o,t);o=e,o.fadeIn(200),f.get("toaster/tray").prepend(o),typeof t.closefn=="function"&&o.find("button").on("click",function(){return t.closefn(),n(o),!1}),t.timeout&&i(o,t),typeof t.clickfn=="function"&&o.addClass("pointer").on("click",function(l){$(l.target).is(".close")||t.clickfn(o,t),n(o)}),m.fire("action:alert.new",{alert:o,params:t})})}function a(t,e){t.find("strong").translateHtml(e.title),t.find("p").translateHtml(e.message),t.attr("class","alert alert-dismissable alert-"+e.type+" clearfix"),clearTimeout(parseInt(t.attr("timeoutId"),10)),e.timeout&&i(t,e),m.fire("action:alert.update",{alert:t,params:e}),t.off("click").removeClass("pointer"),typeof e.clickfn=="function"&&t.addClass("pointer").on("click",function(o){$(o.target).is(".close")||e.clickfn(),n(t)})}function n(t){t.fadeOut(500,function(){$(this).remove()})}function i(t,e){const o=e.timeout,l=setTimeout(function(){n(t),typeof e.timeoutfn=="function"&&e.timeoutfn(t,e)},o);t.attr("timeoutId",l),t.css("transition-property","none"),t.removeClass("animate"),setTimeout(function(){t.css("transition-property",""),t.css("transition","width "+(o+450)+"ms linear, background-color "+(o+450)+"ms ease-in"),t.addClass("animate"),m.fire("action:alert.animate",{alert:t,params:e})},50),t.on("mouseenter",function(){$(this).css("transition-duration",0)})}return r}.apply(C,g),d!==void 0&&(y.exports=d)},74344:(y,C,p)=>{var g,d;g=[p(85233)],d=(s=>{const f={},m=config.relative_path+"/api/v3";function r(c,a){c.url=c.url.startsWith("/api")?config.relative_path+c.url:m+c.url;async function n(i){({options:c}=await s.fire("filter:api.options",{options:c})),$.ajax(c).done(t=>{i(null,t&&t.hasOwnProperty("status")&&t.hasOwnProperty("response")?t.response:t||{})}).fail(t=>{let e;t.responseJSON&&(e=t.responseJSON.status&&t.responseJSON.status.message?t.responseJSON.status.message:t.responseJSON.error),i(new Error(e||t.statusText))})}if(typeof a=="function"){n(a);return}return new Promise((i,t)=>{n(function(e,o){e?t(e):i(o)})})}return f.get=(c,a,n)=>r({url:c+(a&&Object.keys(a).length?"?"+$.param(a):"")},n),f.head=(c,a,n)=>r({url:c+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},n),f.post=(c,a,n)=>r({url:c,method:"post",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),f.patch=(c,a,n)=>r({url:c,method:"patch",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),f.put=(c,a,n)=>r({url:c,method:"put",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),f.del=(c,a,n)=>r({url:c,method:"delete",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),f.delete=f.del,f}).apply(C,g),d!==void 0&&(y.exports=d)},39941:(y,C,p)=>{var g,d;g=[p(22905),p(74344),p(85233)],d=function(s,f,m){const r={};r.init=function(a,n){if(!a||!a.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template="partials/category-filter",m.fire("action:category.filter.options",{el:a,options:n}),s.init(a,n);let i=[],t=[];Array.isArray(n.selectedCids)?i=n.selectedCids.map(e=>parseInt(e,10)):Array.isArray(ajaxify.data.selectedCids)&&(i=ajaxify.data.selectedCids.map(e=>parseInt(e,10))),t=i.slice(),a.on("hidden.bs.dropdown",function(){let e=t.length!==i.length;if(t.forEach(function(o,l){o!==i[l]&&(e=!0)}),e&&c(a,i),n.onHidden){n.onHidden({changed:e,selectedCids:i.slice()});return}if(e){let o=window.location.pathname;const l=utils.params();i.length&&(l.cid=i,o+="?"+decodeURIComponent($.param(l))),ajaxify.go(o)}}),a.on("click",'[component="category/list"] [data-cid]',function(){const e=a.find('[component="category/list"]'),o=$(this),l=o.find("a").attr("href");if(l&&l!=="#"&&l.length)return;const u=parseInt(o.attr("data-cid"),10),h=o.find('[component="category/select/icon"]');return i.includes(u)?i.splice(i.indexOf(u),1):i.push(u),i.sort(function(_,E){return _-E}),n.selectedCids=i,h.toggleClass("invisible"),e.find('li[data-all="all"] i').toggleClass("invisible",!!i.length),n.onSelect&&n.onSelect({cid:u,selectedCids:i.slice()}),!1})};function c(a,n){n.length>1?i({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?f.get(`/categories/${n[0]}`,{}).then(i):i();function i(t){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:t},function(e){a.find("button").replaceWith($("<div/>").html(e).find("button"))})}}return r}.apply(C,g),d!==void 0&&(y.exports=d)},22905:(y,C,p)=>{var g,d;g=[p(7927)],d=function(s){const f={};return f.init=function(m,r){let c=null;r=r||{},r.privilege=r.privilege||"topics:read",r.states=r.states||["watching","notwatching","ignoring"];let a=[];Array.isArray(r.localCategories)&&(a=r.localCategories.map(o=>({...o}))),r.selectedCids=r.selectedCids||ajaxify.data.selectedCids||[];const n=m.find('[component="category-selector-search"]');if(!n.length)return;const i=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;m.on("show.bs.dropdown",function(){i&&(m.find(".dropdown-toggle").addClass("hidden"),n.removeClass("hidden"));function o(){const l=n.find("input").val();l.length>1||!l&&!c?t(l,function(u){c=c||u,e(u)}):!l&&c&&(c.forEach(function(u){u.selected=r.selectedCids.includes(u.cid)}),e(c))}n.on("click",function(l){l.preventDefault(),l.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(o,300)),o()}),m.on("shown.bs.dropdown",function(){n.find("input").focus()}),m.on("hide.bs.dropdown",function(){i&&(m.find(".dropdown-toggle").removeClass("hidden"),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function t(o,l){socket.emit("categories.categorySearch",{search:o,query:utils.params(),parentCid:r.parentCid||0,selectedCids:r.selectedCids,privilege:r.privilege,states:r.states,showLinks:r.showLinks},function(u,h){if(u)return s.error(u);l(a.concat(h))})}function e(o){app.parseAndTranslate(r.template,{categoryItems:o.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(l){m.find('[component="category/list"]').replaceWith(l.find('[component="category/list"]')),m.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!o.length)})}},f}.apply(C,g),d!==void 0&&(y.exports=d)},50548:(y,C,p)=>{var g,d;g=[p(22905),p(31369),p(85233)],d=function(s,f,m){const r={};return r.init=function(c,a){if(!c||!c.length)return;a=a||{};const n=a.onSelect||function(){};a.states=a.states||["watching","notwatching","ignoring"],a.template="partials/category-selector",m.fire("action:category.selector.options",{el:c,options:a}),s.init(c,a);const i={el:c,selectedCategory:null};c.on("click","[data-cid]",function(){const e=$(this);if(e.hasClass("disabled"))return!1;i.selectCategory(e.attr("data-cid")),n(i.selectedCategory)});const t=i.el.find('[component="category-selector-selected"]').html();return i.selectCategory=function(e){const o=i.el.find('[data-cid="'+e+'"]');i.selectedCategory={cid:e,name:o.attr("data-name")},o.length?i.el.find('[component="category-selector-selected"]').html(o.find('[component="category-markup"]').html()):i.el.find('[component="category-selector-selected"]').html(t)},i.getSelectedCategory=function(){return i.selectedCategory},i.getSelectedCid=function(){return i.selectedCategory?i.selectedCategory.cid:0},i},r.modal=function(c){c=c||{},c.onSelect=c.onSelect||function(){},c.onSubmit=c.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:c.message},function(a){const n=f.dialog({title:c.title||"[[modules:composer.select_category]]",message:a,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:t}}}),i=r.init(n.find('[component="category-selector"]'),c);function t(e){return e.preventDefault(),i.selectedCategory&&(c.onSubmit(i.selectedCategory),n.modal("hide")),!1}c.openOnLoad&&n.on("shown.bs.modal",function(){n.find(".dropdown-toggle").dropdown("toggle")}),n.find("form").on("submit",t)})},r}.apply(C,g),d!==void 0&&(y.exports=d)},7237:(y,C,p)=>{var g;g=function(){const d={};return d.core={"topic/teaser":function(s){return s?$('[component="category/topic"][data-tid="'+s+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(s,f){return $('[component="topic"][data-'+s+'="'+f+'"]')},post:function(s,f){return $('[component="post"][data-'+s+'="'+f+'"]')},"post/content":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/content"]')},"post/header":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/header"]')},"post/anchor":function(s){return $('[component="post"][data-index="'+s+'"] [component="post/anchor"]')},"post/vote-count":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/vote-count"]')},"post/bookmark-count":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/bookmark-count"]')},"user/postcount":function(s){return $('[component="user/postcount"][data-uid="'+s+'"]')},"user/reputation":function(s){return $('[component="user/reputation"][data-uid="'+s+'"]')},"category/topic":function(s,f){return $('[component="category/topic"][data-'+s+'="'+f+'"]')},"categories/category":function(s,f){return $('[component="categories/category"][data-'+s+'="'+f+'"]')},"chat/message":function(s){return $('[component="chat/message"][data-mid="'+s+'"]')},"chat/message/body":function(s){return $('[component="chat/message"][data-mid="'+s+'"] [component="chat/message/body"]')},"chat/recent/room":function(s){return $('[component="chat/recent/room"][data-roomid="'+s+'"]')}},d.get=function(){const s=Array.prototype.slice.call(arguments,1);return d.core[arguments[0]]&&s.length?d.core[arguments[0]].apply(this,s):$('[component="'+arguments[0]+'"]')},d}.call(C,p,C,y),g!==void 0&&(y.exports=g)}}]);
