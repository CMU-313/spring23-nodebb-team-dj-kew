(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[2545,7214,9617,6503,1762,3014,6623,9286,8529,8042,8786,2550,5655,999,831],{22626:(C,E,f)=>{"use strict";var b,m;b=[f(24987),f(18487),f(7237),f(38565),f(98192),f(32230),f(74344),f(22568),f(50548),f(31369),f(7927)],m=function(u,s,d,n,o,e,r,c,t,i,a){const l={};let g;l.init=function(){const h=d.get("groups/container");g=ajaxify.data.group.name,ajaxify.data.group.isOwner&&(l.prepareSettings(),n.init(d.get("groups/cover"),function(y,v,D){socket.emit("groups.cover.update",{groupName:g,imageData:y,position:v},D)},function(){o.show({title:"[[groups:upload-group-cover]]",socketMethod:"groups.cover.update",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"groupName",paramValue:g},function(y){y=(y.startsWith("http")?"":config.relative_path)+y+"?"+Date.now(),d.get("groups/cover").css("background-image","url("+y+")")})},A)),u.init(),p(),d.get("groups/activity").find(".content img:not(.not-responsive)").addClass("img-responsive"),h.on("click","[data-action]",function(){const y=$(this),v=y.parents("[data-uid]"),D=v.find(".member-name > i"),x=!D.hasClass("invisible"),k=v.attr("data-uid"),I=y.attr("data-action");switch(I){case"toggleOwnership":r[x?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${k}`,{}).then(()=>{D.toggleClass("invisible")}).catch(a.error);break;case"kick":e.translate("[[groups:details.kick_confirm]]",function(w){i.confirm(w,function(T){T&&r.del(`/groups/${ajaxify.data.group.slug}/membership/${k}`,void 0).then(()=>v.slideUp().remove()).catch(a.error)})});break;case"update":l.update();break;case"delete":l.deleteGroup();break;case"join":r.put("/groups/"+ajaxify.data.group.slug+"/membership/"+(k||app.user.uid),void 0).then(()=>ajaxify.refresh()).catch(a.error);break;case"leave":r.del("/groups/"+ajaxify.data.group.slug+"/membership/"+(k||app.user.uid),void 0).then(()=>ajaxify.refresh()).catch(a.error);break;case"accept":case"reject":case"issueInvite":case"rescindInvite":case"acceptInvite":case"rejectInvite":case"acceptAll":case"rejectAll":socket.emit("groups."+I,{toUid:k,groupName:g},function(w){w?a.error(w):ajaxify.refresh()});break}})},l.prepareSettings=function(){const h=d.get("groups/settings"),y=h.find('[name="labelColor"]'),v=h.find('[name="textColor"]'),D=h.find('[data-action="icon-select"]'),x=h.find(".label"),k=h.find(".label-text"),I=x.find("i"),w=h.find('[name="userTitle"]'),T=h.find('[name="userTitleEnabled"]'),_=h.find('[name="icon"]');y.on("input",function(){x.css("background-color",y.val())}),v.on("input",function(){x.css("color",v.val())}),D.on("click",function(){s.init(I,function(){_.val(I.val())})}),w.on("keyup",function(){k.translateText(this.value||h.find("#name").val())}),T.on("change",function(){const S=d.get("groups/userTitleOption");this.checked?(S.removeAttr("disabled"),x.removeClass("hide")):(S.attr("disabled","disabled"),x.addClass("hide"))});const P=t.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(S){let R=($("#memberPostCids").val()||"").split(",").map(N=>parseInt(N,10));R.push(S.cid),R=R.filter((N,j,B)=>B.indexOf(N)===j),$("#memberPostCids").val(R.join(",")),P.selectCategory(0)}})},l.update=function(){const h=d.get("groups/settings"),y=h.find('input[type="checkbox"][name]');if(h.length){const v=h.serializeObject();Array.isArray(v.memberPostCids)||(v.memberPostCids=$("#memberPostCids").val()),y.each(function(D,x){x=$(x),x.length&&(v[x.attr("name")]=x.prop("checked"))}),r.put(`/groups/${ajaxify.data.group.slug}`,v).then(()=>{if(v.name){let D=window.location.pathname;D=D.slice(1,D.lastIndexOf("/")+1),ajaxify.go(D+c(v.name))}else ajaxify.refresh();a.success("[[groups:event.updated]]")}).catch(a.error)}},l.deleteGroup=function(){i.confirm("Are you sure you want to delete the group: "+utils.escapeHTML(g),function(h){h&&i.prompt("Please enter the name of this group in order to delete it:",function(y){y===g&&r.del(`/groups/${ajaxify.data.group.slug}`,{}).then(()=>{a.success("[[groups:event.deleted, "+utils.escapeHTML(g)+"]]"),ajaxify.go("groups")}).catch(a.error)})})};function p(){if(!ajaxify.data.group.isOwner)return;const h=$('[component="groups/members/invite"]');f.e(6193).then(function(){var y=[f(86193)];(function(v){v.user(h,function(D,x){socket.emit("groups.issueInvite",{toUid:x.item.user.uid,groupName:ajaxify.data.group.name},function(k){if(k)return a.error(k);ajaxify.refresh()})})}).apply(null,y)}).catch(f.oe),$('[component="groups/members/bulk-invite-button"]').on("click",function(){const y=$('[component="groups/members/bulk-invite"]').val();return y&&socket.emit("groups.issueMassInvite",{usernames:y,groupName:ajaxify.data.group.name},function(v){if(v)return a.error(v);ajaxify.refresh()}),!1})}function A(){e.translate("[[groups:remove_group_cover_confirm]]",function(h){i.confirm(h,function(y){y&&socket.emit("groups.cover.remove",{groupName:ajaxify.data.group.name},function(v){v?a.error(v):ajaxify.refresh()})})})}return l}.apply(E,b),m!==void 0&&(C.exports=m)},24987:(C,E,f)=>{"use strict";var b,m;b=[f(74344),f(31369),f(7927)],m=function(u,s,d){const n={};let o,e;n.init=function(p){e=p||"groups/details",o=ajaxify.data.group.name,r(),t(),i()};function r(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(p){const A=[],h=s.dialog({title:"[[groups:details.add-member]]",message:p,buttons:{ok:{callback:function(){const y=[];h.find("[data-uid][data-selected]").each(function(v,D){y.push(A[$(D).attr("data-uid")])}),c(y,function(){h.modal("hide")})}}}});h.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),h.find("input").on("keyup",function(){u.get("/api/users",{query:$(this).val(),paginate:!1},function(y,v){if(y)return d.error(y);v.users.forEach(function(D){A[D.uid]=D}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:v.users},function(D){h.find("#search-result").html(D)})})})})})}function c(p,A){function h(){p=p.filter(function(v){return!$('[component="groups/members"] [data-uid="'+v.uid+'"]').length}),g(p,function(v){$('[component="groups/members"] tbody').prepend(v)}),A()}const y=p.map(function(v){return v.uid});o==="administrators"?socket.emit("admin.user.makeAdmins",y,function(v){if(v)return d.error(v);h()}):Promise.all(y.map(v=>u.put("/groups/"+ajaxify.data.group.slug+"/membership/"+v))).then(h).catch(d.error)}function t(){const p=$('[component="groups/members/search"]');p.on("keyup",utils.debounce(function(){const A=p.val();socket.emit("groups.searchMembers",{groupName:o,query:A},function(h,y){if(h)return d.error(h);g(y.users,function(v){$('[component="groups/members"] tbody').html(v),$('[component="groups/members"]').attr("data-nextstart",20)})})},250))}function i(){$('[component="groups/members"] tbody').on("scroll",function(){const p=$(this),A=(p[0].scrollHeight-p.innerHeight())*.9;p.scrollTop()>A&&!$('[component="groups/members/search"]').val()&&a()})}function a(){const p=$('[component="groups/members"]');p.attr("loading")||(p.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:o,after:p.attr("data-nextstart")},function(A,h){if(A)return d.error(A);h&&h.users.length?l(h.users,function(){p.removeAttr("loading"),p.attr("data-nextstart",h.nextStart)}):p.removeAttr("loading")}))}function l(p,A){p=p.filter(function(h){return!$('[component="groups/members"] [data-uid="'+h.uid+'"]').length}),g(p,function(h){$('[component="groups/members"] tbody').append(h),A()})}function g(p,A){app.parseAndTranslate(e,"group.members",{group:{members:p,isOwner:ajaxify.data.group.isOwner}},A)}return n}.apply(E,b),m!==void 0&&(C.exports=m)},7927:(C,E,f)=>{"use strict";var b,m;b=[f(32230),f(7237),f(85233)],m=function(u,s,d){const n={};n.alert=function(t){t.alert_id="alert_button_"+(t.alert_id?t.alert_id:new Date().getTime()),t.title=t.title&&t.title.trim()||"",t.message=t.message?t.message.trim():"",t.type=t.type||"info";const i=$("#"+t.alert_id);i.length?e(i,t):o(t)},n.success=function(t,i){n.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:t,type:"success",timeout:i||5e3})},n.error=function(t,i){if(t=t&&t.message||t,t==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}n.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:t,type:"danger",timeout:i||1e4})},n.remove=function(t){$("#alert_button_"+t).remove()};function o(t){app.parseAndTranslate("alert",t,function(i){let a=$("#"+t.alert_id);if(a.length)return e(a,t);a=i,a.fadeIn(200),s.get("toaster/tray").prepend(a),typeof t.closefn=="function"&&a.find("button").on("click",function(){return t.closefn(),r(a),!1}),t.timeout&&c(a,t),typeof t.clickfn=="function"&&a.addClass("pointer").on("click",function(l){$(l.target).is(".close")||t.clickfn(a,t),r(a)}),d.fire("action:alert.new",{alert:a,params:t})})}function e(t,i){t.find("strong").translateHtml(i.title),t.find("p").translateHtml(i.message),t.attr("class","alert alert-dismissable alert-"+i.type+" clearfix"),clearTimeout(parseInt(t.attr("timeoutId"),10)),i.timeout&&c(t,i),d.fire("action:alert.update",{alert:t,params:i}),t.off("click").removeClass("pointer"),typeof i.clickfn=="function"&&t.addClass("pointer").on("click",function(a){$(a.target).is(".close")||i.clickfn(),r(t)})}function r(t){t.fadeOut(500,function(){$(this).remove()})}function c(t,i){const a=i.timeout,l=setTimeout(function(){r(t),typeof i.timeoutfn=="function"&&i.timeoutfn(t,i)},a);t.attr("timeoutId",l),t.css("transition-property","none"),t.removeClass("animate"),setTimeout(function(){t.css("transition-property",""),t.css("transition","width "+(a+450)+"ms linear, background-color "+(a+450)+"ms ease-in"),t.addClass("animate"),d.fire("action:alert.animate",{alert:t,params:i})},50),t.on("mouseenter",function(){$(this).css("transition-duration",0)})}return n}.apply(E,b),m!==void 0&&(C.exports=m)},74344:(C,E,f)=>{"use strict";var b,m;b=[f(85233)],m=(u=>{const s={},d=config.relative_path+"/api/v3";function n(o,e){o.url=o.url.startsWith("/api")?config.relative_path+o.url:d+o.url;async function r(c){({options:o}=await u.fire("filter:api.options",{options:o})),$.ajax(o).done(t=>{c(null,t&&t.hasOwnProperty("status")&&t.hasOwnProperty("response")?t.response:t||{})}).fail(t=>{let i;t.responseJSON&&(i=t.responseJSON.status&&t.responseJSON.status.message?t.responseJSON.status.message:t.responseJSON.error),c(new Error(i||t.statusText))})}if(typeof e=="function"){r(e);return}return new Promise((c,t)=>{r(function(i,a){i?t(i):c(a)})})}return s.get=(o,e,r)=>n({url:o+(e&&Object.keys(e).length?"?"+$.param(e):"")},r),s.head=(o,e,r)=>n({url:o+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},r),s.post=(o,e,r)=>n({url:o,method:"post",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),s.patch=(o,e,r)=>n({url:o,method:"patch",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),s.put=(o,e,r)=>n({url:o,method:"put",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),s.del=(o,e,r)=>n({url:o,method:"delete",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},r),s.delete=s.del,s}).apply(E,b),m!==void 0&&(C.exports=m)},22905:(C,E,f)=>{"use strict";var b,m;b=[f(7927)],m=function(u){const s={};return s.init=function(d,n){let o=null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"];let e=[];Array.isArray(n.localCategories)&&(e=n.localCategories.map(a=>({...a}))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const r=d.find('[component="category-selector-search"]');if(!r.length)return;const c=r.parent('[component="category/dropdown"]').length>0||r.parent('[component="category-selector"]').length>0;d.on("show.bs.dropdown",function(){c&&(d.find(".dropdown-toggle").addClass("hidden"),r.removeClass("hidden"));function a(){const l=r.find("input").val();l.length>1||!l&&!o?t(l,function(g){o=o||g,i(g)}):!l&&o&&(o.forEach(function(g){g.selected=n.selectedCids.includes(g.cid)}),i(o))}r.on("click",function(l){l.preventDefault(),l.stopPropagation()}),r.find("input").val("").on("keyup",utils.debounce(a,300)),a()}),d.on("shown.bs.dropdown",function(){r.find("input").focus()}),d.on("hide.bs.dropdown",function(){c&&(d.find(".dropdown-toggle").removeClass("hidden"),r.addClass("hidden")),r.off("click"),r.find("input").off("keyup")});function t(a,l){socket.emit("categories.categorySearch",{search:a,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(g,p){if(g)return u.error(g);l(e.concat(p))})}function i(a){app.parseAndTranslate(n.template,{categoryItems:a.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(l){d.find('[component="category/list"]').replaceWith(l.find('[component="category/list"]')),d.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!a.length)})}},s}.apply(E,b),m!==void 0&&(C.exports=m)},50548:(C,E,f)=>{"use strict";var b,m;b=[f(22905),f(31369),f(85233)],m=function(u,s,d){const n={};return n.init=function(o,e){if(!o||!o.length)return;e=e||{};const r=e.onSelect||function(){};e.states=e.states||["watching","notwatching","ignoring"],e.template="partials/category-selector",d.fire("action:category.selector.options",{el:o,options:e}),u.init(o,e);const c={el:o,selectedCategory:null};o.on("click","[data-cid]",function(){const i=$(this);if(i.hasClass("disabled"))return!1;c.selectCategory(i.attr("data-cid")),r(c.selectedCategory)});const t=c.el.find('[component="category-selector-selected"]').html();return c.selectCategory=function(i){const a=c.el.find('[data-cid="'+i+'"]');c.selectedCategory={cid:i,name:a.attr("data-name")},a.length?c.el.find('[component="category-selector-selected"]').html(a.find('[component="category-markup"]').html()):c.el.find('[component="category-selector-selected"]').html(t)},c.getSelectedCategory=function(){return c.selectedCategory},c.getSelectedCid=function(){return c.selectedCategory?c.selectedCategory.cid:0},c},n.modal=function(o){o=o||{},o.onSelect=o.onSelect||function(){},o.onSubmit=o.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:o.message},function(e){const r=s.dialog({title:o.title||"[[modules:composer.select_category]]",message:e,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:t}}}),c=n.init(r.find('[component="category-selector"]'),o);function t(i){return i.preventDefault(),c.selectedCategory&&(o.onSubmit(c.selectedCategory),r.modal("hide")),!1}o.openOnLoad&&r.on("shown.bs.modal",function(){r.find(".dropdown-toggle").dropdown("toggle")}),r.find("form").on("submit",t)})},n}.apply(E,b),m!==void 0&&(C.exports=m)},7237:(C,E,f)=>{"use strict";var b;b=function(){const m={};return m.core={"topic/teaser":function(u){return u?$('[component="category/topic"][data-tid="'+u+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(u,s){return $('[component="topic"][data-'+u+'="'+s+'"]')},post:function(u,s){return $('[component="post"][data-'+u+'="'+s+'"]')},"post/content":function(u){return $('[component="post"][data-pid="'+u+'"] [component="post/content"]')},"post/header":function(u){return $('[component="post"][data-pid="'+u+'"] [component="post/header"]')},"post/anchor":function(u){return $('[component="post"][data-index="'+u+'"] [component="post/anchor"]')},"post/vote-count":function(u){return $('[component="post"][data-pid="'+u+'"] [component="post/vote-count"]')},"post/bookmark-count":function(u){return $('[component="post"][data-pid="'+u+'"] [component="post/bookmark-count"]')},"user/postcount":function(u){return $('[component="user/postcount"][data-uid="'+u+'"]')},"user/reputation":function(u){return $('[component="user/reputation"][data-uid="'+u+'"]')},"category/topic":function(u,s){return $('[component="category/topic"][data-'+u+'="'+s+'"]')},"categories/category":function(u,s){return $('[component="categories/category"][data-'+u+'="'+s+'"]')},"chat/message":function(u){return $('[component="chat/message"][data-mid="'+u+'"]')},"chat/message/body":function(u){return $('[component="chat/message"][data-mid="'+u+'"] [component="chat/message/body"]')},"chat/recent/room":function(u){return $('[component="chat/recent/room"][data-roomid="'+u+'"]')}},m.get=function(){const u=Array.prototype.slice.call(arguments,1);return m.core[arguments[0]]&&u.length?m.core[arguments[0]].apply(this,u):$('[component="'+arguments[0]+'"]')},m}.call(E,f,E,C),b!==void 0&&(C.exports=b)},38565:(C,E,f)=>{"use strict";var b,m;b=[f(7927),f(80034)],m=function(u){const s={coverEl:null,saveFn:null};s.init=function(n,o,e,r){s.coverEl=n,s.saveFn=o,n.find(".upload").on("click",e),n.find(".resize").on("click",function(){d(n)}),n.find(".remove").on("click",r),n.on("dragover",s.onDragOver).on("drop",s.onDrop),n.find(".save").on("click",s.save),n.addClass("initialised")},s.onDragOver=function(n){n.stopPropagation(),n.preventDefault(),n.originalEvent.dataTransfer.dropEffect="copy"},s.onDrop=function(n){n.stopPropagation(),n.preventDefault();const o=n.originalEvent.dataTransfer.files,e=new FileReader;o.length&&o[0].type.match("image.*")&&(e.onload=function(r){s.coverEl.css("background-image","url("+r.target.result+")"),s.newCover=r.target.result},e.readAsDataURL(o[0]),d(s.coverEl))};function d(n){n.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),u.alert({alert_id:"drag_start",title:"[[modules:cover.dragging_title]]",message:"[[modules:cover.dragging_message]]",timeout:5e3})}return s.save=function(){s.coverEl.addClass("saving"),s.saveFn(s.newCover||void 0,s.coverEl.css("background-position"),function(n){n?u.error(n):(s.coverEl.toggleClass("active",0),s.coverEl.backgroundDraggable("disable"),s.coverEl.off("dragover",s.onDragOver),s.coverEl.off("drop",s.onDrop),u.success("[[modules:cover.saved]]")),s.coverEl.removeClass("saving")})},s}.apply(E,b),m!==void 0&&(C.exports=m)},18487:(C,E,f)=>{"use strict";var b,m;b=[f(59006),f(31369)],m=function(u,s){const d={};return d.init=function(n,o){o=o||function(){};const e=n.hasClass("fa-2x");let r=n.attr("class").replace("fa-2x","").replace("fa","").replace(/\s+/g,"");if($("#icons .selected").removeClass("selected"),r)try{$("#icons .fa-icons .fa."+r).addClass("selected")}catch{r=""}u.render("partials/fontawesome",{}).then(function(c){c=$(c),c.find(".fa-icons").prepend($('<i class="fa fa-nbb-none"></i>'));const t=s.dialog({onEscape:!0,backdrop:!0,show:!1,message:c,title:"Select an Icon",buttons:{noIcon:{label:"No Icon",className:"btn-default",callback:function(){n.attr("class","fa "+(e?"fa-2x ":"")),n.val(""),n.attr("value",""),o(n)}},success:{label:"Select",className:"btn-primary",callback:function(){const i=$(".bootbox .selected").attr("class")||`fa fa-${$(".bootbox #fa-filter").val()}`,a=$("<div></div>").addClass(i).removeClass("fa").removeClass("selected").attr("class"),l=t.find("input").val();a?(n.attr("class","fa "+(e?"fa-2x ":"")+a),n.val(a),n.attr("value",a)):l&&(n.attr("class",l),n.val(l),n.attr("value",l)),o(n)}}}});t.on("show.bs.modal",function(){const i=$(this),a=i.find("input");r&&(i.find("."+r).addClass("selected"),a.val(r.replace("fa-","")))}).modal("show"),t.on("shown.bs.modal",function(){const i=$(this),a=i.find("input"),l=i.find(".fa-icons i"),g=i.find("button.btn-primary");function p(A){i.find("i.selected").removeClass("selected"),A?A.addClass("selected"):a.val().length===0?r&&i.find("."+r).addClass("selected"):i.find("i:visible").first().addClass("selected")}a.selectRange(0,a.val().length),i.find(".icon-container").on("click","i",function(){a.val($(this).attr("class").replace("fa fa-","").replace("selected","")),p($(this))}),a.on("keyup",function(A){A.keyCode!==13?(l.show(),l.each(function(h,y){y.className.match(new RegExp("^fa fa-.*"+a.val()+".*$"))||$(y).hide()}),p()):g.click()})})})},d}.apply(E,b),m!==void 0&&(C.exports=m)},98192:(C,E,f)=>{"use strict";var b,m;b=[f(7927)],m=function(u){const s={};s.show=function(e,r){const c=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:c,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const i=t.find("#uploadForm");e.route&&i.attr("action",e.route),t.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),e.uploadModal=t,o(e,r),!1})})},s.handleImageCrop=function(e,r){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(e.url)},async function(c){c.modal({backdrop:"static"}).modal("show");const t=parseInt($(window).height()/2,10),i=document.getElementById("cropped-image");$(i).css("max-height",t);const a=(await f.e(1649).then(f.t.bind(f,33129,23))).default;let l=new a(i,{aspectRatio:e.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){e.restrictImageDimension&&(l.cropBoxData.width>e.imageDimension&&l.setCropBoxData({width:e.imageDimension}),l.cropBoxData.height>e.imageDimension&&l.setCropBoxData({height:e.imageDimension}))},ready:function(){if(!n(l,e))return c.modal("hide");if(e.restrictImageDimension){const g=i.width<i.height?i.width:i.height,p=g>e.imageDimension?e.imageDimension:g;l.setCropBoxData({width:p,height:p})}c.find(".rotate").on("click",function(){const g=this.getAttribute("data-degrees");l.rotate(g)}),c.find(".flip").on("click",function(){const g=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?l.scaleX(g):l.scaleY(g),this.setAttribute("data-option",g*-1)}),c.find(".reset").on("click",function(){l.reset()}),c.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const g=n(l,e);g&&(c.find("#upload-progress-bar").css("width","0%"),c.find("#upload-progress-box").show().removeClass("hide"),d({data:e,imageData:g,progressBarEl:c.find("#upload-progress-bar")},function(p,A){if(p)return c.find("#upload-progress-box").hide(),c.find(".upload-btn").removeClass("disabled"),c.find(".crop-btn").removeClass("disabled"),u.error(p);r(A.url),c.modal("hide")}))}),c.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),l.destroy();const g=(await f.e(1649).then(f.t.bind(f,33129,23))).default;l=new g(i,{viewMode:1,autoCropArea:1,ready:function(){c.find(".crop-btn").trigger("click")}})})}})})};function d(e,r){const c={};c[e.data.paramName]=e.data.paramValue,c.method=e.data.socketMethod,c.size=e.imageData.length,c.progress=0;const t=1e5;function i(){const a=e.imageData.slice(c.progress,c.progress+t);socket.emit("uploads.upload",{chunk:a,params:c},function(l,g){if(l)return u.error(l);if(c.progress+t<c.size)return c.progress+=a.length,e.progressBarEl.css("width",(c.progress/c.size*100).toFixed(2)+"%"),setTimeout(i,100);e.progressBarEl.css("width","100%"),r(null,g)})}i()}function n(e,r){let c;try{c=r.imageType?e.getCroppedCanvas().toDataURL(r.imageType):e.getCroppedCanvas().toDataURL()}catch(t){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(t.message)!==-1?u.error("[[error:cors-error]]"):u.error(t.message);return}return c}function o(e,r){function c(g,p){g==="error"&&e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),e.uploadModal.find("#alert-"+g).translateText(p).removeClass("hide")}const t=e.uploadModal.find("#fileInput");if(!t.val())return c("error","[[uploads:select-file-to-upload]]");const i=t[0].files[0],a=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;if(a&&i.size>a*1024)return c("error","[[error:file-too-big, "+a+"]]");if(i.name.endsWith(".gif")){f.e(3564).then(function(){var g=[f(50431)];(function(p){p.ajaxSubmit(e.uploadModal,r)}).apply(null,g)}).catch(f.oe);return}const l=new FileReader;l.addEventListener("load",function(){const g=l.result;e.uploadModal.modal("hide"),s.handleImageCrop({url:g,imageType:i.type,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},r)},!1),i&&l.readAsDataURL(i)}return s}.apply(E,b),m!==void 0&&(C.exports=m)},22568:(C,E,f)=>{"use strict";var b,m,u;(function(s){m=[f(20648)],b=s,u=typeof b=="function"?b.apply(E,m):b,u!==void 0&&(C.exports=u)})(function(s){const d=s("[^\\p{L}\\s\\d\\-_]","g"),n=/[^\w\s\d\-_]/g,o=/^\s+|\s+$/g,e=/\s+/g,r=/-+/g,c=/-$/g,t=/^-/g,i=/^[\w\d\s.,\-@]+$/;return function(l,g){return l?(l=String(l).replace(o,""),i.test(l)?l=l.replace(n,"-"):l=s.replace(l,d,"-"),l=g?l:l.toLocaleLowerCase(),l=l.replace(e,"-"),l=l.replace(r,"-"),l=l.replace(c,""),l=l.replace(t,""),l):""}})},80034:()=>{(function(C){var E=C(window),f=function(s,d,n,o){if(arguments.length===3||o){if(n<s)return s;if(n>d)return d}return n},b=function(s){s.clientX=s.originalEvent.touches[0].clientX,s.clientY=s.originalEvent.touches[0].clientY},m=function(s){var d=(s.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(d){var n={width:0,height:0},o=new Image;return o.onload=function(){if(s.css("background-size")=="cover"){var e=s.innerWidth(),r=s.innerHeight(),c=e/r;imageAspectRatio=o.width/o.height,scale=1,imageAspectRatio>=c?scale=r/o.height:scale=e/o.width,n.width=o.width*scale,n.height=o.height*scale}else n.width=o.width,n.height=o.height},o.src=d,n}};function u(s,d){this.element=s,this.options=d,this.init()}u.prototype.init=function(){var s=C(this.element),d=(s.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],n=this.options;if(d){var o={width:0,height:0};(n.bound||n.units=="percent")&&(o=m(s)),s.on("mousedown.dbg touchstart.dbg",function(e){if(e.target===s[0]){if(e.preventDefault(),e.originalEvent.touches)b(e);else if(e.which!==1)return;var r=e.clientX,c=e.clientY,t=s.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],i=parseInt(t[1])||0,a=parseInt(t[2])||0;n.units=="percent"&&(i=Math.round(i/-200*o.width),a=Math.round(a/-200*o.height)),E.on("mousemove.dbg touchmove.dbg",function(l){l.preventDefault(),l.originalEvent.touches&&b(l);var g=l.clientX,p=l.clientY;n.units=="percent"?(i=n.axis==="y"?i:f(-o.width/2,0,i+g-r,n.bound),a=n.axis==="x"?a:f(-o.height/2,0,a+p-c,n.bound),s.css("background-position",i/o.width*-200+"% "+a/o.height*-200+"%")):(i=n.axis==="y"?i:f(s.innerWidth()-o.width,0,i+g-r,n.bound),a=n.axis==="x"?a:f(s.innerHeight()-o.height,0,a+p-c,n.bound),s.css("background-position",i+"px "+a+"px")),r=g,c=p}),E.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){n.done&&n.done(),E.off("mousemove.dbg touchmove.dbg"),E.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},u.prototype.disable=function(){var s=C(this.element);s.off("mousedown.dbg touchstart.dbg"),E.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},C.fn.backgroundDraggable=function(d){var d=d,n=Array.prototype.slice.call(arguments,1);return this.each(function(){var o=C(this);if(typeof d>"u"||typeof d=="object"){d=C.extend({},C.fn.backgroundDraggable.defaults,d);var e=new u(this,d);o.data("dbg",e)}else if(typeof d=="string"&&o.data("dbg")){var e=o.data("dbg");u.prototype[d].apply(e,n)}})},C.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)}}]);
