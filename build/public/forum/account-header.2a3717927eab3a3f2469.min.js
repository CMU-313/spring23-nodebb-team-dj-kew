(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[9970,7214,9617,6503,1710,3014,8529,8786,2550,5655,831],{59494:(v,b,f)=>{"use strict";var m,h;m=[f(38565),f(98192),f(7237),f(32230),f(59006),f(997),f(74344),f(31369),f(7927)],h=function(s,n,u,o,a,t,c,r,e){const i={};let l;i.init=function(){l=ajaxify.data.isAdmin||ajaxify.data.isSelf||ajaxify.data.isGlobalModerator,p(),D(),l&&x(),u.get("account/follow").on("click",function(){I("follow")}),u.get("account/unfollow").on("click",function(){I("unfollow")}),u.get("account/chat").on("click",async function(){const d=await socket.emit("modules.chats.hasPrivateChat",ajaxify.data.uid),y=await app.require("chat");d?y.openChat(d):y.newChat(ajaxify.data.uid)}),u.get("account/new-chat").on("click",async function(){(await app.require("chat")).newChat(ajaxify.data.uid,function(){u.get("account/chat").parent().removeClass("hidden")})}),u.get("account/ban").on("click",function(){R(ajaxify.data.theirid)}),u.get("account/mute").on("click",function(){N(ajaxify.data.theirid)}),u.get("account/unban").on("click",function(){j(ajaxify.data.theirid)}),u.get("account/unmute").on("click",function(){S(ajaxify.data.theirid)}),u.get("account/delete-account").on("click",g.bind(null,"account")),u.get("account/delete-content").on("click",g.bind(null,"content")),u.get("account/delete-all").on("click",g.bind(null,"purge")),u.get("account/flag").on("click",T),u.get("account/block").on("click",P)};function g(d){t[d](ajaxify.data.theirid)}i.banAccount=R,i.muteAccount=N,i.unbanAccount=j,i.unmuteAccount=S;function p(){(!app.user.uid||app.user.uid!==parseInt(ajaxify.data.theirid,10))&&$(".account-sub-links .plugin-link.private").addClass("hide")}function D(){$(".account-sub-links li").removeClass("active").each(function(){const d=$(this).find("a").attr("href");if(decodeURIComponent(d)===decodeURIComponent(window.location.pathname))return $(this).addClass("active"),!1})}function x(){s.init(u.get("account/cover"),function(d,y,E){socket.emit("user.updateCover",{uid:ajaxify.data.uid,imageData:d,position:y},E)},function(){n.show({title:"[[user:upload_cover_picture]]",socketMethod:"user.updateCover",aspectRatio:NaN,allowSkippingCrop:!0,restrictImageDimension:!1,paramName:"uid",paramValue:ajaxify.data.theirid,accept:".png,.jpg,.bmp"},function(d){d=(d.startsWith("http")?"":config.relative_path)+d+"?"+Date.now(),u.get("account/cover").css("background-image","url("+d+")")})},B)}function I(d){return c[d==="follow"?"put":"del"]("/users/"+ajaxify.data.uid+"/follow",void 0,function(y){if(y)return e.error(y);u.get("account/follow").toggleClass("hide",d==="follow"),u.get("account/unfollow").toggleClass("hide",d==="unfollow"),e.success("[[global:alert."+d+", "+ajaxify.data.username+"]]")}),!1}function R(d,y){d=d||ajaxify.data.theirid,a.render("admin/partials/temporary-ban",{}).then(function(E){r.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:E,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:ban_account]]",callback:function(){const A=$(".ban-modal form").serializeArray().reduce(function(C,k){return C[k.name]=k.value,C},{}),w=A.length>0?Date.now()+A.length*1e3*60*60*(parseInt(A.unit,10)?24:1):0;c.put("/users/"+d+"/ban",{until:w,reason:A.reason||""}).then(()=>{if(typeof y=="function")return y();ajaxify.refresh()}).catch(e.error)}}}})})}function j(d){c.del("/users/"+d+"/ban").then(()=>{ajaxify.refresh()}).catch(e.error)}function N(d,y){d=d||ajaxify.data.theirid,a.render("admin/partials/temporary-mute",{}).then(function(E){r.dialog({className:"mute-modal",title:"[[user:mute_account]]",message:E,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:mute_account]]",callback:function(){const A=$(".mute-modal form").serializeArray().reduce(function(C,k){return C[k.name]=k.value,C},{}),w=A.length>0?Date.now()+A.length*1e3*60*60*(parseInt(A.unit,10)?24:1):0;c.put("/users/"+d+"/mute",{until:w,reason:A.reason||""}).then(()=>{if(typeof y=="function")return y();ajaxify.refresh()}).catch(e.error)}}}})})}function S(d){c.del("/users/"+d+"/mute").then(()=>{ajaxify.refresh()}).catch(e.error)}function T(){f.e(1803).then(function(){var d=[f(41803)];(function(y){y.showFlagModal({type:"user",id:ajaxify.data.uid})}).apply(null,d)}).catch(f.oe)}function P(){const d=this;return socket.emit("user.toggleBlock",{blockeeUid:ajaxify.data.uid,blockerUid:app.user.uid},function(y,E){if(y)return e.error(y);o.translate("[[user:"+(E?"unblock":"block")+"_user]]",function(A){$(d).text(A)})}),!1}function B(){o.translate("[[user:remove_cover_picture_confirm]]",function(d){r.confirm(d,function(y){y&&socket.emit("user.removeCover",{uid:ajaxify.data.uid},function(E){E?e.error(E):ajaxify.refresh()})})})}return i}.apply(b,m),h!==void 0&&(v.exports=h)},997:(v,b,f)=>{"use strict";var m,h;m=[f(74344),f(31369),f(7927)],h=function(s,n,u){const o={};o.account=function(t,c){a(t,"[[user:delete_this_account_confirm]]","/account","[[user:account-deleted]]",c)},o.content=function(t,c){a(t,"[[user:delete_account_content_confirm]]","/content","[[user:account-content-deleted]]",c)},o.purge=function(t,c){a(t,"[[user:delete_all_confirm]]","","[[user:account-deleted]]",c)};function a(t,c,r,e,i){n.confirm(c,function(l){l&&s.del(`/users/${t}${r}`,{}).then(()=>{if(u.success(e),typeof i=="function")return i()}).catch(u.error)})}return o}.apply(b,m),h!==void 0&&(v.exports=h)},7927:(v,b,f)=>{"use strict";var m,h;m=[f(32230),f(7237),f(85233)],h=function(s,n,u){const o={};o.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:new Date().getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const i=$("#"+e.alert_id);i.length?t(i,e):a(e)},o.success=function(e,i){o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:i||5e3})},o.error=function(e,i){if(e=e&&e.message||e,e==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}o.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:i||1e4})},o.remove=function(e){$("#alert_button_"+e).remove()};function a(e){app.parseAndTranslate("alert",e,function(i){let l=$("#"+e.alert_id);if(l.length)return t(l,e);l=i,l.fadeIn(200),n.get("toaster/tray").prepend(l),typeof e.closefn=="function"&&l.find("button").on("click",function(){return e.closefn(),c(l),!1}),e.timeout&&r(l,e),typeof e.clickfn=="function"&&l.addClass("pointer").on("click",function(g){$(g.target).is(".close")||e.clickfn(l,e),c(l)}),u.fire("action:alert.new",{alert:l,params:e})})}function t(e,i){e.find("strong").translateHtml(i.title),e.find("p").translateHtml(i.message),e.attr("class","alert alert-dismissable alert-"+i.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),i.timeout&&r(e,i),u.fire("action:alert.update",{alert:e,params:i}),e.off("click").removeClass("pointer"),typeof i.clickfn=="function"&&e.addClass("pointer").on("click",function(l){$(l.target).is(".close")||i.clickfn(),c(e)})}function c(e){e.fadeOut(500,function(){$(this).remove()})}function r(e,i){const l=i.timeout,g=setTimeout(function(){c(e),typeof i.timeoutfn=="function"&&i.timeoutfn(e,i)},l);e.attr("timeoutId",g),e.css("transition-property","none"),e.removeClass("animate"),setTimeout(function(){e.css("transition-property",""),e.css("transition","width "+(l+450)+"ms linear, background-color "+(l+450)+"ms ease-in"),e.addClass("animate"),u.fire("action:alert.animate",{alert:e,params:i})},50),e.on("mouseenter",function(){$(this).css("transition-duration",0)})}return o}.apply(b,m),h!==void 0&&(v.exports=h)},74344:(v,b,f)=>{"use strict";var m,h;m=[f(85233)],h=(s=>{const n={},u=config.relative_path+"/api/v3";function o(a,t){a.url=a.url.startsWith("/api")?config.relative_path+a.url:u+a.url;async function c(r){({options:a}=await s.fire("filter:api.options",{options:a})),$.ajax(a).done(e=>{r(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let i;e.responseJSON&&(i=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),r(new Error(i||e.statusText))})}if(typeof t=="function"){c(t);return}return new Promise((r,e)=>{c(function(i,l){i?e(i):r(l)})})}return n.get=(a,t,c)=>o({url:a+(t&&Object.keys(t).length?"?"+$.param(t):"")},c),n.head=(a,t,c)=>o({url:a+(t&&Object.keys(t).length?"?"+$.param(t):""),method:"head"},c),n.post=(a,t,c)=>o({url:a,method:"post",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},c),n.patch=(a,t,c)=>o({url:a,method:"patch",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},c),n.put=(a,t,c)=>o({url:a,method:"put",data:JSON.stringify(t||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},c),n.del=(a,t,c)=>o({url:a,method:"delete",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},c),n.delete=n.del,n}).apply(b,m),h!==void 0&&(v.exports=h)},7237:(v,b,f)=>{"use strict";var m;m=function(){const h={};return h.core={"topic/teaser":function(s){return s?$('[component="category/topic"][data-tid="'+s+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(s,n){return $('[component="topic"][data-'+s+'="'+n+'"]')},post:function(s,n){return $('[component="post"][data-'+s+'="'+n+'"]')},"post/content":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/content"]')},"post/header":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/header"]')},"post/anchor":function(s){return $('[component="post"][data-index="'+s+'"] [component="post/anchor"]')},"post/vote-count":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/vote-count"]')},"post/bookmark-count":function(s){return $('[component="post"][data-pid="'+s+'"] [component="post/bookmark-count"]')},"user/postcount":function(s){return $('[component="user/postcount"][data-uid="'+s+'"]')},"user/reputation":function(s){return $('[component="user/reputation"][data-uid="'+s+'"]')},"category/topic":function(s,n){return $('[component="category/topic"][data-'+s+'="'+n+'"]')},"categories/category":function(s,n){return $('[component="categories/category"][data-'+s+'="'+n+'"]')},"chat/message":function(s){return $('[component="chat/message"][data-mid="'+s+'"]')},"chat/message/body":function(s){return $('[component="chat/message"][data-mid="'+s+'"] [component="chat/message/body"]')},"chat/recent/room":function(s){return $('[component="chat/recent/room"][data-roomid="'+s+'"]')}},h.get=function(){const s=Array.prototype.slice.call(arguments,1);return h.core[arguments[0]]&&s.length?h.core[arguments[0]].apply(this,s):$('[component="'+arguments[0]+'"]')},h}.call(b,f,b,v),m!==void 0&&(v.exports=m)},38565:(v,b,f)=>{"use strict";var m,h;m=[f(7927),f(80034)],h=function(s){const n={coverEl:null,saveFn:null};n.init=function(o,a,t,c){n.coverEl=o,n.saveFn=a,o.find(".upload").on("click",t),o.find(".resize").on("click",function(){u(o)}),o.find(".remove").on("click",c),o.on("dragover",n.onDragOver).on("drop",n.onDrop),o.find(".save").on("click",n.save),o.addClass("initialised")},n.onDragOver=function(o){o.stopPropagation(),o.preventDefault(),o.originalEvent.dataTransfer.dropEffect="copy"},n.onDrop=function(o){o.stopPropagation(),o.preventDefault();const a=o.originalEvent.dataTransfer.files,t=new FileReader;a.length&&a[0].type.match("image.*")&&(t.onload=function(c){n.coverEl.css("background-image","url("+c.target.result+")"),n.newCover=c.target.result},t.readAsDataURL(a[0]),u(n.coverEl))};function u(o){o.toggleClass("active",1).backgroundDraggable({axis:"y",units:"percent"}),s.alert({alert_id:"drag_start",title:"[[modules:cover.dragging_title]]",message:"[[modules:cover.dragging_message]]",timeout:5e3})}return n.save=function(){n.coverEl.addClass("saving"),n.saveFn(n.newCover||void 0,n.coverEl.css("background-position"),function(o){o?s.error(o):(n.coverEl.toggleClass("active",0),n.coverEl.backgroundDraggable("disable"),n.coverEl.off("dragover",n.onDragOver),n.coverEl.off("drop",n.onDrop),s.success("[[modules:cover.saved]]")),n.coverEl.removeClass("saving")})},n}.apply(b,m),h!==void 0&&(v.exports=h)},98192:(v,b,f)=>{"use strict";var m,h;m=[f(7927)],h=function(s){const n={};n.show=function(t,c){const r=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:r,title:t.title||"[[global:upload_file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const i=e.find("#uploadForm");t.route&&i.attr("action",t.route),e.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),t.uploadModal=e,a(t,c),!1})})},n.handleImageCrop=function(t,c){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(t.url)},async function(r){r.modal({backdrop:"static"}).modal("show");const e=parseInt($(window).height()/2,10),i=document.getElementById("cropped-image");$(i).css("max-height",e);const l=(await f.e(1649).then(f.t.bind(f,33129,23))).default;let g=new l(i,{aspectRatio:t.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){t.restrictImageDimension&&(g.cropBoxData.width>t.imageDimension&&g.setCropBoxData({width:t.imageDimension}),g.cropBoxData.height>t.imageDimension&&g.setCropBoxData({height:t.imageDimension}))},ready:function(){if(!o(g,t))return r.modal("hide");if(t.restrictImageDimension){const p=i.width<i.height?i.width:i.height,D=p>t.imageDimension?t.imageDimension:p;g.setCropBoxData({width:D,height:D})}r.find(".rotate").on("click",function(){const p=this.getAttribute("data-degrees");g.rotate(p)}),r.find(".flip").on("click",function(){const p=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?g.scaleX(p):g.scaleY(p),this.setAttribute("data-option",p*-1)}),r.find(".reset").on("click",function(){g.reset()}),r.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const p=o(g,t);p&&(r.find("#upload-progress-bar").css("width","0%"),r.find("#upload-progress-box").show().removeClass("hide"),u({data:t,imageData:p,progressBarEl:r.find("#upload-progress-bar")},function(D,x){if(D)return r.find("#upload-progress-box").hide(),r.find(".upload-btn").removeClass("disabled"),r.find(".crop-btn").removeClass("disabled"),s.error(D);c(x.url),r.modal("hide")}))}),r.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),g.destroy();const p=(await f.e(1649).then(f.t.bind(f,33129,23))).default;g=new p(i,{viewMode:1,autoCropArea:1,ready:function(){r.find(".crop-btn").trigger("click")}})})}})})};function u(t,c){const r={};r[t.data.paramName]=t.data.paramValue,r.method=t.data.socketMethod,r.size=t.imageData.length,r.progress=0;const e=1e5;function i(){const l=t.imageData.slice(r.progress,r.progress+e);socket.emit("uploads.upload",{chunk:l,params:r},function(g,p){if(g)return s.error(g);if(r.progress+e<r.size)return r.progress+=l.length,t.progressBarEl.css("width",(r.progress/r.size*100).toFixed(2)+"%"),setTimeout(i,100);t.progressBarEl.css("width","100%"),c(null,p)})}i()}function o(t,c){let r;try{r=c.imageType?t.getCroppedCanvas().toDataURL(c.imageType):t.getCroppedCanvas().toDataURL()}catch(e){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(e.message)!==-1?s.error("[[error:cors-error]]"):s.error(e.message);return}return r}function a(t,c){function r(p,D){p==="error"&&t.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),t.uploadModal.find("#alert-"+p).translateText(D).removeClass("hide")}const e=t.uploadModal.find("#fileInput");if(!e.val())return r("error","[[uploads:select-file-to-upload]]");const i=e[0].files[0],l=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;if(l&&i.size>l*1024)return r("error","[[error:file-too-big, "+l+"]]");if(i.name.endsWith(".gif")){f.e(3564).then(function(){var p=[f(50431)];(function(D){D.ajaxSubmit(t.uploadModal,c)}).apply(null,p)}).catch(f.oe);return}const g=new FileReader;g.addEventListener("load",function(){const p=g.result;t.uploadModal.modal("hide"),n.handleImageCrop({url:p,imageType:i.type,socketMethod:t.socketMethod,aspectRatio:t.aspectRatio,allowSkippingCrop:t.allowSkippingCrop,restrictImageDimension:t.restrictImageDimension,imageDimension:t.imageDimension,paramName:t.paramName,paramValue:t.paramValue},c)},!1),i&&g.readAsDataURL(i)}return n}.apply(b,m),h!==void 0&&(v.exports=h)},80034:()=>{(function(v){var b=v(window),f=function(n,u,o,a){if(arguments.length===3||a){if(o<n)return n;if(o>u)return u}return o},m=function(n){n.clientX=n.originalEvent.touches[0].clientX,n.clientY=n.originalEvent.touches[0].clientY},h=function(n){var u=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1];if(u){var o={width:0,height:0},a=new Image;return a.onload=function(){if(n.css("background-size")=="cover"){var t=n.innerWidth(),c=n.innerHeight(),r=t/c;imageAspectRatio=a.width/a.height,scale=1,imageAspectRatio>=r?scale=c/a.height:scale=t/a.width,o.width=a.width*scale,o.height=a.height*scale}else o.width=a.width,o.height=a.height},a.src=u,o}};function s(n,u){this.element=n,this.options=u,this.init()}s.prototype.init=function(){var n=v(this.element),u=(n.css("background-image").match(/^url\(['"]?(.*?)['"]?\)$/i)||[])[1],o=this.options;if(u){var a={width:0,height:0};(o.bound||o.units=="percent")&&(a=h(n)),n.on("mousedown.dbg touchstart.dbg",function(t){if(t.target===n[0]){if(t.preventDefault(),t.originalEvent.touches)m(t);else if(t.which!==1)return;var c=t.clientX,r=t.clientY,e=n.css("background-position").match(/(-?\d+).*?\s(-?\d+)/)||[],i=parseInt(e[1])||0,l=parseInt(e[2])||0;o.units=="percent"&&(i=Math.round(i/-200*a.width),l=Math.round(l/-200*a.height)),b.on("mousemove.dbg touchmove.dbg",function(g){g.preventDefault(),g.originalEvent.touches&&m(g);var p=g.clientX,D=g.clientY;o.units=="percent"?(i=o.axis==="y"?i:f(-a.width/2,0,i+p-c,o.bound),l=o.axis==="x"?l:f(-a.height/2,0,l+D-r,o.bound),n.css("background-position",i/a.width*-200+"% "+l/a.height*-200+"%")):(i=o.axis==="y"?i:f(n.innerWidth()-a.width,0,i+p-c,o.bound),l=o.axis==="x"?l:f(n.innerHeight()-a.height,0,l+D-r,o.bound),n.css("background-position",i+"px "+l+"px")),c=p,r=D}),b.on("mouseup.dbg touchend.dbg mouseleave.dbg",function(){o.done&&o.done(),b.off("mousemove.dbg touchmove.dbg"),b.off("mouseup.dbg touchend.dbg mouseleave.dbg")})}})}},s.prototype.disable=function(){var n=v(this.element);n.off("mousedown.dbg touchstart.dbg"),b.off("mousemove.dbg touchmove.dbg mouseup.dbg touchend.dbg mouseleave.dbg")},v.fn.backgroundDraggable=function(u){var u=u,o=Array.prototype.slice.call(arguments,1);return this.each(function(){var a=v(this);if(typeof u>"u"||typeof u=="object"){u=v.extend({},v.fn.backgroundDraggable.defaults,u);var t=new s(this,u);a.data("dbg",t)}else if(typeof u=="string"&&a.data("dbg")){var t=a.data("dbg");s.prototype[u].apply(t,o)}})},v.fn.backgroundDraggable.defaults={bound:!0,axis:void 0,units:"pixels"}})(jQuery)}}]);
