"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[613],{29412:(T,L,s)=>{var E,v;E=[s(69941),s(60392),s(7237),s(74344),s(31369),s(7927)],v=function(u,C,n,p,D,a){const m={};m.init=function(){u.init(d),F(),n.get("topic/delete").on("click",function(){return f("del","/state","delete",l),!1}),n.get("topic/restore").on("click",function(){return f("put","/state","restore",l),!1}),n.get("topic/purge").on("click",function(){return f("del","","purge",l),!1}),n.get("topic/lock").on("click",function(){return f("put","/lock","lock",c),!1}),n.get("topic/unlock").on("click",function(){return f("del","/lock","unlock",c),!1}),n.get("topic/pin").on("click",function(){return f("put","/pin","pin",c),!1}),n.get("topic/unpin").on("click",function(){return f("del","/pin","unpin",c),!1}),n.get("topic/mark-unread-for-all").on("click",function(){const e=u.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(t){if(t)return a.error(t);a.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(o){$('[component="category/topic"][data-tid="'+o+'"]').addClass("unread")}),c()}),!1):a.error("[[error:no-topics-selected]]")}),n.get("topic/move").on("click",function(){return s.e(7378).then(function(){var e=[s(57378)];(function(t){const o=u.getSelectedTids();if(!o.length)return a.error("[[error:no-topics-selected]]");t.init(o,null,c)}).apply(null,e)}).catch(s.oe),!1}),n.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return a.error("[[error:invalid-data]]");s.e(7378).then(function(){var t=[s(57378)];(function(o){o.init(null,e,function(r){if(r)return a.error(r);ajaxify.refresh()})}).apply(null,t)}).catch(s.oe)}),n.get("topic/merge").on("click",function(){const e=u.getSelectedTids();s.e(28).then(function(){var t=[s(90028)];(function(o){o.init(function(){e.length&&e.forEach(function(r){o.addTopic(r)})})}).apply(null,t)}).catch(s.oe)}),m.removeListeners(),socket.on("event:topic_deleted",x),socket.on("event:topic_restored",x),socket.on("event:topic_purged",j),socket.on("event:topic_locked",P),socket.on("event:topic_unlocked",P),socket.on("event:topic_pinned",R),socket.on("event:topic_unpinned",R),socket.on("event:topic_moved",U)};function f(e,t,o,r){r||(r=function(){});const g=u.getSelectedTids(),k={},y=function(I){I&&Promise.all(g.map(Y=>p[e](`/topics/${Y}${t}`,k))).then(r).catch(a.error)};if(!g.length)return a.error("[[error:no-topics-selected]]");switch(o){case"delete":case"restore":case"purge":D.confirm(`[[topic:thread_tools.${o}_confirm]]`,y);break;case"pin":C.requestPinExpiry(k,y.bind(null,!0));break;default:y(!0);break}}m.removeListeners=function(){socket.removeListener("event:topic_deleted",x),socket.removeListener("event:topic_restored",x),socket.removeListener("event:topic_purged",j),socket.removeListener("event:topic_locked",P),socket.removeListener("event:topic_unlocked",P),socket.removeListener("event:topic_pinned",R),socket.removeListener("event:topic_unpinned",R),socket.removeListener("event:topic_moved",U)};function i(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function c(){i(),u.unselectAll()}function l(){i(),d()}function d(){const e=u.getSelectedTids(),t=A(M,e),o=S(M,e),r=A(W,e),g=A(B,e),k=A(K,e),y=S(K,e);n.get("topic/delete").toggleClass("hidden",t),n.get("topic/restore").toggleClass("hidden",k||!t),n.get("topic/purge").toggleClass("hidden",!o),n.get("topic/lock").toggleClass("hidden",g),n.get("topic/unlock").toggleClass("hidden",!g),n.get("topic/pin").toggleClass("hidden",y||r),n.get("topic/unpin").toggleClass("hidden",y||!r),n.get("topic/merge").toggleClass("hidden",k)}function A(e,t){for(let o=0;o<t.length;o+=1)if(e(t[o]))return!0;return!1}function S(e,t){for(let o=0;o<t.length;o+=1)if(!e(t[o]))return!1;return!0}function M(e){return h(e).hasClass("deleted")}function B(e){return h(e).hasClass("locked")}function W(e){return h(e).hasClass("pinned")}function K(e){return h(e).hasClass("scheduled")}function h(e){return n.get("category/topic","tid",e)}function x(e){const t=h(e.tid);t.toggleClass("deleted",e.isDeleted),t.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function R(e){const t=h(e.tid);t.toggleClass("pinned",e.isPinned),t.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned),ajaxify.refresh()}function P(e){const t=h(e.tid);t.toggleClass("locked",e.isLocked),t.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function U(e){h(e.tid).remove()}function j(e){h(e.tid).remove()}function F(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(t=>t.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const t=$('[component="category"]').filter(function(r,g){return!$(g).parents("[widget-area],[data-widget-area]").length});let o=0;t.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){o=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(r,g){socket.emit("topics.orderPinnedTopics",{tid:g.item.attr("data-tid"),order:o+g.item.index()},function(k){if(k)return a.error(k);t.find('[component="category/topic"].pinned').each((y,I)=>{$(I).attr("data-index",o+y)})})}})})}return m}.apply(L,E),v!==void 0&&(T.exports=v)},69941:(T,L,s)=>{var E,v;E=[s(7237)],v=function(u){const C={};let n,p;C.init=function(i){p=$('[component="category"]'),p.on("selectstart",'[component="topic/select"]',function(c){c.preventDefault()}),p.on("click",'[component="topic/select"]',function(c){const l=$(this);if(c.shiftKey)return a($(this).parents('[component="category/topic"]').attr("data-tid")),n=l,!1;const d=l.parents("[data-tid]").hasClass("selected");D(l,!d),n=l,typeof i=="function"&&i()})};function D(i,c){i.toggleClass("fa-check-square-o",c),i.toggleClass("fa-square-o",!c),i.parents('[component="category/topic"]').toggleClass("selected",c)}C.getSelectedTids=function(){const i=[];return p&&p.find('[component="category/topic"].selected').each(function(){i.push($(this).attr("data-tid"))}),i},C.unselectAll=function(){p&&(p.find('[component="category/topic"].selected').removeClass("selected"),p.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function a(i){n||(n=$('[component="category/topic"]').first().find('[component="topic/select"]'));const c=u.get("category/topic","tid",i).hasClass("selected"),l=f(i),d=f(n.parents('[component="category/topic"]').attr("data-tid"));m(l,d,!c)}function m(i,c,l){if(i>c){const d=i;i=c,c=d}for(let d=i;d<=c;d+=1){const A=$('[component="category/topic"]').eq(d);D(A.find('[component="topic/select"]'),l)}}function f(i){return u.get("category/topic","tid",i).index('[component="category/topic"]')}return C}.apply(L,E),v!==void 0&&(T.exports=v)}}]);
