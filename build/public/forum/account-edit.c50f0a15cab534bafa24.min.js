"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3692],{93318:(v,C,r)=>{var h,l;h=[r(59494),r(94039),r(32230),r(74344),r(85233),r(31369),r(7927)],l=function(g,y,x,p,d,b,s){const e={};e.init=function(){g.init(),$("#submitBtn").on("click",u),ajaxify.data.groupTitleArray.length===1&&ajaxify.data.groupTitleArray[0]===""&&$('#groupTitle option[value=""]').attr("selected",!0),f(),t(),i(),A(),k(),c()};function u(){const a=$('form[component="profile/edit/form"]').serializeObject();return a.uid=ajaxify.data.uid,a.groupTitle=a.groupTitle||"",a.groupTitle=JSON.stringify(Array.isArray(a.groupTitle)?a.groupTitle:[a.groupTitle]),d.fire("action:profile.update",a),p.put("/users/"+a.uid,a).then(o=>{s.success("[[user:profile_update_success]]"),o.picture&&$("#user-current-picture").attr("src",o.picture),y.updateHeader(o.picture)}).catch(s.error),!1}function f(){$("#changePictureBtn").on("click",function(){return y.openChangeModal(),!1})}function t(){$("#deleteAccountBtn").on("click",function(){return x.translate("[[user:delete_account_confirm]]",function(a){const o=b.confirm(a+'<p><input type="password" class="form-control" id="confirm-password" /></p>',function(j){if(!j)return;const n=o.find(".btn-primary");return n.html('<i class="fa fa-spinner fa-spin"></i>'),n.prop("disabled",!0),p.del(`/users/${ajaxify.data.uid}/account`,{password:$("#confirm-password").val()},function(E){function P(){x.translate("[[modules:bootbox.confirm]]",function(w){n.text(w),n.prop("disabled",!1)})}if(E)return P(),s.error(E);n.html('<i class="fa fa-check"></i>'),window.location.href=`${config.relative_path}/`}),!1});o.on("shown.bs.modal",function(){o.find("input").focus()})}),!1})}function i(){$("#confirm-email").on("click",function(){const a=$(this).attr("disabled",!0);socket.emit("user.emailConfirm",{},function(o){if(a.removeAttr("disabled"),o)return s.error(o);s.success("[[notifications:email-confirm-sent]]")})})}function m(a,o){return a.length?"("+a.val().length+"/"+o+")":""}function A(){const a=$("#signature");$("#signatureCharCountLeft").html(m(a,ajaxify.data.maximumSignatureLength)),a.on("keyup change",function(){$("#signatureCharCountLeft").html(m(a,ajaxify.data.maximumSignatureLength))})}function k(){const a=$("#aboutme");$("#aboutMeCharCountLeft").html(m(a,ajaxify.data.maximumAboutMeLength)),a.on("keyup change",function(){$("#aboutMeCharCountLeft").html(m(a,ajaxify.data.maximumAboutMeLength))})}function c(){function a(o){const j=$("#groupTitle").val();if(!ajaxify.data.allowMultipleBadges||Array.isArray(j)&&j.length>1)return;const n=$("#groupTitle").find(":selected");n.length&&n.val()&&(o>0?n.insertAfter(n.next()):n.prev().val()&&n.insertBefore(n.prev()))}$('[component="group/order/up"]').on("click",function(){a(-1)}),$('[component="group/order/down"]').on("click",function(){a(1)})}return e}.apply(C,h),l!==void 0&&(v.exports=l)},94039:(v,C,r)=>{var h,l;h=[r(98192),r(74344),r(31369),r(7927)],l=((g,y,x,p)=>{const d={};d.openChangeModal=()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(e,u){if(e)return p.error(e);const f=u.reduce(function(t,i){return t||i.type==="uploaded"},!1);app.parseAndTranslate("partials/modals/change_picture_modal",{pictures:u,uploaded:f,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:config.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},function(t){const i=x.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:t,show:!0,buttons:{close:{label:"[[global:close]]",callback:k,className:"btn-link"},update:{label:"[[global:save_changes]]",callback:A}}});i.on("shown.bs.modal",m),i.on("click",".list-group-item",function(){i.find(".list-group-item").removeClass("active"),$(this).addClass("active")}),i.on("change",'input[type="radio"][name="icon:bgColor"]',c=>{const a=c.target.value;i.find(".user-icon").css("background-color",a)}),b(i);function m(){ajaxify.data.picture?i.find(".list-group-item img").each(function(){this.getAttribute("src")===ajaxify.data.picture&&$(this).parents(".list-group-item").addClass("active")}):i.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active");const c=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);c?c.checked=!0:document.querySelector('.modal input[type="radio"]').checked=!0}function A(){const c=i.find(".list-group-item.active").attr("data-type"),a=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";s(c,a).then(()=>{d.updateHeader(c==="default"?"":i.find(".list-group-item.active img").attr("src"),a),ajaxify.refresh()}).catch(p.error)}function k(){i.modal("hide")}})})},d.updateHeader=(e,u)=>{parseInt(ajaxify.data.theirid,10)===parseInt(ajaxify.data.yourid,10)&&(!e&&ajaxify.data.defaultAvatar&&(e=ajaxify.data.defaultAvatar),$('#header [component="avatar/picture"]')[e?"show":"hide"](),$('#header [component="avatar/icon"]')[e?"hide":"show"](),e&&$('#header [component="avatar/picture"]').attr("src",e),u&&document.querySelectorAll('[component="navbar"] [component="avatar/icon"]').forEach(f=>{f.style["background-color"]=u}))};function b(e){function u(t){t=(t.startsWith("http")?"":config.relative_path)+t+"?"+Date.now(),d.updateHeader(t),ajaxify.data.picture&&ajaxify.data.picture.length?($("#user-current-picture, img.avatar").attr("src",t),ajaxify.data.uploadedpicture=t):ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",t)})}function f(){ajaxify.data.uploadedpicture===ajaxify.data.picture&&(ajaxify.refresh(),d.updateHeader())}e.find('[data-action="upload"]').on("click",function(){return e.modal("hide"),g.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:!1,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(t){u(t)}),!1}),e.find('[data-action="upload-url"]').on("click",function(){return e.modal("hide"),app.parseAndTranslate("partials/modals/upload_picture_from_url_modal",{},function(t){t.modal("show"),t.find(".upload-btn").on("click",function(){const i=t.find("#uploadFromUrl").val();return i&&(t.modal("hide"),g.handleImageCrop({url:i,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:!1,paramName:"uid",paramValue:ajaxify.data.theirid},u)),!1})}),!1}),e.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(t){if(e.modal("hide"),t)return p.error(t);f()})})}function s(e,u){return y.put(`/users/${ajaxify.data.theirid}/picture`,{type:e,bgColor:u})}return d}).apply(C,h),l!==void 0&&(v.exports=l)}}]);
