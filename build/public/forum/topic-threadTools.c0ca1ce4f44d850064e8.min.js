"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1375,8306],{60392:(E,I,l)=>{var k,p;k=[l(7237),l(32230),l(66044),l(60447),l(74344),l(85233),l(31369),l(7927)],p=function(n,s,c,y,f,v,A,g){const d={};d.init=function(e,o){m(o),o.on("click",'[component="topic/delete"]',function(){return a("del","/state","delete"),!1}),o.on("click",'[component="topic/restore"]',function(){return a("put","/state","restore"),!1}),o.on("click",'[component="topic/purge"]',function(){return a("del","","purge"),!1}),o.on("click",'[component="topic/lock"]',function(){return a("put","/lock","lock"),!1}),o.on("click",'[component="topic/unlock"]',function(){return a("del","/lock","unlock"),!1}),o.on("click",'[component="topic/pin"]',function(){return a("put","/pin","pin"),!1}),o.on("click",'[component="topic/unpin"]',function(){return a("del","/pin","unpin"),!1}),o.on("click",'[component="topic/event/delete"]',function(){const t=$(this).attr("data-topic-event-id"),r=$(this).parents('[component="topic/event"]');A.confirm("[[topic:delete-event-confirm]]",h=>{h&&f.del(`/topics/${e}/events/${t}`,{}).then(function(){r.remove()}).catch(g.error)})}),o.on("click",'[component="topic/mark-unread"]',function(){return socket.emit("topics.markUnread",e,function(t){if(t)return g.error(t);app.previousUrl&&!app.previousUrl.match("^/topic")?ajaxify.go(app.previousUrl,function(){c.onBackClicked(!0)}):ajaxify.data.category&&ajaxify.go("category/"+ajaxify.data.category.slug,c.onBackClicked),g.success("[[topic:mark_unread.success]]")}),!1}),o.on("click",'[component="topic/mark-unread-for-all"]',function(){const t=$(this);return socket.emit("topics.markAsUnreadForAll",[e],function(r){if(r)return g.error(r);g.success("[[topic:markAsUnreadForAll.success]]"),t.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")}),!1}),o.on("click",'[component="topic/move"]',function(){return l.e(7378).then(function(){var t=[l(57378)];(function(r){r.init([e],ajaxify.data.cid)}).apply(null,t)}).catch(l.oe),!1}),o.on("click",'[component="topic/delete/posts"]',function(){l.e(5253).then(function(){var t=[l(55253)];(function(r){r.init()}).apply(null,t)}).catch(l.oe)}),o.on("click",'[component="topic/fork"]',function(){l.e(5636).then(function(){var t=[l(25636)];(function(r){r.init()}).apply(null,t)}).catch(l.oe)}),o.on("click",'[component="topic/move-posts"]',function(){l.e(3094).then(function(){var t=[l(53094)];(function(r){r.init()}).apply(null,t)}).catch(l.oe)}),o.on("click",'[component="topic/following"]',function(){i("follow")}),o.on("click",'[component="topic/not-following"]',function(){i("follow",0)}),o.on("click",'[component="topic/ignoring"]',function(){i("ignore")});function i(t,r=1){return f[r?"put":"del"](`/topics/${e}/${t}`,{},()=>{let x="";t==="follow"?x=r?"[[topic:following_topic.message]]":"[[topic:not_following_topic.message]]":t==="ignore"&&(x=r?"[[topic:ignoring_topic.message]]":"[[topic:not_following_topic.message]]"),r||(t="unfollow"),u(t),g.alert({alert_id:"follow_thread",message:x,type:"success",timeout:5e3}),v.fire("action:topics.changeWatching",{tid:e,type:t})},()=>{g.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})}),!1}};function m(e){e.on("show.bs.dropdown",".thread-tools",function(){const i=$(this).find(".dropdown-menu");i.html()||(i.toggleClass("hidden",!0),socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},function(t,r){if(t)return g.error(t);app.parseAndTranslate("partials/topic/topic-menu-list",r,function(h){i.html(h),i.toggleClass("hidden",!1),v.fire("action:topic.tools.load",{element:i})})}))})}function a(e,o,i,t){t||(t=function(){});const r=ajaxify.data.tid,h={},x=function(w){w&&f[e](`/topics/${r}${o}`,h).then(t).catch(g.error)};switch(i){case"delete":case"restore":case"purge":A.confirm(`[[topic:thread_tools.${i}_confirm]]`,x);break;case"pin":d.requestPinExpiry(h,x.bind(null,!0));break;default:x(!0);break}}d.requestPinExpiry=function(e,o){app.parseAndTranslate("modals/set-pin-expiry",{},function(i){const t=A.dialog({title:"[[topic:thread_tools.pin]]",message:i,onEscape:!0,size:"small",buttons:{cancel:{label:"[[modules:bootbox.cancel]]",className:"btn-link"},save:{label:"[[global:save]]",className:"btn-primary",callback:function(){let h=t.get(0).querySelector("#expiry").value;if(h==="")return o();h=new Date(h),h&&h.getTime()>Date.now()?(e.expiry=h.getTime(),o()):g.error("[[error:invalid-date]]")}}}})})},d.setLockedState=function(e){const o=n.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;const i=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null),n.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",e.isLocked?null:"");const t=!!((e.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod);n.get("topic/reply/container").toggleClass("hidden",t),n.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",t),o.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",i),o.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",i),$('[component="topic/labels"] [component="topic/locked"]').toggleClass("hidden",!e.isLocked),$('[component="post/tools"] .dropdown-menu').html(""),ajaxify.data.locked=e.isLocked,y.addTopicEvents(e.events)},d.setDeleteState=function(e){const o=n.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;n.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null),n.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),n.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",e.isDelete?null:""),n.get("topic/deleted/message").toggleClass("hidden",!e.isDelete),e.isDelete&&app.parseAndTranslate("partials/topic/deleted-message",{deleter:e.user,deleted:!0,deletedTimestampISO:utils.toISOString(Date.now())},function(t){n.get("topic/deleted/message").replaceWith(t),t.find(".timeago").timeago()});const i=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;n.get("topic/reply/container").toggleClass("hidden",i),n.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete),o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",i),o.toggleClass("deleted",e.isDelete),ajaxify.data.deleted=e.isDelete?1:0,y.addTopicEvents(e.events)},d.setPinnedState=function(e){const o=n.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10))return;n.get("topic/pin").toggleClass("hidden",e.pinned).parent().attr("hidden",e.pinned?"":null),n.get("topic/unpin").toggleClass("hidden",!e.pinned).parent().attr("hidden",e.pinned?null:"");const i=$('[component="topic/labels"] [component="topic/pinned"]');i.toggleClass("hidden",!e.pinned),e.pinned&&i.translateAttr("title",e.pinExpiry&&e.pinExpiryISO?"[[topic:pinned-with-expiry, "+e.pinExpiryISO+"]]":"[[topic:pinned]]"),ajaxify.data.pinned=e.pinned,y.addTopicEvents(e.events)};function u(e){const o={follow:"[[topic:watching]]",unfollow:"[[topic:not-watching]]",ignore:"[[topic:ignoring]]"};s.translate(o[e],function(t){$('[component="topic/watch"] button').attr("title",t).tooltip("fixTitle")});let i=n.get("topic/following/menu");i.toggleClass("hidden",e!=="follow"),n.get("topic/following/check").toggleClass("fa-check",e==="follow"),i=n.get("topic/not-following/menu"),i.toggleClass("hidden",e!=="unfollow"),n.get("topic/not-following/check").toggleClass("fa-check",e==="unfollow"),i=n.get("topic/ignoring/menu"),i.toggleClass("hidden",e!=="ignore"),n.get("topic/ignoring/check").toggleClass("fa-check",e==="ignore")}return d}.apply(I,k),p!==void 0&&(E.exports=p)},66044:(E,I,l)=>{var k,p;k=[l(7237),l(66603),l(42840),l(78989)],p=function(n,s,c,y){const f={};let v;f.init=function(d){v=d,A(),$(window).off("action:popstate",g).on("action:popstate",g)},f.onBackClicked=g;function A(){$('[component="category"]').on("click",'[component="topic/header"]',function(){const d=$(this).parents("[data-index]").attr("data-index"),m=$(window).scrollTop();$('[component="category/topic"]').each(function(a,u){if($(u).offset().top-m>0)return s.setItem("category:bookmark",$(u).attr("data-index")),s.setItem("category:bookmark:clicked",d),s.setItem("category:bookmark:offset",$(u).offset().top-m),!1})})}function g(d){const m=d&&ajaxify.data.template.unread;if(ajaxify.data.template.category||ajaxify.data.template.recent||ajaxify.data.template.popular||m){let a=s.getItem("category:bookmark"),u=s.getItem("category:bookmark:clicked");if(s.removeItem("category:bookmark"),s.removeItem("category:bookmark:clicked"),!utils.isNumber(a))return;if(a=Math.max(0,parseInt(a,10)||0),u=Math.max(0,parseInt(u,10)||0),config.usePagination){const e=Math.ceil((parseInt(a,10)+1)/config.topicsPerPage);parseInt(e,10)!==ajaxify.data.pagination.currentPage?y.loadPage(e,function(){f.scrollToTopic(a,u)}):f.scrollToTopic(a,u)}else{if(a===0){f.scrollToTopic(a,u);return}$('[component="category"]').empty(),v(Math.max(0,a-1)+1,function(){f.scrollToTopic(a,u)})}}}return f.highlightTopic=function(d){const m=n.get("category/topic","index",d);m.length&&!m.hasClass("highlight")&&(m.addClass("highlight"),setTimeout(function(){m.removeClass("highlight")},5e3))},f.scrollToTopic=function(d,m){if(!utils.isNumber(d))return;const a=n.get("category/topic","index",d);if(a.length){const u=s.getItem("category:bookmark:offset");s.removeItem("category:bookmark:offset"),$(window).scrollTop(a.offset().top-u),f.highlightTopic(m),c.update()}},f}.apply(I,k),p!==void 0&&(E.exports=p)},66603:(E,I,l)=>{var k;k=function(){function p(){this._store={},this._keys=[]}p.prototype.isMock=!0,p.prototype.setItem=function(c,y){c=String(c),this._keys.indexOf(c)===-1&&this._keys.push(c),this._store[c]=y},p.prototype.getItem=function(c){return c=String(c),this._keys.indexOf(c)===-1?null:this._store[c]},p.prototype.removeItem=function(c){c=String(c),this._keys=this._keys.filter(function(y){return y!==c}),this._store[c]=null},p.prototype.clear=function(){this._keys=[],this._store={}},p.prototype.key=function(c){return c=parseInt(c,10)||0,this._keys[c]},Object.defineProperty&&Object.defineProperty(p.prototype,"length",{get:function(){return this._keys.length}});let n;const s=Date.now().toString();try{if(n=window.localStorage,n.setItem(s,s),n.getItem(s)!==s)throw Error("localStorage behaved unexpectedly");return n.removeItem(s),n}catch(c){console.warn(c),console.warn("localStorage failed, falling back on sessionStorage");try{if(n=window.sessionStorage,n.setItem(s,s),n.getItem(s)!==s)throw Error("sessionStorage behaved unexpectedly");return n.removeItem(s),n}catch(y){return console.warn(y),console.warn("sessionStorage failed, falling back on memory storage"),new p}}}.call(I,l,I,E),k!==void 0&&(E.exports=k)}}]);
