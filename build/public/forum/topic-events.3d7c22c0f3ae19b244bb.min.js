"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4781],{91748:(P,C,n)=>{var v,l;v=[n(54939),n(60392),n(60447),n(47720),n(7237),n(32230),n(59006),n(85233)],l=function(f,a,g,E,d,I,j,k){const c={},r={"event:user_status_change":S,"event:voted":b,"event:bookmarked":w,"event:topic_deleted":a.setDeleteState,"event:topic_restored":a.setDeleteState,"event:topic_purged":A,"event:topic_locked":a.setLockedState,"event:topic_unlocked":a.setLockedState,"event:topic_pinned":a.setPinnedState,"event:topic_unpinned":a.setPinnedState,"event:topic_moved":B,"event:post_edited":O,"event:post_purged":R,"event:post_deleted":h,"event:post_restored":h,"posts.bookmark":y,"posts.unbookmark":y,"posts.upvote":m,"posts.downvote":m,"posts.unvote":m,"event:new_notification":N,"event:new_post":g.onNewPost};c.init=function(){c.removeListeners();for(const t in r)r.hasOwnProperty(t)&&socket.on(t,r[t])},c.removeListeners=function(){for(const t in r)r.hasOwnProperty(t)&&socket.removeListener(t,r[t])};function S(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function b(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(i,u){return parseInt($(u).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),o=$('.reputation[data-uid="'+t.post.uid+'"]');e.html(t.post.votes).attr("data-votes",t.post.votes),o.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function w(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(e,o){return parseInt($(o).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function A(t){ajaxify.data.category&&ajaxify.data.category.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function B(t){t&&t.slug&&parseInt(t.tid,10)===parseInt(ajaxify.data.tid,10)&&ajaxify.go("topic/"+t.slug,null,!0)}function O(t){if(!t||!t.post||parseInt(t.post.tid,10)!==parseInt(ajaxify.data.tid,10))return;const e=d.get("post/content",t.post.pid).filter(function(s,p){return parseInt($(p).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),o=$('[data-pid="'+t.post.pid+'"] [component="post/editor"]').filter(function(s,p){return parseInt($(p).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}),i=d.get("topic/title"),u=d.get("navbar/title").find("span"),x=d.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(i.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const s="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:s},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+s),i.fadeOut(250,function(){i.html(t.topic.title).fadeIn(250)}),x.fadeOut(250,function(){x.html(t.topic.title).fadeIn(250)}),u.fadeOut(250,function(){u.html(t.topic.title).fadeIn(250)})}t.post.changed?e.fadeOut(250,function(){e.html(I.unescape(t.post.content)),e.find("img:not(.not-responsive)").addClass("img-responsive"),E.wrapImagesInLinks(e.parent()),g.addBlockquoteEllipses(e.parent()),e.fadeIn(250);const s={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",s,function(p){o.replaceWith(p),$('[data-pid="'+t.post.pid+'"] [component="post/editor"] .timeago').timeago(),k.fire("action:posts.edited",t)})}):k.fire("action:posts.edited",t),t.topic.tags&&t.topic.tagsupdated&&j.render("partials/topic/tags",{tags:t.topic.tags}).then(function(s){const p=$(".tags");p.fadeOut(250,function(){p.html(s).fadeIn(250)})}),f.removeMenu(d.get("post","pid",t.post.pid))}function R(t){!t||parseInt(t.tid,10)!==parseInt(ajaxify.data.tid,10)||(d.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),g.showBottomPostBar()}),ajaxify.data.postcount-=1,f.updatePostCount(ajaxify.data.postcount),n.e(1352).then(function(){var e=[n(21352)];(function(o){o.onPostPurged(t)}).apply(null,e)}).catch(n.oe))}function h(t){const e=d.get("post","pid",t.pid);if(!e.length)return;e.toggleClass("deleted");const o=e.hasClass("deleted");f.toggle(t.pid,o),!ajaxify.data.privileges.isAdminOrMod&&parseInt(t.uid,10)!==parseInt(app.user.uid,10)&&(e.find('[component="post/tools"]').toggleClass("hidden",o),o?e.find('[component="post/content"]').translateHtml("[[topic:post_is_deleted]]"):e.find('[component="post/content"]').html(I.unescape(t.content)))}function y(t){const e=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(o,i){return parseInt($(i).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)});e.length&&(e.attr("data-bookmarked",t.isBookmarked),e.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),e.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function m(t){const e=$('[data-pid="'+t.post.pid+'"]');e.find('[component="post/upvote"]').filter(function(o,i){return parseInt($(i).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("upvoted",t.upvote),e.find('[component="post/downvote"]').filter(function(o,i){return parseInt($(i).closest("[data-pid]").attr("data-pid"),10)===parseInt(t.post.pid,10)}).toggleClass("downvoted",t.downvote)}function N(t){const e=ajaxify.data.tid;t&&t.tid&&parseInt(t.tid,10)===parseInt(e,10)&&socket.emit("topics.markTopicNotificationsRead",[e])}return c}.apply(C,v),l!==void 0&&(P.exports=l)}}]);
