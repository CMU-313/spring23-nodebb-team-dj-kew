"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8709,1237],{4695:(p,g,r)=>{var f;f=function(){const s={},h={ignoring:1,notwatching:2,watching:3};s.initUnreadTopics=function(){const n=app.user.unreadData;function t(e){if(e&&e.posts&&e.posts.length&&n){const i=e.posts[0];if(parseInt(i.uid,10)===parseInt(app.user.uid,10)||!i.topic.isFollowing&&i.categoryWatchState!==h.watching)return;const a=i.topic.tid;(!n[""][a]||!n.new[a]||!n.watched[a]||!n.unreplied[a])&&d(a),n[""][a]||(o(""),n[""][a]=!0),i.isMain&&parseInt(i.uid,10)!==parseInt(app.user.uid,10)&&!n.new[a]&&(o("new"),n.new[a]=!0),parseInt(i.topic.postcount,10)<=1&&!n.unreplied[a]&&(o("unreplied"),n.unreplied[a]=!0),i.topic.isFollowing&&!n.watched[a]&&(o("watched"),n.watched[a]=!0)}}function o(e){const i="/unread"+(e?"?filter="+e:""),a=1+parseInt($('a[href="'+config.relative_path+i+'"].navigation-link i').attr("data-content"),10);l(i,a)}function d(e){$('[data-tid="'+e+'"]').addClass("unread")}$(window).on("action:ajaxify.end",function(){ajaxify.data.template.topic&&["","new","watched","unreplied"].forEach(function(e){delete n[e][ajaxify.data.tid]})}),socket.removeListener("event:new_post",t),socket.on("event:new_post",t),socket.removeListener("event:unread.updateCount",m),socket.on("event:unread.updateCount",m)};function m(n){l("/unread",n.unreadTopicCount),l("/unread?filter=new",n.unreadNewTopicCount),l("/unread?filter=watched",n.unreadWatchedTopicCount),l("/unread?filter=unreplied",n.unreadUnrepliedTopicCount)}function l(n,t){utils.isNumber(t)&&($('a[href="'+config.relative_path+n+'"].navigation-link i').toggleClass("unread-count",t>0).attr("data-content",t>99?"99+":t),$('#mobile-menu [data-unread-url="'+n+'"]').attr("data-content",t>99?"99+":t))}return s.updateUnreadTopicCount=l,s}.call(g,r,g,p),f!==void 0&&(p.exports=f)},73713:(p,g,r)=>{var f,s;f=[r(4695),r(69941),r(7237),r(14745),r(50548),r(7927)],s=function(h,m,l,n,t,o){const d={};d.init=function(){app.enterRoom("unread_topics"),e(),n.init("unread"),h.updateUnreadTopicCount("/"+ajaxify.data.selectedFilter.url,ajaxify.data.topicCount)};function e(){function u(){socket.emit("topics.markAllRead",function(c){if(c)return o.error(c);o.success("[[unread:topics_marked_as_read.success]]"),$('[component="category"]').empty(),$('[component="pagination"]').addClass("hidden"),$("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden")})}function C(){const c=m.getSelectedTids();c.length&&socket.emit("topics.markAsRead",c,function(y){if(y)return o.error(y);i(c)})}function E(c){function y(w){const k=[];return l.get("category/topic","cid",w).each(function(){k.push($(this).attr("data-tid"))}),k}const v=y(c);socket.emit("topics.markCategoryTopicsRead",c,function(w){if(w)return o.error(w);i(v)})}const T=t.init($('[component="category-selector"]'),{onSelect:function(c){T.selectCategory(0),c.cid==="all"?u():c.cid==="selected"?C():parseInt(c.cid,10)>0&&E(c.cid)},selectCategoryLabel:ajaxify.data.selectCategoryLabel||"[[unread:mark_as_read]]",localCategories:[{cid:"selected",name:"[[unread:selected]]",icon:""},{cid:"all",name:"[[unread:all]]",icon:""}]})}function i(u){a(u),o.success("[[unread:topics_marked_as_read.success]]"),$('[component="category"]').children().length||($("#category-no-topics").removeClass("hidden"),$(".markread").addClass("hidden"))}function a(u){for(let C=0;C<u.length;C+=1)l.get("category/topic","tid",u[C]).remove()}return d}.apply(g,f),s!==void 0&&(p.exports=s)},50548:(p,g,r)=>{var f,s;f=[r(22905),r(31369),r(85233)],s=function(h,m,l){const n={};return n.init=function(t,o){if(!t||!t.length)return;o=o||{};const d=o.onSelect||function(){};o.states=o.states||["watching","notwatching","ignoring"],o.template="partials/category-selector",l.fire("action:category.selector.options",{el:t,options:o}),h.init(t,o);const e={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const a=$(this);if(a.hasClass("disabled"))return!1;e.selectCategory(a.attr("data-cid")),d(e.selectedCategory)});const i=e.el.find('[component="category-selector-selected"]').html();return e.selectCategory=function(a){const u=e.el.find('[data-cid="'+a+'"]');e.selectedCategory={cid:a,name:u.attr("data-name")},u.length?e.el.find('[component="category-selector-selected"]').html(u.find('[component="category-markup"]').html()):e.el.find('[component="category-selector-selected"]').html(i)},e.getSelectedCategory=function(){return e.selectedCategory},e.getSelectedCid=function(){return e.selectedCategory?e.selectedCategory.cid:0},e},n.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(o){const d=m.dialog({title:t.title||"[[modules:composer.select_category]]",message:o,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:i}}}),e=n.init(d.find('[component="category-selector"]'),t);function i(a){return a.preventDefault(),e.selectedCategory&&(t.onSubmit(e.selectedCategory),d.modal("hide")),!1}t.openOnLoad&&d.on("shown.bs.modal",function(){d.find(".dropdown-toggle").dropdown("toggle")}),d.find("form").on("submit",i)})},n}.apply(g,f),s!==void 0&&(p.exports=s)}}]);
