"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4610,6503,3014,8786,8818],{54939:(N,j,a)=>{var x,y;x=[a(78942),a(42840),a(7237),a(32230),a(13578),a(74344),a(31369),a(7927),a(85233)],y=function(i,f,P,C,r,p,l,g,d){const m={};let E=!1;m.init=function(t){E=!1,v(),A(t),i.addShareHandlers(ajaxify.data.titleRaw),r.addVoteHandler(),m.updatePostCount(ajaxify.data.postcount)};function v(){$('[component="topic"]').on("show.bs.dropdown",".moderator-tools",function(){const t=$(this),o=t.find(".dropdown-menu");if(o.html())return;const e=t.parents("[data-pid]"),n=e.attr("data-pid"),s=parseInt(e.attr("data-index"),10);socket.emit("posts.loadPostTools",{pid:n,cid:ajaxify.data.cid},async(c,u)=>{if(c)return g.error(c);u.posts.display_move_tools=u.posts.display_move_tools&&s!==0;const h=await app.parseAndTranslate("partials/topic/post-menu-list",u),D=a(42152);o.html(h),o.get(0).classList.toggle("hidden",!1),new D("[data-clipboard-text]"),d.fire("action:post.tools.load",{element:o})})})}m.toggle=function(t,o){const e=P.get("post","pid",t);e.find('[component="post/quote"], [component="post/bookmark"], [component="post/reply"], [component="post/flag"], [component="user/chat"]').toggleClass("hidden",o),e.find('[component="post/delete"]').toggleClass("hidden",o).parent().attr("hidden",o?"":null),e.find('[component="post/restore"]').toggleClass("hidden",!o).parent().attr("hidden",o?null:""),e.find('[component="post/purge"]').toggleClass("hidden",!o).parent().attr("hidden",o?null:""),m.removeMenu(e)},m.removeMenu=function(t){t.find('[component="post/tools"] .dropdown-menu').html("")},m.updatePostCount=function(t){const o=P.get("topic/post-count");o.html(t).attr("title",t),utils.makeNumbersHumanReadable(o),f.setCount(t)};function A(t){const o=P.get("topic");K(),o.on("click",'[component="post/quote"]',function(){T($(this),t)}),o.on("click",'[component="post/reply"]',function(){R($(this),t)}),$(".topic").on("click",'[component="topic/reply"]',function(n){n.preventDefault(),R($(this),t)}),$(".topic").on("click",'[component="topic/reply-as-topic"]',function(){C.translate("[[topic:link_back, "+ajaxify.data.titleRaw+", "+config.relative_path+"/topic/"+ajaxify.data.slug+"]]",function(n){d.fire("action:composer.topic.new",{cid:ajaxify.data.cid,body:n})})}),o.on("click",'[component="post/bookmark"]',function(){return I($(this),w($(this),"data-pid"))}),o.on("click",'[component="post/upvote"]',function(){return r.toggleVote($(this),".upvoted",1)}),o.on("click",'[component="post/downvote"]',function(){return r.toggleVote($(this),".downvoted",-1)}),o.on("click",'[component="post/vote-count"]',function(){r.showVotes(w($(this),"data-pid"))}),o.on("click",'[component="post/flag"]',function(){const n=w($(this),"data-pid");a.e(1803).then(function(){var s=[a(41803)];(function(c){c.showFlagModal({type:"post",id:n})}).apply(null,s)}).catch(a.oe)}),o.on("click",'[component="post/flagUser"]',function(){const n=w($(this),"data-uid");a.e(1803).then(function(){var s=[a(41803)];(function(c){c.showFlagModal({type:"user",id:n})}).apply(null,s)}).catch(a.oe)}),o.on("click",'[component="post/flagResolve"]',function(){const n=$(this).attr("data-flagId");a.e(1803).then(function(){var s=[a(41803)];(function(c){c.resolve(n)}).apply(null,s)}).catch(a.oe)}),o.on("click",'[component="post/edit"]',function(){const n=$(this),s=parseInt(w(n,"data-timestamp"),10),c=parseInt(ajaxify.data.postEditDuration,10);e(c,s,"post-edit-duration-expired")&&d.fire("action:composer.post.edit",{pid:w(n,"data-pid")})}),config.enablePostHistory&&ajaxify.data.privileges["posts:history"]&&o.on("click",'[component="post/view-history"], [component="post/edit-indicator"]',function(){const n=$(this);a.e(4654).then(function(){var s=[a(34654)];(function(c){c.open(w(n,"data-pid"))}).apply(null,s)}).catch(a.oe)}),o.on("click",'[component="post/delete"]',function(){const n=$(this),s=parseInt(w(n,"data-timestamp"),10),c=parseInt(ajaxify.data.postDeleteDuration,10);e(c,s,"post-delete-duration-expired")&&B($(this))});function e(n,s,c){if(!ajaxify.data.privileges.isAdminOrMod&&n&&Date.now()-s>n*1e3){const u=Math.floor(n/86400),h=Math.floor(n%86400/3600),D=Math.floor(n%86400%3600/60),k=n%86400%3600%60;let S="[[error:"+c+", "+n+"]]";return u?h?S="[[error:"+c+"-days-hours, "+u+", "+h+"]]":S="[[error:"+c+"-days, "+u+"]]":h?D?S="[[error:"+c+"-hours-minutes, "+h+", "+D+"]]":S="[[error:"+c+"-hours, "+h+"]]":D&&(k?S="[[error:"+c+"-minutes-seconds, "+D+", "+k+"]]":S="[[error:"+c+"-minutes, "+D+"]]"),g.error(S),!1}return!0}o.on("click",'[component="post/restore"]',function(){B($(this))}),o.on("click",'[component="post/purge"]',function(){Q($(this))}),o.on("click",'[component="post/move"]',function(){const n=$(this);a.e(3094).then(function(){var s=[a(53094)];(function(c){c.init(n.parents("[data-pid]"))}).apply(null,s)}).catch(a.oe)}),o.on("click",'[component="post/change-owner"]',function(){const n=$(this);a.e(6111).then(function(){var s=[a(6111)];(function(c){c.init(n.parents("[data-pid]"))}).apply(null,s)}).catch(a.oe)}),o.on("click",'[component="post/ban-ip"]',function(){const n=$(this).attr("data-ip");socket.emit("blacklist.addRule",n,function(s){if(s)return g.error(s);g.success("[[admin/manage/blacklist:ban-ip]]")})}),o.on("click",'[component="post/chat"]',function(){Y($(this))})}async function R(t,o){const e=await M();b(async function(){let n=await U(t);(w(t,"data-uid")==="0"||!w(t,"data-userslug"))&&(n="");const s=t.is('[component="post/reply"]')?w(t,"data-pid"):null,c=!s||!e.pid||s===e.pid;e.text&&c?(n=n||e.username,d.fire("action:composer.addQuote",{tid:o,pid:s,topicName:ajaxify.data.titleRaw,username:n,text:e.text,selectedPid:e.pid})):d.fire("action:composer.post.new",{tid:o,pid:s,topicName:ajaxify.data.titleRaw,text:n?n+" ":$('[component="topic/quickreply/text"]').val()||""})})}async function T(t,o){const e=await M();b(async function(){const n=await U(t),s=w(t,"data-pid");function c(u){d.fire("action:composer.addQuote",{tid:o,pid:s,username:n,topicName:ajaxify.data.titleRaw,text:u})}if(e.text&&s&&s===e.pid)return c(e.text);socket.emit("posts.getRawPost",s,function(u,h){if(u)return g.error(u);c(h)})})}async function M(){let t="",o,e="";const n=window.getSelection?window.getSelection():document.selection.createRange(),s=$('[component="post"] [component="post/content"]');let c;if(s.each(function(u,h){n&&n.containsNode&&h&&n.containsNode(h,!0)&&(c=h)}),c){const u=document.createRange();u.selectNodeContents(c);const h=n.getRangeAt(0).cloneRange();h.compareBoundaryPoints(Range.START_TO_START,u)<0&&h.setStart(u.startContainer,u.startOffset),h.compareBoundaryPoints(Range.END_TO_END,u)>0&&h.setEnd(u.endContainer,u.endOffset),u.detach(),t=h.toString(),o=$(c).parents('[component="post"]').attr("data-pid"),e=await U($(c)),h.detach()}return{text:t,pid:o,username:e}}function I(t,o){const e=t.attr("data-bookmarked")==="false"?"put":"del";return p[e](`/posts/${o}/bookmark`,void 0,function(n){if(n)return g.error(n);const s=e==="put"?"bookmark":"unbookmark";d.fire(`action:post.${s}`,{pid:o})}),!1}function w(t,o){return t.parents("[data-pid]").attr(o)}function U(t){return new Promise(o=>{let e="";if(t.attr("component")==="topic/reply"){o(e);return}const n=t.parents("[data-pid]");if(n.length){Promise.all([a.e(2772),a.e(999)]).then(function(){var s=[a(22568)];(function(c){e=c(n.attr("data-username"),!0),e||(n.attr("data-uid")!=="0"?e="[[global:former_user]]":e="[[global:guest]]"),e&&e!=="[[global:former_user]]"&&e!=="[[global:guest]]"&&(e="@"+e),o(e)}).apply(null,s)}).catch(a.oe);return}o(e)})}function B(t){const o=w(t,"data-pid"),n=P.get("post","pid",o).hasClass("deleted")?"restore":"delete";O(n,o)}function Q(t){O("purge",w(t,"data-pid"))}async function O(t,o){({action:t}=await d.fire(`static:post.${t}`,{action:t,pid:o})),t&&l.confirm("[[topic:post_"+t+"_confirm]]",function(e){if(!e)return;const n=t==="purge"?"":"/state";p[t==="restore"?"put":"del"](`/posts/${o}${n}`).catch(g.error)})}function Y(t){const o=t.parents("[data-pid]");return a.e(3216).then(function(){var e=[a(93216)];(function(n){n.newChat(o.attr("data-uid"))}).apply(null,e)}).catch(a.oe),t.parents(".btn-group").find(".dropdown-toggle").click(),!1}function b(t){const o=Math.min(Date.now()-864e5*ajaxify.data.topicStaleDays,864e13);if(E||ajaxify.data.lastposttime>=o)return t();l.dialog({title:"[[topic:stale.title]]",message:"[[topic:stale.warning]]",buttons:{reply:{label:"[[topic:stale.reply_anyway]]",className:"btn-link",callback:function(){E=!0,t()}},create:{label:"[[topic:stale.create]]",className:"btn-primary",callback:function(){C.translate("[[topic:link_back, "+ajaxify.data.title+", "+config.relative_path+"/topic/"+ajaxify.data.slug+"]]",function(n){d.fire("action:composer.topic.new",{cid:ajaxify.data.cid,body:n,fromStaleTopic:!0})})}}}}).modal()}const W=utils.debounce(H,100);function K(){ajaxify.data.privileges["topics:reply"]&&(d.onPage("action:posts.loaded",F),$(document).off("selectionchange",W).on("selectionchange",W))}function H(){window.getSelection().toString()===""?$('[component="selection/tooltip"]').addClass("hidden"):F()}async function F(){let t=$('[component="selection/tooltip"]');if(t.addClass("hidden"),t.attr("data-ajaxify")==="1"){t.remove();return}const o=window.getSelection();if(o.focusNode&&o.type==="Range"&&ajaxify.data.template.topic){const e=$(o.focusNode),n=$(o.anchorNode),s=n.parents("[data-pid]").attr("data-pid"),c=e.parents("[data-pid]").attr("data-pid");if(s!==c||!e.parents('[component="post/content"]').length||!n.parents('[component="post/content"]').length)return;const u=e.parents("[data-pid]"),h=o.getRangeAt(0);if(!u.length||h.collapsed)return;const D=h.getClientRects(),k=D[D.length-1];t.length||(t=await app.parseAndTranslate("partials/topic/selection-tooltip",ajaxify.data),t.addClass("hidden").appendTo("body")),t.off("click").on("click",'[component="selection/tooltip/quote"]',function(){t.addClass("hidden"),T(u.find('[component="post/quote"]'),ajaxify.data.tid)}),t.removeClass("hidden"),$(window).one("action:ajaxify.start",function(){t.attr("data-ajaxify",1).addClass("hidden"),$(document).off("selectionchange",W)});const S=t.outerWidth(!0);t.css({top:k.bottom+$(window).scrollTop(),left:S>k.width?k.left:k.left+k.width-S})}}return m}.apply(j,x),y!==void 0&&(N.exports=y)},13578:(N,j,a)=>{var x,y;x=[a(7237),a(32230),a(74344),a(85233),a(31369),a(7927)],y=function(i,f,P,C,r,p){const l={};l.addVoteHandler=function(){i.get("topic").on("mouseenter",'[data-pid] [component="post/vote-count"]',g)};function g(m){m.stopPropagation();const E=$(this),v=E.parent();v.find(".tooltip").css("display","none");const A=v.parents("[data-pid]").attr("data-pid");return socket.emit("posts.getUpvoters",[A],function(R,T){if(R)return p.error(R);T.length&&d(E,T[0])}),!1}function d(m,E){function v(R){m.attr("title",R).tooltip("fixTitle").tooltip("show"),m.parent().find(".tooltip").css("display","")}let A=E.usernames.filter(R=>R!=="[[global:former_user]]");A.length&&(A.length+E.otherCount>6?(A=A.join(", ").replace(/,/g,"|"),f.translate("[[topic:users_and_others, "+A+", "+E.otherCount+"]]",function(R){R=R.replace(/\|/g,","),v(R)})):(A=A.join(", "),v(A)))}return l.toggleVote=function(m,E,v){const A=m.closest("[data-pid]"),T=A.find(E).length?"del":"put",M=A.attr("data-pid");return P[T](`/posts/${M}/vote`,{delta:v},function(I){if(I){if(!app.user.uid){ajaxify.go("login");return}return p.error(I)}C.fire("action:post.toggleVote",{pid:M,delta:v,unvote:T==="del"})}),!1},l.showVotes=function(m){socket.emit("posts.getVoters",{pid:m,cid:ajaxify.data.cid},function(E,v){if(E)return E.message==="[[error:no-privileges]]"?void 0:p.error(E);app.parseAndTranslate("partials/modals/votes_modal",v,function(A){const R=r.dialog({title:"[[global:voters]]",message:A,className:"vote-modal",show:!0});R.on("click",function(){R.modal("hide")})})})},l}.apply(j,x),y!==void 0&&(N.exports=y)},74344:(N,j,a)=>{var x,y;x=[a(85233)],y=(i=>{const f={},P=config.relative_path+"/api/v3";function C(r,p){r.url=r.url.startsWith("/api")?config.relative_path+r.url:P+r.url;async function l(g){({options:r}=await i.fire("filter:api.options",{options:r})),$.ajax(r).done(d=>{g(null,d&&d.hasOwnProperty("status")&&d.hasOwnProperty("response")?d.response:d||{})}).fail(d=>{let m;d.responseJSON&&(m=d.responseJSON.status&&d.responseJSON.status.message?d.responseJSON.status.message:d.responseJSON.error),g(new Error(m||d.statusText))})}if(typeof p=="function"){l(p);return}return new Promise((g,d)=>{l(function(m,E){m?d(m):g(E)})})}return f.get=(r,p,l)=>C({url:r+(p&&Object.keys(p).length?"?"+$.param(p):"")},l),f.head=(r,p,l)=>C({url:r+(p&&Object.keys(p).length?"?"+$.param(p):""),method:"head"},l),f.post=(r,p,l)=>C({url:r,method:"post",data:JSON.stringify(p||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},l),f.patch=(r,p,l)=>C({url:r,method:"patch",data:JSON.stringify(p||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},l),f.put=(r,p,l)=>C({url:r,method:"put",data:JSON.stringify(p||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},l),f.del=(r,p,l)=>C({url:r,method:"delete",data:JSON.stringify(p),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},l),f.delete=f.del,f}).apply(j,x),y!==void 0&&(N.exports=y)},7237:(N,j,a)=>{var x;x=function(){const y={};return y.core={"topic/teaser":function(i){return i?$('[component="category/topic"][data-tid="'+i+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(i,f){return $('[component="topic"][data-'+i+'="'+f+'"]')},post:function(i,f){return $('[component="post"][data-'+i+'="'+f+'"]')},"post/content":function(i){return $('[component="post"][data-pid="'+i+'"] [component="post/content"]')},"post/header":function(i){return $('[component="post"][data-pid="'+i+'"] [component="post/header"]')},"post/anchor":function(i){return $('[component="post"][data-index="'+i+'"] [component="post/anchor"]')},"post/vote-count":function(i){return $('[component="post"][data-pid="'+i+'"] [component="post/vote-count"]')},"post/bookmark-count":function(i){return $('[component="post"][data-pid="'+i+'"] [component="post/bookmark-count"]')},"user/postcount":function(i){return $('[component="user/postcount"][data-uid="'+i+'"]')},"user/reputation":function(i){return $('[component="user/reputation"][data-uid="'+i+'"]')},"category/topic":function(i,f){return $('[component="category/topic"][data-'+i+'="'+f+'"]')},"categories/category":function(i,f){return $('[component="categories/category"][data-'+i+'="'+f+'"]')},"chat/message":function(i){return $('[component="chat/message"][data-mid="'+i+'"]')},"chat/message/body":function(i){return $('[component="chat/message"][data-mid="'+i+'"] [component="chat/message/body"]')},"chat/recent/room":function(i){return $('[component="chat/recent/room"][data-roomid="'+i+'"]')}},y.get=function(){const i=Array.prototype.slice.call(arguments,1);return y.core[arguments[0]]&&i.length?y.core[arguments[0]].apply(this,i):$('[component="'+arguments[0]+'"]')},y}.call(j,a,j,N),x!==void 0&&(N.exports=x)},78942:(N,j,a)=>{var x,y;x=[a(85233)],y=function(i){const f={};f.addShareHandlers=function(r){const p=window.location.protocol+"//"+window.location.host;function l(g,d,m,E){return window.open(g+encodeURIComponent(p+config.relative_path+d),"_blank","width="+m+",height="+E+",scrollbars=no,status=no"),i.fire("action:share.open",{url:g,urlToPost:d}),!1}$("#content").off("shown.bs.dropdown",".share-dropdown").on("shown.bs.dropdown",".share-dropdown",function(){const g=$(this).find(".post-link");g.val(p+C($(this))),setTimeout(function(){g.putCursorAtEnd().select()},50)}),P(".post-link",function(g){return g.preventDefault(),!1}),P('[component="share/twitter"]',function(){return l("https://twitter.com/intent/tweet?text="+encodeURIComponent(r)+"&url=",C($(this)),550,420)}),P('[component="share/facebook"]',function(){return l("https://www.facebook.com/sharer/sharer.php?u=",C($(this)),626,436)}),i.fire("action:share.addHandlers",{openShare:l})};function P(r,p){$("#content").off("click",r).on("click",r,p)}function C(r){const p=parseInt(r.parents("[data-pid]").attr("data-pid"),10);return"/post"+(p?"/"+p:"")}return f}.apply(j,x),y!==void 0&&(N.exports=y)}}]);
