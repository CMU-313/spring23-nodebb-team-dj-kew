"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4422],{7217:(p,h,i)=>{var y,g;y=[i(25142),i(78942),i(42840),i(14745),i(69241),i(50548),i(85233),i(7927)],g=function(C,x,l,f,e,r,s,t){const o={};$(window).on("action:ajaxify.start",function(a,d){String(d.url).startsWith("category/")||l.disable()}),o.init=function(){const a=ajaxify.data.cid;app.enterRoom("category_"+a),x.addShareHandlers(ajaxify.data.name),f.init("category",E),e.handleSort("categoryTopicSort","category/"+ajaxify.data.slug),config.usePagination?l.disable():l.init('[component="category/topic"]',ajaxify.data.topic_count,o.toTop,o.toBottom,o.navigatorCallback),c(),m(a),S(),r.init($('[component="category-selector"]'),{privilege:"find",parentCid:ajaxify.data.cid,onSelect:function(d){ajaxify.go("/category/"+d.cid)}}),s.fire("action:topics.loaded",{topics:ajaxify.data.topics}),s.fire("action:category.loaded",{cid:ajaxify.data.cid})};function c(){let a=ajaxify.data.topicIndex;a&&utils.isNumber(a)&&(a=Math.max(0,parseInt(a,10)),a&&window.location.search.indexOf("page=")===-1&&l.scrollToElement($('[component="category/topic"][data-index="'+a+'"]'),!0,0))}function m(a){$('[component="category/watching"], [component="category/ignoring"], [component="category/notwatching"]').on("click",function(){const n=$(this).attr("data-state");socket.emit("categories.setWatchState",{cid:a,state:n},function(u){if(u)return t.error(u);$('[component="category/watching/menu"]').toggleClass("hidden",n!=="watching"),$('[component="category/watching/check"]').toggleClass("fa-check",n==="watching"),$('[component="category/notwatching/menu"]').toggleClass("hidden",n!=="notwatching"),$('[component="category/notwatching/check"]').toggleClass("fa-check",n==="notwatching"),$('[component="category/ignoring/menu"]').toggleClass("hidden",n!=="ignoring"),$('[component="category/ignoring/check"]').toggleClass("fa-check",n==="ignoring"),t.success("[[category:"+n+".message]]")})})}function S(){$('[component="category/load-more-subcategories"]').on("click",function(){const a=$(this);return socket.emit("categories.loadMoreSubCategories",{cid:ajaxify.data.cid,start:ajaxify.data.nextSubCategoryStart},function(d,n){if(d)return t.error(d);a.toggleClass("hidden",!n.length||n.length<ajaxify.data.subCategoriesPerPage),n.length&&app.parseAndTranslate("category","children",{children:n},function(u){u.find(".timeago").timeago(),$('[component="category/subcategory/container"]').append(u),utils.makeNumbersHumanReadable(u.find(".human-readable-number")),app.createUserTooltips(u),ajaxify.data.nextSubCategoryStart+=ajaxify.data.subCategoriesPerPage,ajaxify.data.subCategoriesLeft-=n.length,a.toggleClass("hidden",ajaxify.data.subCategoriesLeft<=0).translateText("[[category:x-more-categories, "+ajaxify.data.subCategoriesLeft+"]]")})}),!1})}o.toTop=function(){l.scrollTop(0)},o.toBottom=function(){socket.emit("categories.getTopicCount",ajaxify.data.cid,function(a,d){if(a)return t.error(a);l.scrollBottom(d-1)})},o.navigatorCallback=function(a,d){return d};function E(a,d,n){n=n||function(){},s.fire("action:topics.loading");const u=utils.params();C.loadMore("categories.loadMore",{cid:ajaxify.data.cid,after:a,direction:d,query:u,categoryTopicSort:config.categoryTopicSort},function(b,j){s.fire("action:topics.loaded",{topics:b.topics}),n(b,j)})}return o}.apply(h,y),g!==void 0&&(p.exports=g)},50548:(p,h,i)=>{var y,g;y=[i(22905),i(31369),i(85233)],g=function(C,x,l){const f={};return f.init=function(e,r){if(!e||!e.length)return;r=r||{};const s=r.onSelect||function(){};r.states=r.states||["watching","notwatching","ignoring"],r.template="partials/category-selector",l.fire("action:category.selector.options",{el:e,options:r}),C.init(e,r);const t={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const c=$(this);if(c.hasClass("disabled"))return!1;t.selectCategory(c.attr("data-cid")),s(t.selectedCategory)});const o=t.el.find('[component="category-selector-selected"]').html();return t.selectCategory=function(c){const m=t.el.find('[data-cid="'+c+'"]');t.selectedCategory={cid:c,name:m.attr("data-name")},m.length?t.el.find('[component="category-selector-selected"]').html(m.find('[component="category-markup"]').html()):t.el.find('[component="category-selector-selected"]').html(o)},t.getSelectedCategory=function(){return t.selectedCategory},t.getSelectedCid=function(){return t.selectedCategory?t.selectedCategory.cid:0},t},f.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(r){const s=x.dialog({title:e.title||"[[modules:composer.select_category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:o}}}),t=f.init(s.find('[component="category-selector"]'),e);function o(c){return c.preventDefault(),t.selectedCategory&&(e.onSubmit(t.selectedCategory),s.modal("hide")),!1}e.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",o)})},f}.apply(h,y),g!==void 0&&(p.exports=g)},69241:(p,h,i)=>{var y,g;y=[i(7237),i(74344)],g=function(C,x){const l={};return l.handleSort=function(f,e){const r=C.get("thread/sort");r.find("i").removeClass("fa-check"),r.find('a[data-sort="'+config[f]+'"]').find("i").addClass("fa-check"),$("body").off("click",'[component="thread/sort"] a').on("click",'[component="thread/sort"] a',function(){function t(c,m){config[f]=c;const S=decodeURIComponent($.param(m));ajaxify.go(e+(S?"?"+S:""))}const o=$(this).attr("data-sort");if(app.user.uid){const c={settings:{}};c.settings[f]=o,x.put(`/users/${app.user.uid}/settings`,c).then(()=>{t(o,utils.params())})}else{const c=utils.params();c.sort=o,t(o,c)}})},l}.apply(h,y),g!==void 0&&(p.exports=g)}}]);
