"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[6862,8306],{46862:(y,v,m)=>{var u,g;u=[m(7237),m(32230),m(59006),m(85233),m(31369),m(7927),m(44882),m(74344)],g=function(i,a,s,r,I,d,A,p){const o={};o.sendMessage=async function(e,t){let n=t.val(),c=t.attr("data-mid");if(!n.trim().length)return;t.val(""),t.removeAttr("data-mid"),o.updateRemainingLength(t.parent());const h={roomId:e,message:n,mid:c};r.fire("action:chat.sent",h),{roomId:e,message:n,mid:c}=await r.fire("filter:chat.send",h),c?p.put(`/chats/${e}/messages/${c}`,{message:n}).catch(k=>(t.val(n),t.attr("data-mid",c),o.updateRemainingLength(t.parent()),d.error(k))):p.post(`/chats/${e}`,{message:n}).catch(k=>(t.val(n),o.updateRemainingLength(t.parent()),k.message==="[[error:email-not-confirmed-chat]]"?A.showEmailConfirmWarning(k.message):d.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:k.message,type:"danger",timeout:1e4})))},o.updateRemainingLength=function(e){const t=e.find('[component="chat/input"]');e.find('[component="chat/message/length"]').text(t.val().length),e.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-t.val().length),r.fire("action:chat.updateRemainingLength",{parent:e})},o.appendChatMessage=function(e,t){const n=parseInt(e.find(".chat-message").last().attr("data-uid"),10),c=parseInt(e.find(".chat-message").last().attr("data-timestamp"),10);Array.isArray(t)||(t.newSet=n!==parseInt(t.fromuid,10)||parseInt(t.timestamp,10)>parseInt(c,10)+1e3*60*3),o.parseMessage(t,function(h){C(e,h)})};function C(e,t){const n=$(t),c=o.isAtBottom(e);n.appendTo(e),n.find(".timeago").timeago(),n.find("img:not(.not-responsive)").addClass("img-responsive"),c&&o.scrollToBottom(e),r.fire("action:chat.received",{messageEl:n})}o.parseMessage=function(e,t){function n(c){a.translate(c,t)}Array.isArray(e)?s.render("partials/chats/message"+(Array.isArray(e)?"s":""),{messages:e}).then(n):s.render("partials/chats/"+(e.system?"system-message":"message"),{messages:e}).then(n)},o.isAtBottom=function(e,t){if(e.length)return e[0].scrollHeight-(e.outerHeight()+e.scrollTop())<(t||100)},o.scrollToBottom=function(e){e&&e.length&&(e.scrollTop(e[0].scrollHeight-e.height()),e.parent().find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},o.toggleScrollUpAlert=function(e){const t=o.isAtBottom(e,300);e.parent().find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",t)},o.prepEdit=function(e,t,n){socket.emit("modules.chats.getRaw",{mid:t,roomId:n},function(c,h){if(c)return d.error(c);e.val().length===0&&(e.attr("data-mid",t).addClass("editing"),e.val(h).focus(),r.fire("action:chat.prepEdit",{inputEl:e,messageId:t,roomId:n}))})},o.addSocketListeners=function(){socket.removeListener("event:chats.edit",f),socket.on("event:chats.edit",f),socket.removeListener("event:chats.delete",l),socket.on("event:chats.delete",l),socket.removeListener("event:chats.restore",S),socket.on("event:chats.restore",S)};function f(e){e.messages.forEach(function(t){const n=parseInt(t.fromuid,10)===parseInt(app.user.uid,10);t.self=n?1:0,o.parseMessage(t,function(c){const h=i.get("chat/message",t.messageId);h.length&&(h.replaceWith(c),i.get("chat/message",t.messageId).find(".timeago").timeago())})})}function l(e){i.get("chat/message",e).toggleClass("deleted",!0).find('[component="chat/message/body"]').translateHtml("[[modules:chat.message-deleted]]")}function S(e){i.get("chat/message",e.messageId).toggleClass("deleted",!1).find('[component="chat/message/body"]').html(e.content)}return o.delete=function(e,t){a.translate("[[modules:chat.delete_message_confirm]]",function(n){I.confirm(n,function(c){c&&p.delete(`/chats/${t}/messages/${e}`,{}).then(()=>{i.get("chat/message",e).toggleClass("deleted",!0)}).catch(d.error)})})},o.restore=function(e,t){p.post(`/chats/${t}/messages/${e}`,{}).then(()=>{i.get("chat/message",e).toggleClass("deleted",!1)}).catch(d.error)},o}.apply(v,u),g!==void 0&&(y.exports=g)},44882:(y,v,m)=>{var u,g;u=[m(31369),m(32230),m(66603),m(7927),m(85233)],g=function(i,a,s,r,I){const d={};let A,p;d.show=function(){I.one("action:ajaxify.end",()=>{C(),o(),d.showEmailConfirmWarning()})},d.showEmailConfirmWarning=function(f){if(!config.emailPrompt||!app.user.uid||parseInt(s.getItem("email-confirm-dismiss"),10)===1)return;const l={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{s.setItem("email-confirm-dismiss",1)}};app.user.email?!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(l.message=f||"[[error:email-not-confirmed]]",l.clickfn=function(){r.remove("email_confirm"),ajaxify.go("/me/edit/email")},r.alert(l)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(l.message="[[error:email-not-confirmed-email-sent]]",r.alert(l)):(l.message="[[error:no-email-to-confirm]]",l.clickfn=function(){r.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},r.alert(l))};function o(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||s.getItem("cookieconsent")==="1"||(config.cookies.message=a.unescape(config.cookies.message),config.cookies.dismiss=a.unescape(config.cookies.dismiss),config.cookies.link=a.unescape(config.cookies.link),config.cookies.link_url=a.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(f){$(document.body).append(f),$(document.body).addClass("cookie-consent-open");const l=$(".cookie-consent");l.find("button").on("click",function(){s.setItem("cookieconsent","1"),l.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function C(){const f=utils.params({full:!0});A=f.has("loggedin"),p=f.get("register"),A&&(r.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),f.delete("loggedin")),p&&(i.alert({message:utils.escapeHTML(decodeURIComponent(p))}),f.delete("register")),f.has("lang")&&f.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${f.get("lang")}", but that is already the forum default language.`),f.delete("lang"));const l=f.toString();ajaxify.updateHistory(ajaxify.currentPage+(l?`?${l}`:"")+document.location.hash,!0)}return d.showInvalidSession=function(){i.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},d.showSessionMismatch=function(){i.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},d}.apply(v,u),g!==void 0&&(y.exports=g)},66603:(y,v,m)=>{var u;u=function(){function g(){this._store={},this._keys=[]}g.prototype.isMock=!0,g.prototype.setItem=function(s,r){s=String(s),this._keys.indexOf(s)===-1&&this._keys.push(s),this._store[s]=r},g.prototype.getItem=function(s){return s=String(s),this._keys.indexOf(s)===-1?null:this._store[s]},g.prototype.removeItem=function(s){s=String(s),this._keys=this._keys.filter(function(r){return r!==s}),this._store[s]=null},g.prototype.clear=function(){this._keys=[],this._store={}},g.prototype.key=function(s){return s=parseInt(s,10)||0,this._keys[s]},Object.defineProperty&&Object.defineProperty(g.prototype,"length",{get:function(){return this._keys.length}});let i;const a=Date.now().toString();try{if(i=window.localStorage,i.setItem(a,a),i.getItem(a)!==a)throw Error("localStorage behaved unexpectedly");return i.removeItem(a),i}catch(s){console.warn(s),console.warn("localStorage failed, falling back on sessionStorage");try{if(i=window.sessionStorage,i.setItem(a,a),i.getItem(a)!==a)throw Error("sessionStorage behaved unexpectedly");return i.removeItem(a),i}catch(r){return console.warn(r),console.warn("sessionStorage failed, falling back on memory storage"),new g}}}.call(v,m,v,y),u!==void 0&&(y.exports=u)}}]);
