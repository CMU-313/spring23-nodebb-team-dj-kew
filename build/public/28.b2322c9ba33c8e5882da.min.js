"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[28,7073],{90028:(k,b,p)=>{var C,m;C=[p(7073),p(7927),p(74344)],m=function(O,E,y){const g={};let t,d,e={};g.init=function(s){s=s||function(){},!t&&app.parseAndTranslate("partials/merge_topics_modal",{},function(r){t=r,$("body").append(t),d=t.find("#merge_topics_confirm"),t.find(".close,#merge_topics_cancel").on("click",f),$("#content").on("click",'[component="topic/select"]',o),i(),d.on("click",function(){c(d)}),O.enableQuickSearch({searchElements:{inputEl:t.find(".topic-search-input"),resultEl:t.find(".quick-search-container")},searchOptions:{in:"titles"}}),t.on("click","[data-tid]",function(){return $(this).attr("data-tid")&&g.addTopic($(this).attr("data-tid")),!1}),s()})},g.addTopic=function(s,r){r=r||function(){},y.get(`/topics/${s}`,{}).then(function(a){const u=a?a.title:"No title";e[s]?delete e[s]:e[s]=u,n(),i(),r()}).catch(E.error)};function o(s){if(!t)return;const r=$(this).parents('[component="category/topic"]').attr("data-tid");return g.addTopic(r),s.preventDefault(),s.stopPropagation(),!1}function c(s){s.attr("disabled",!0);const r=Object.keys(e),a={};t.find(".merge-main-topic-radio").is(":checked")?a.mainTid=t.find(".merge-main-topic-select").val():t.find(".merge-new-title-radio").is(":checked")&&(a.newTopicTitle=t.find(".merge-new-title-input").val()),socket.emit("topics.merge",{tids:r,options:a},function(u,l){if(s.removeAttr("disabled"),u)return E.error(u);ajaxify.go("/topic/"+l),f()})}function i(){if(!t)return;const s=Object.keys(e);s.sort(function(a,u){return a-u});const r=s.map(function(a){return{tid:a,title:e[a]}});s.length?app.parseAndTranslate("partials/merge_topics_modal",{config,topics:r},function(a){t.find(".topics-section").html(a.find(".topics-section").html()),t.find(".merge-main-topic-select").html(a.find(".merge-main-topic-select").html())}):t.find(".topics-section").translateHtml("[[error:no-topics-selected]]")}function n(){Object.keys(e).length?d.removeAttr("disabled"):d.attr("disabled",!0)}function f(){t&&(t.remove(),t=null),e={},$("#content").off("click",'[component="topic/select"]',o)}return g}.apply(b,C),m!==void 0&&(k.exports=m)},7073:(k,b,p)=>{var C,m;C=[p(32230),p(66603),p(85233),p(7927)],m=function(O,E,y,g){const t={current:{}};t.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"};const o=$("#search-button"),c=$("#search-fields"),i=$("#search-fields input"),n=$("#quick-search-container");$("#search-form .advanced-search-link").off("mousedown").on("mousedown",function(){ajaxify.go("/search")}),$("#search-form").off("submit").on("submit",function(){i.blur()}),i.off("blur").on("blur",function(){setTimeout(function(){i.is(":focus")||(c.addClass("hidden"),o.removeClass("hidden"))},200)}),i.off("focus");const f={inputEl:i,resultEl:n};t.enableQuickSearch({searchOptions:e,searchElements:f}),o.off("click").on("click",function(s){return!config.loggedIn&&!app.user.privileges["search:content"]?(g.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(s.stopPropagation(),t.showAndFocusInput(),!1)}),$("#search-form").off("submit").on("submit",function(){const s=$(this).find("input"),r=t.getSearchPreferences();return r.term=s.val(),r.in=e.in,y.fire("action:search.submit",{searchOptions:r,searchElements:f}),t.query(r,function(){s.val("")}),!1})},t.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const o=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),c=e.searchElements.resultEl,i=e.searchElements.inputEl;let n=i.val();const f=c.find(".filter-category");function s(){ajaxify.data.template.category&&ajaxify.data.cid&&O.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(l){const h=$("<div></div>").html(l).text();f.find(".name").text(h)}),f.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function r(){e.searchOptions=Object.assign({},o),e.searchOptions.term=i.val(),s(),ajaxify.data.template.category&&ajaxify.data.cid&&f.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),c.removeClass("hidden").find(".quick-search-results-container").html(""),c.find(".loading-indicator").removeClass("hidden"),y.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,t.api(e.searchOptions,function(l){if(c.find(".loading-indicator").addClass("hidden"),!l.posts||e.hideOnNoMatches&&!l.posts.length)return c.addClass("hidden").find(".quick-search-results-container").html("");l.posts.forEach(function(h){const v=$("<div>"+h.content+"</div>").text(),A=i.val().toLowerCase().replace(/^in:topic-\d+/,""),x=Math.max(0,v.toLowerCase().indexOf(A)-40);h.snippet=utils.escapeHTML((x>0?"...":"")+v.slice(x,x+80)+(v.length-x>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",l,function(h){h.length&&h.find(".timeago").timeago(),c.toggleClass("hidden",!h.length||!i.is(":focus")).find(".quick-search-results-container").html(h.length?h:"");const v=c.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");t.highlightMatches(e.searchOptions.term,v),y.fire("action:search.quick.complete",{data:l,options:e})})})}c.find('.filter-category input[type="checkbox"]').on("change",function(){i.focus(),r()}),i.off("keyup").on("keyup",utils.debounce(function(){if(i.val().length<3){c.addClass("hidden"),n=i.val();return}if(i.val()!==n){if(n=i.val(),!i.is(":focus"))return c.addClass("hidden");r()}},500));let a=!1;c.on("mousedown",function(){$(window).one("mouseup",function(){c.addClass("hidden")}),a=!0}),i.on("blur",function(){!i.is(":focus")&&!a&&!c.hasClass("hidden")&&c.addClass("hidden")});let u=!1;y.on("action:ajaxify.end",function(){ajaxify.isCold()||(u=!0)}),i.on("focus",function(){a=!1;const l=i.val();n=l,l&&c.find("#quick-search-results").children().length&&(s(),u?(r(),u=!1):c.removeClass("hidden"),i[0].setSelectionRange(l.startsWith("in:topic")?l.indexOf(" ")+1:0,l.length))}),i.off("refresh").on("refresh",function(){r()})},t.showAndFocusInput=function(){$("#search-fields").removeClass("hidden"),$("#search-button").addClass("hidden"),$("#search-fields input").focus()},t.query=function(e,o){o=o||function(){},ajaxify.go("search?"+d(e)),o()},t.api=function(e,o){const c=config.relative_path+"/api/search?"+d(e);e.searchOnly=void 0;const i=config.relative_path+"/search?"+d(e);$.get(c,function(n){n.url=i,o(n)})};function d(e){const o=e.in||"titles",c=e.by||"";let i=e.term.replace(/^[ ?#]*/,"");try{i=encodeURIComponent(i)}catch{return g.error("[[error:invalid-search-term]]")}const n={term:i,in:o};return e.matchWords&&(n.matchWords=e.matchWords),c&&c.length&&(o==="posts"||o==="titles"||o==="titlesposts")&&(n.by=c),e.categories&&e.categories.length&&(n.categories=e.categories,e.searchChildren&&(n.searchChildren=e.searchChildren)),e.hasTags&&e.hasTags.length&&(n.hasTags=e.hasTags),parseInt(e.replies,10)>0&&(n.replies=e.replies,n.repliesFilter=e.repliesFilter||"atleast"),e.timeRange&&(n.timeRange=e.timeRange,n.timeFilter=e.timeFilter||"newer"),e.sortBy&&(n.sortBy=e.sortBy,n.sortDirection=e.sortDirection),e.showAs&&(n.showAs=e.showAs),e.searchOnly&&(n.searchOnly=e.searchOnly),y.fire("action:search.createQueryString",{query:n,data:e}),decodeURIComponent($.param(n))}return t.getSearchPreferences=function(){try{return JSON.parse(E.getItem("search-preferences")||"{}")}catch{return{}}},t.highlightMatches=function(e,o){if(!e||!o.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const c=e.split(" ").map(function(n){return utils.escapeRegexChars(n)}).join("|"),i=new RegExp("("+c+")","gi");o.each(function(){const n=$(this),f=[];n.find("*").each(function(){$(this).after("<!-- "+f.length+" -->"),f.push($("<div></div>").append($(this)))}),n.html(n.html().replace(i,function(s,r){return'<strong class="search-match">'+r+"</strong>"})),f.forEach(function(s,r){n.html(n.html().replace("<!-- "+r+" -->",function(){return s.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-responsive")},t}.apply(b,C),m!==void 0&&(k.exports=m)}}]);
