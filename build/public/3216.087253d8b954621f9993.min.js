"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3216,3034],{93216:(g,x,c)=>{var A,p;A=[c(7237),c(27145),c(32230),c(85233),c(31369),c(7927),c(74344)],p=function(E,f,h,d,C,l,I){const o={};let n=!1;o.openChat=function(t,e){if(!app.user.uid)return l.error("[[error:not-logged-in]]");function a(s){o.load(s.attr("data-uuid")),o.center(s),o.focusInput(s)}o.modalExists(t)?a(o.getModal(t)):I.get(`/chats/${t}`,{uid:e||app.user.uid}).then(s=>{s.users=s.users.filter(function(u){return u&&parseInt(u.uid,10)!==parseInt(app.user.uid,10)}),s.uid=e||app.user.uid,s.isSelf=!0,o.createModal(s,a)}).catch(l.error)},o.newChat=function(t,e){function a(){I.post("/chats",{uids:[t]}).then(({roomId:s})=>{ajaxify.data.template.chats?ajaxify.go("chats/"+s):o.openChat(s),e(null,s)}).catch(l.error)}if(e=e||function(){},!app.user.uid)return l.error("[[error:not-logged-in]]");if(parseInt(t,10)===parseInt(app.user.uid,10))return l.error("[[error:cant-chat-with-yourself]]");socket.emit("modules.chats.isDnD",t,function(s,u){if(s)return l.error(s);if(!u)return a();C.confirm("[[modules:chat.confirm-chat-with-dnd-user]]",function(m){m&&a()})})},o.loadChatsDropdown=function(t){socket.emit("modules.chats.getRecentChats",{uid:app.user.uid,after:0},function(e,a){if(e)return l.error(e);const s=a.rooms.filter(function(u){return u.teaser});h.toggleTimeagoShorthand(function(){for(let u=0;u<s.length;u+=1)s[u].teaser.timeago=$.timeago(new Date(parseInt(s[u].teaser.timestamp,10)));h.toggleTimeagoShorthand(),app.parseAndTranslate("partials/chats/dropdown",{rooms:s},function(u){t.find("*").not(".navigation-link").remove(),t.prepend(u),app.createUserTooltips(t,"right"),t.off("click").on("click","[data-roomid]",function(m){if($(m.target).parents(".user-link").length)return;const i=$(this).attr("data-roomid");ajaxify.currentPage.match(/^chats\//)?ajaxify.go("user/"+app.user.userslug+"/chats/"+i):o.openChat(i)}),$('[component="chats/mark-all-read"]').off("click").on("click",function(){socket.emit("modules.chats.markAllRead",function(m){if(m)return l.error(m)})})})})})},o.onChatMessageReceived=function(t){const e=t.self===1;t.message.self=t.self,n=t.self===0,o.modalExists(t.roomId)?r(t):ajaxify.data.template.chats||I.get(`/chats/${t.roomId}`,{}).then(a=>{a.users=a.users.filter(function(s){return s&&parseInt(s.uid,10)!==parseInt(app.user.uid,10)}),a.silent=!0,a.uid=app.user.uid,a.isSelf=e,o.createModal(a)}).catch(l.error)};function r(t){const e=o.getModal(t.roomId),a=t.message.fromUser.username,s=t.self===1;c.e(6862).then(function(){var u=[c(46862)];(function(m){e.find('[data-mid="'+t.message.messageId+'"]').length||m.appendChatMessage(e.find(".chat-content"),t.message),e.is(":visible")?(f.updateActive(e.attr("data-uuid")),m.isAtBottom(e.find(".chat-content"))&&m.scrollToBottom(e.find(".chat-content"))):ajaxify.data.template.chats||o.toggleNew(e.attr("data-uuid"),!0,!0),!s&&(!e.is(":visible")||!app.isFocused)&&f.push("chat",e.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||a),touid:t.message.fromUser.uid,roomId:t.roomId,isSelf:!1})}).apply(null,u)}).catch(c.oe)}return o.onUserStatusChange=function(t){const e=o.getModal(t.uid);app.updateUserStatus(e.find('[component="user/status"]'),t.status)},o.onRoomRename=function(t){const e=$("<div></div>").html(t.newName).text(),a=o.getModal(t.roomId);a.find('[component="chat/room/name"]').text(e),f.update("chat",a.attr("data-uuid"),{title:e}),d.fire("action:chat.renamed",Object.assign(t,{modal:a}))},o.getModal=function(t){return $("#chat-modal-"+t)},o.modalExists=function(t){return $("#chat-modal-"+t).length!==0},o.createModal=function(t,e){e=e||function(){},Promise.all([c.e(2441),c.e(4074),c.e(524),c.e(9789)]).then(function(){var a=[c(75203),c(30524),c(46862)];(function(s,u,m){app.parseAndTranslate("chat",t,function(i){if(o.modalExists(t.roomId))return e(o.getModal(t.roomId));const y=utils.generateUUID();let R=!1;i.attr("id","chat-modal-"+t.roomId),i.attr("data-roomid",t.roomId),i.attr("intervalId",0),i.attr("data-uuid",y),i.css("position","fixed"),i.appendTo($("body")),i.find(".timeago").timeago(),o.center(i),app.loadJQueryUI(function(){i.find(".modal-content").resizable({handles:"n, e, s, w, se",minHeight:250,minWidth:400}),i.find(".modal-content").on("resize",function(v,B){B.originalSize.height!==B.size.height&&i.find(".modal-body").css("height",o.calculateChatListHeight(i))}),i.draggable({start:function(){f.updateActive(y)},stop:function(){o.focusInput(i)},distance:10,handle:".modal-header"})}),s.apply(i.find('[component="chat/messages"]')),i.find("#chat-close-btn").on("click",function(){o.close(i)});function b(){const v=E.get("chat/input").val();$(window).one("action:ajaxify.end",function(){E.get("chat/input").val(v)}),ajaxify.go("user/"+app.user.userslug+"/chats/"+i.attr("data-roomid")),o.close(i)}i.find(".modal-header").on("dblclick",b),i.find('button[data-action="maximize"]').on("click",b),i.find('button[data-action="minimize"]').on("click",function(){const v=i.attr("data-uuid");o.minimize(v)}),i.on("mouseup",function(){f.updateActive(i.attr("data-uuid")),R&&(R=!1)}),i.on("mousemove",function(v){v.which===1&&(R=!0)}),i.on("mousemove keypress click",function(){n&&(socket.emit("modules.chats.markRead",t.roomId),n=!1)}),u.addActionHandlers(i.find('[component="chat/messages"]'),t.roomId),u.addRenameHandler(i.attr("data-roomid"),i.find('[data-action="rename"]'),t.roomName),u.addLeaveHandler(i.attr("data-roomid"),i.find('[data-action="leave"]')),u.addSendHandlers(i.attr("data-roomid"),i.find(".chat-input"),i.find('[data-action="send"]')),u.addMemberHandler(i.attr("data-roomid"),i.find('[data-action="members"]')),u.createAutoComplete(i.find('[component="chat/input"]')),u.addScrollHandler(i.attr("data-roomid"),t.uid,i.find(".chat-content")),u.addScrollBottomHandler(i.find(".chat-content")),u.addCharactersLeftHandler(i),u.addIPHandler(i),u.addUploadHandler({dragDropAreaEl:i.find(".modal-content"),pasteEl:i,uploadFormEl:i.find('[component="chat/upload"]'),inputEl:i.find('[component="chat/input"]')}),m.addSocketListeners(),f.push("chat",i.attr("data-uuid"),{title:"[[modules:chat.chatting_with]] "+(t.roomName||(t.users.length?t.users[0].username:"")),roomId:t.roomId,icon:"fa-comment",state:"",isSelf:t.isSelf},function(){f.toggleNew(i.attr("data-uuid"),!t.isSelf),d.fire("action:chat.loaded",i),typeof e=="function"&&e(i)})})}).apply(null,a)}).catch(c.oe)},o.focusInput=function(t){setTimeout(function(){t.find('[component="chat/input"]').focus()},20)},o.close=function(t){const e=t.attr("data-uuid");clearInterval(t.attr("intervalId")),t.attr("intervalId",0),t.remove(),t.data("modal",null),f.discard("chat",e),t.attr("data-mobile")&&o.disableMobileBehaviour(t),d.fire("action:chat.closed",{uuid:e,modal:t})},o.closeByUUID=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');o.close(e)},o.center=function(t){let e=!1;return t.hasClass("hide")&&(t.removeClass("hide"),e=!0),t.css("left",Math.max(0,($(window).width()-$(t).outerWidth())/2+$(window).scrollLeft())+"px"),t.css("top",Math.max(0,$(window).height()/2-$(t).outerHeight()/2)+"px"),e&&t.addClass("hide"),t},o.load=function(t){c.e(6862).then(function(){var e=[c(46862)];(function(a){const s=$('.chat-modal[data-uuid="'+t+'"]');s.removeClass("hide"),f.updateActive(t),a.scrollToBottom(s.find(".chat-content")),o.focusInput(s),socket.emit("modules.chats.markRead",s.attr("data-roomid"));const u=utils.findBootstrapEnvironment();(u==="xs"||u==="sm")&&o.enableMobileBehaviour(s)}).apply(null,e)}).catch(c.oe)},o.enableMobileBehaviour=function(t){app.toggleNavbar(!1),t.attr("data-mobile","1");const e=t.find(".modal-body");e.css("height",o.calculateChatListHeight(t));function a(){e.css("height",o.calculateChatListHeight(t)),c.e(6862).then(function(){var s=[c(46862)];(function(u){u.scrollToBottom(t.find(".chat-content"))}).apply(null,s)}).catch(c.oe)}$(window).on("resize",a),$(window).one("action:ajaxify.start",function(){o.close(t),$(window).off("resize",a)})},o.disableMobileBehaviour=function(){app.toggleNavbar(!0)},o.calculateChatListHeight=function(t){return t.find(".modal-content").outerHeight()-t.find(".modal-header").outerHeight()},o.minimize=function(t){const e=$('.chat-modal[data-uuid="'+t+'"]');e.addClass("hide"),f.minimize("chat",t),clearInterval(e.attr("intervalId")),e.attr("intervalId",0),d.fire("action:chat.minimized",{uuid:t,modal:e})},o.toggleNew=f.toggleNew,o}.apply(x,A),p!==void 0&&(g.exports=p)},27145:(g,x,c)=>{g=c.nmd(g);var A,p;A=[c(59006),c(32230),c(85233)],p=function(E,f,h){const d={};d.init=function(){const n=this;E.render("modules/taskbar",{}).then(function(r){n.taskbar=$(r),n.tasklist=n.taskbar.find("ul"),$(document.body).append(n.taskbar),n.taskbar.on("click","li",async function(){const t=$(this),e=t.attr("data-module"),a=t.attr("data-uuid"),s=await app.require(e);return t.hasClass("active")?s.minimize(a):(l(),s.load(a),d.toggleNew(a,!1),d.tasklist.removeClass("active"),t.addClass("active")),!1})}),$(window).on("action:app.loggedOut",function(){d.closeAll()})},d.close=async function(n,r){const t=d.tasklist.find('[data-module="'+g+'"][data-uuid="'+r+'"]');let e="close";if(n==="chat"&&(e="closeByUUID"),t.length){const a=await app.require(n);a&&typeof a[e]=="function"&&a[e](r)}},d.closeAll=function(n){let r="[data-uuid]";n&&(r='[data-module="'+n+'"]'+r),d.tasklist.find(r).each(function(t,e){d.close(n||e.getAttribute("data-module"),e.getAttribute("data-uuid"))})},d.discard=function(n,r){d.tasklist.find('[data-module="'+n+'"][data-uuid="'+r+'"]').remove(),C()},d.push=function(n,r,t,e){e=e||function(){};const a=d.tasklist.find('li[data-uuid="'+r+'"]'),s={module:n,uuid:r,options:t,element:a};h.fire("filter:taskbar.push",s),!a.length&&s.module?I(s,e):e(a)},d.get=function(n){return $('[data-module="'+n+'"]').map(function(t,e){return $(e).data()})},d.minimize=function(n,r){d.tasklist.find('[data-module="'+n+'"][data-uuid="'+r+'"]').toggleClass("active",!1)},d.toggleNew=function(n,r,t){d.tasklist.find('[data-uuid="'+n+'"]').toggleClass("new",r),t||h.fire("action:taskbar.toggleNew",n)},d.updateActive=function(n){const r=d.tasklist.find("li");r.removeClass("active"),r.filter('[data-uuid="'+n+'"]').addClass("active"),$("[data-uuid]:not([data-module])").toggleClass("modal-unfocused",!0),$('[data-uuid="'+n+'"]:not([data-module])').toggleClass("modal-unfocused",!1)},d.isActive=function(n){return d.tasklist.find('li[data-uuid="'+n+'"]').hasClass("active")};function C(){d.tasklist.find("li").length>0?d.taskbar.attr("data-active","1"):d.taskbar.removeAttr("data-active")}function l(){d.tasklist.find(".active").removeClass("active")}function I(n,r){f.translate(n.options.title,function(t){const e=$("<div></div>").text(t||"NodeBB Task").html(),a=$("<li></li>").addClass(n.options.className).html('<a href="#"'+(n.options.image?` style="background-image: url('`+n.options.image.replace(/&#x2F;/g,"/")+`'); background-size: cover;"`:"")+">"+(n.options.icon?'<i class="fa '+n.options.icon+'"></i> ':"")+'<span aria-label="'+e+'" component="taskbar/title">'+e+"</span></a>").attr({title:e,"data-module":n.module,"data-uuid":n.uuid}).addClass(n.options.state!==void 0?n.options.state:"active");(!n.options.state||n.options.state==="active")&&l(),d.tasklist.append(a),C(),n.element=a,a.data(n),h.fire("action:taskbar.pushed",n),r(a)})}const o=function(n,r,t){switch(r){case"title":n.find('[component="taskbar/title"]').text(t);break;case"icon":n.find("i").attr("class","fa fa-"+t);break;case"image":n.find("a").css("background-image",t?'url("'+t.replace(/&#x2F;/g,"/")+'")':"");break;case"background-color":n.find("a").css("background-color",t);break}};return d.update=function(n,r,t){const e=d.tasklist.find('[data-module="'+n+'"][data-uuid="'+r+'"]');if(!e.length)return;const a=e.data();Object.keys(t).forEach(function(s){a[s]=t[s],o(e,s,t[s])}),e.data(a)},d}.apply(x,A),p!==void 0&&(g.exports=p)}}]);
