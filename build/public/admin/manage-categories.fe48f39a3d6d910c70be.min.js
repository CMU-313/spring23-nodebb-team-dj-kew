"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8996,7214,9617,6503,3014,6623,9286,8786,5655,831],{60286:(v,S,m)=>{var y,f;y=[m(32230),m(59006),m(50548),m(74344),m(51474),m(31369),m(7927)],f=function(o,u,h,c,e,s,n){e=e.default;const r={};let t=-1,a;r.init=function(){h.init($('.category [component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(i){ajaxify.go("/admin/manage/categories"+(i.cid?"?cid="+i.cid:""))},localCategories:[]}),r.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",r.throwCreateModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const i=$(this),g=i.attr("data-disable-cid"),E=i.parents('li[data-cid="'+g+'"]'),b=E.hasClass("disabled"),p=E.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();r.toggle([g].concat(p),!b)}),$(".categories").on("click",".toggle",function(){const i=$(this);i.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),i.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const i=$(this).attr("data-cid"),g=$(this).attr("data-order"),E=s.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+g+' /><p class="help-block">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const b=E.find("input").val();if(b&&i){const A={};A[i]={order:Math.max(1,parseInt(b,10))},c.put("/categories/"+i,A[i]).then(function(){ajaxify.refresh()}).catch(n.error)}else return!1}}}})}),$("#collapse-all").on("click",function(){d(!1)}),$("#expand-all").on("click",function(){d(!0)});function d(i){const g=$(".categories .toggle");g.find("i").toggleClass("fa-chevron-down",i).toggleClass("fa-chevron-right",!i),g.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!i)}},r.throwCreateModal=function(){u.render("admin/partials/categories/create",{}).then(function(d){const i=s.dialog({title:"[[admin/manage/categories:alert.create]]",message:d,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:A}}}),g={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}]},E=h.init(i.find('#parentCidGroup [component="category-selector"]'),g),b=h.init(i.find('#cloneFromCidGroup [component="category-selector"]'),g);function A(){const p=i.find("form").serializeObject();return p.description="",p.icon="fa-comments",p.uid=app.user.uid,p.parentCid=E.getSelectedCid(),p.cloneFromCid=b.getSelectedCid(),r.create(p),i.modal("hide"),!1}$("#cloneChildren").on("change",function(){const p=$(this),_=i.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');p.prop("checked")?(_.attr("disabled","disabled"),E.selectCategory(0)):_.removeAttr("disabled")}),i.find("form").on("submit",A)})},r.create=function(d){c.post("/categories",d,function(i,g){if(i)return n.error(i);n.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+g.cid)})},r.render=function(d){const i=$(".categories");!d||!d.length?o.translate("[[admin/manage/categories:alert.none-active]]",function(g){$("<div></div>").addClass("alert alert-info text-center").text(g).appendTo(i)}):(a={},k(d,i,{cid:0}))},r.toggle=function(d,i){const g=document.querySelector(".categories ul");Promise.all(d.map(E=>c.put("/categories/"+E,{disabled:i?1:0}).then(()=>{const b=g.querySelector(`li[data-cid="${E}"]`);b.classList[i?"add":"remove"]("disabled"),$(b).find('li a[data-action="toggle"]').first().translateText(i?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(n.error)))};function l(d){t=d.to.dataset.cid}function C(d){const i=parseInt(t,10)!==-1;if(d.newIndex!=null&&parseInt(d.oldIndex,10)!==parseInt(d.newIndex,10)||i){const g=d.item.dataset.cid,E={},b=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(E[g]={order:b+d.newIndex+1},i){E[g].parentCid=t;const A=parseInt(d.from.getAttribute("data-cid"),10),p=parseInt(d.to.getAttribute("data-cid"),10);if(A!==p){const _=document.querySelector(`.categories li[data-cid="${p}"] .toggle`);if(_&&_.classList.toggle("hide",!1),!document.querySelectorAll(`.categories li[data-cid="${A}"] ul[data-cid] li[data-cid]`).length){const x=document.querySelector(`.categories li[data-cid="${A}"] .toggle`);x&&x.classList.toggle("hide",!0)}d.item.dataset.parentCid=p}}t=-1,c.put("/categories/"+g,E[g]).catch(n.error)}}function k(d,i,g){let E=0;const b=g.cid;d.forEach(function(p,_,I){o.translate(p.name,function(x){p.name!==x&&(p.name=x),E+=1,E===I.length&&A()})}),d.length||A();function A(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:g.cid,categories:d,parentCategory:g},function(p){i.find(".category-row").length?i.find(".category-row").after(p):i.append(p),d.length||i.get(0).querySelector(".toggle").classList.toggle("hide",!0);for(let _=0,I=d.length;_<I;_+=1)k(d[_].children,$('li[data-cid="'+d[_].cid+'"]'),d[_]);a[b]=e.create($('ul[data-cid="'+b+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:l,onEnd:C})})}}return r}.apply(S,y),f!==void 0&&(v.exports=f)},7927:(v,S,m)=>{var y,f;y=[m(32230),m(7237),m(85233)],f=function(o,u,h){const c={};c.alert=function(t){t.alert_id="alert_button_"+(t.alert_id?t.alert_id:new Date().getTime()),t.title=t.title&&t.title.trim()||"",t.message=t.message?t.message.trim():"",t.type=t.type||"info";const a=$("#"+t.alert_id);a.length?s(a,t):e(t)},c.success=function(t,a){c.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:t,type:"success",timeout:a||5e3})},c.error=function(t,a){if(t=t&&t.message||t,t==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}c.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:t,type:"danger",timeout:a||1e4})},c.remove=function(t){$("#alert_button_"+t).remove()};function e(t){app.parseAndTranslate("alert",t,function(a){let l=$("#"+t.alert_id);if(l.length)return s(l,t);l=a,l.fadeIn(200),u.get("toaster/tray").prepend(l),typeof t.closefn=="function"&&l.find("button").on("click",function(){return t.closefn(),n(l),!1}),t.timeout&&r(l,t),typeof t.clickfn=="function"&&l.addClass("pointer").on("click",function(C){$(C.target).is(".close")||t.clickfn(l,t),n(l)}),h.fire("action:alert.new",{alert:l,params:t})})}function s(t,a){t.find("strong").translateHtml(a.title),t.find("p").translateHtml(a.message),t.attr("class","alert alert-dismissable alert-"+a.type+" clearfix"),clearTimeout(parseInt(t.attr("timeoutId"),10)),a.timeout&&r(t,a),h.fire("action:alert.update",{alert:t,params:a}),t.off("click").removeClass("pointer"),typeof a.clickfn=="function"&&t.addClass("pointer").on("click",function(l){$(l.target).is(".close")||a.clickfn(),n(t)})}function n(t){t.fadeOut(500,function(){$(this).remove()})}function r(t,a){const l=a.timeout,C=setTimeout(function(){n(t),typeof a.timeoutfn=="function"&&a.timeoutfn(t,a)},l);t.attr("timeoutId",C),t.css("transition-property","none"),t.removeClass("animate"),setTimeout(function(){t.css("transition-property",""),t.css("transition","width "+(l+450)+"ms linear, background-color "+(l+450)+"ms ease-in"),t.addClass("animate"),h.fire("action:alert.animate",{alert:t,params:a})},50),t.on("mouseenter",function(){$(this).css("transition-duration",0)})}return c}.apply(S,y),f!==void 0&&(v.exports=f)},74344:(v,S,m)=>{var y,f;y=[m(85233)],f=(o=>{const u={},h=config.relative_path+"/api/v3";function c(e,s){e.url=e.url.startsWith("/api")?config.relative_path+e.url:h+e.url;async function n(r){({options:e}=await o.fire("filter:api.options",{options:e})),$.ajax(e).done(t=>{r(null,t&&t.hasOwnProperty("status")&&t.hasOwnProperty("response")?t.response:t||{})}).fail(t=>{let a;t.responseJSON&&(a=t.responseJSON.status&&t.responseJSON.status.message?t.responseJSON.status.message:t.responseJSON.error),r(new Error(a||t.statusText))})}if(typeof s=="function"){n(s);return}return new Promise((r,t)=>{n(function(a,l){a?t(a):r(l)})})}return u.get=(e,s,n)=>c({url:e+(s&&Object.keys(s).length?"?"+$.param(s):"")},n),u.head=(e,s,n)=>c({url:e+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"head"},n),u.post=(e,s,n)=>c({url:e,method:"post",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),u.patch=(e,s,n)=>c({url:e,method:"patch",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),u.put=(e,s,n)=>c({url:e,method:"put",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),u.del=(e,s,n)=>c({url:e,method:"delete",data:JSON.stringify(s),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},n),u.delete=u.del,u}).apply(S,y),f!==void 0&&(v.exports=f)},22905:(v,S,m)=>{var y,f;y=[m(7927)],f=function(o){const u={};return u.init=function(h,c){let e=null;c=c||{},c.privilege=c.privilege||"topics:read",c.states=c.states||["watching","notwatching","ignoring"];let s=[];Array.isArray(c.localCategories)&&(s=c.localCategories.map(l=>({...l}))),c.selectedCids=c.selectedCids||ajaxify.data.selectedCids||[];const n=h.find('[component="category-selector-search"]');if(!n.length)return;const r=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;h.on("show.bs.dropdown",function(){r&&(h.find(".dropdown-toggle").addClass("hidden"),n.removeClass("hidden"));function l(){const C=n.find("input").val();C.length>1||!C&&!e?t(C,function(k){e=e||k,a(k)}):!C&&e&&(e.forEach(function(k){k.selected=c.selectedCids.includes(k.cid)}),a(e))}n.on("click",function(C){C.preventDefault(),C.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(l,300)),l()}),h.on("shown.bs.dropdown",function(){n.find("input").focus()}),h.on("hide.bs.dropdown",function(){r&&(h.find(".dropdown-toggle").removeClass("hidden"),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function t(l,C){socket.emit("categories.categorySearch",{search:l,query:utils.params(),parentCid:c.parentCid||0,selectedCids:c.selectedCids,privilege:c.privilege,states:c.states,showLinks:c.showLinks},function(k,d){if(k)return o.error(k);C(s.concat(d))})}function a(l){app.parseAndTranslate(c.template,{categoryItems:l.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(C){h.find('[component="category/list"]').replaceWith(C.find('[component="category/list"]')),h.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!l.length)})}},u}.apply(S,y),f!==void 0&&(v.exports=f)},50548:(v,S,m)=>{var y,f;y=[m(22905),m(31369),m(85233)],f=function(o,u,h){const c={};return c.init=function(e,s){if(!e||!e.length)return;s=s||{};const n=s.onSelect||function(){};s.states=s.states||["watching","notwatching","ignoring"],s.template="partials/category-selector",h.fire("action:category.selector.options",{el:e,options:s}),o.init(e,s);const r={el:e,selectedCategory:null};e.on("click","[data-cid]",function(){const a=$(this);if(a.hasClass("disabled"))return!1;r.selectCategory(a.attr("data-cid")),n(r.selectedCategory)});const t=r.el.find('[component="category-selector-selected"]').html();return r.selectCategory=function(a){const l=r.el.find('[data-cid="'+a+'"]');r.selectedCategory={cid:a,name:l.attr("data-name")},l.length?r.el.find('[component="category-selector-selected"]').html(l.find('[component="category-markup"]').html()):r.el.find('[component="category-selector-selected"]').html(t)},r.getSelectedCategory=function(){return r.selectedCategory},r.getSelectedCid=function(){return r.selectedCategory?r.selectedCategory.cid:0},r},c.modal=function(e){e=e||{},e.onSelect=e.onSelect||function(){},e.onSubmit=e.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:e.message},function(s){const n=u.dialog({title:e.title||"[[modules:composer.select_category]]",message:s,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:t}}}),r=c.init(n.find('[component="category-selector"]'),e);function t(a){return a.preventDefault(),r.selectedCategory&&(e.onSubmit(r.selectedCategory),n.modal("hide")),!1}e.openOnLoad&&n.on("shown.bs.modal",function(){n.find(".dropdown-toggle").dropdown("toggle")}),n.find("form").on("submit",t)})},c}.apply(S,y),f!==void 0&&(v.exports=f)},7237:(v,S,m)=>{var y;y=function(){const f={};return f.core={"topic/teaser":function(o){return o?$('[component="category/topic"][data-tid="'+o+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(o,u){return $('[component="topic"][data-'+o+'="'+u+'"]')},post:function(o,u){return $('[component="post"][data-'+o+'="'+u+'"]')},"post/content":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/content"]')},"post/header":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/header"]')},"post/anchor":function(o){return $('[component="post"][data-index="'+o+'"] [component="post/anchor"]')},"post/vote-count":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/vote-count"]')},"post/bookmark-count":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/bookmark-count"]')},"user/postcount":function(o){return $('[component="user/postcount"][data-uid="'+o+'"]')},"user/reputation":function(o){return $('[component="user/reputation"][data-uid="'+o+'"]')},"category/topic":function(o,u){return $('[component="category/topic"][data-'+o+'="'+u+'"]')},"categories/category":function(o,u){return $('[component="categories/category"][data-'+o+'="'+u+'"]')},"chat/message":function(o){return $('[component="chat/message"][data-mid="'+o+'"]')},"chat/message/body":function(o){return $('[component="chat/message"][data-mid="'+o+'"] [component="chat/message/body"]')},"chat/recent/room":function(o){return $('[component="chat/recent/room"][data-roomid="'+o+'"]')}},f.get=function(){const o=Array.prototype.slice.call(arguments,1);return f.core[arguments[0]]&&o.length?f.core[arguments[0]].apply(this,o):$('[component="'+arguments[0]+'"]')},f}.call(S,m,S,v),y!==void 0&&(v.exports=y)}}]);
