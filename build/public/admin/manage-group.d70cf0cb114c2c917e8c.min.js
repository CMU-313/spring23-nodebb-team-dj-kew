"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[9078,7214,9617,6503,1762,3014,6623,9286,1986,8042,8786,5655,999,831],{22009:(v,C,p)=>{var g,f;g=[p(24987),p(18487),p(32230),p(50548),p(7350),p(22568),p(74344),p(31369),p(7927)],f=function(o,l,m,n,t,s,a,u,e){const i={};i.init=function(){const b=$("#group-icon"),d=$("#change-group-user-title"),h=$("#change-group-label-color"),y=$("#change-group-text-color"),E=$("#group-label-preview"),_=$("#group-label-preview-text"),A=ajaxify.data.group.name;$("#group-selector").on("change",function(){ajaxify.go("admin/manage/groups/"+$(this).val()+window.location.hash)}),o.init("admin/manage/group"),d.on("keyup",function(){_.translateText(d.val())}),h.on("keyup input",function(){E.css("background-color",h.val()||"#000000")}),y.on("keyup input",function(){E.css("color",y.val()||"#ffffff")}),c(),$("#group-icon, #group-icon-label").on("click",function(){const w=b.attr("value");l.init(b,function(){let k=b.attr("value");k!==w&&(k==="fa-nbb-none"&&(k="hidden"),$("#group-icon-preview").attr("class","fa fa-fw "+(k||"hidden")),app.flags=app.flags||{},app.flags._unsaved=!0)})}),n.init($('.edit-privileges-selector [component="category-selector"]'),{onSelect:function(w){r(w.cid)},showLinks:!0});const D=n.init($('.member-post-cids-selector [component="category-selector"]'),{onSelect:function(w){let k=($("#memberPostCids").val()||"").split(",").map(x=>parseInt(x,10));k.push(w.cid),k=k.filter((x,S,N)=>N.indexOf(x)===S),$("#memberPostCids").val(k.join(",")),D.selectCategory(0)}});t.init($('[component="group-selector"]')),$("form [data-property]").on("change",function(){app.flags=app.flags||{},app.flags._unsaved=!0}),$("#save").on("click",function(){return a.put(`/groups/${s(A)}`,{name:$("#change-group-name").val(),userTitle:d.val(),description:$("#change-group-desc").val(),icon:b.attr("value"),labelColor:h.val(),textColor:y.val(),userTitleEnabled:$("#group-userTitleEnabled").is(":checked"),private:$("#group-private").is(":checked"),hidden:$("#group-hidden").is(":checked"),memberPostCids:$("#memberPostCids").val(),disableJoinRequests:$("#group-disableJoinRequests").is(":checked"),disableLeave:$("#group-disableLeave").is(":checked")}).then(()=>{const w=$("#change-group-name").val();A!==w&&ajaxify.go("admin/manage/groups/"+encodeURIComponent(w),void 0,!0),e.success("[[admin/manage/groups:edit.save-success]]")}).catch(e.error),!1})};function c(){$('[component="groups/members"]').on("click","[data-action]",function(){const b=$(this),d=b.parents("[data-uid]"),h=d.find(".member-name .user-owner-icon"),y=!h.hasClass("invisible"),E=d.attr("data-uid");switch(b.attr("data-action")){case"toggleOwnership":a[y?"del":"put"](`/groups/${ajaxify.data.group.slug}/ownership/${E}`,{}).then(()=>{h.toggleClass("invisible")}).catch(e.error);break;case"kick":u.confirm("[[admin/manage/groups:edit.confirm-remove-user]]",function(A){A&&a.del("/groups/"+ajaxify.data.group.slug+"/membership/"+E).then(()=>{d.slideUp().remove()}).catch(e.error)});break;default:break}})}function r(b){if(b){const d="admin/manage/privileges/"+b+"?group="+ajaxify.data.group.nameEncoded;if(app.flags&&app.flags._unsaved===!0){m.translate("[[global:unsaved-changes]]",function(h){u.confirm(h,function(y){y&&(app.flags._unsaved=!1,ajaxify.go(d))})});return}ajaxify.go(d)}}return i}.apply(C,g),f!==void 0&&(v.exports=f)},24987:(v,C,p)=>{var g,f;g=[p(74344),p(31369),p(7927)],f=function(o,l,m){const n={};let t,s;n.init=function(d){s=d||"groups/details",t=ajaxify.data.group.name,a(),e(),i()};function a(){$('[component="groups/members/add"]').on("click",function(){app.parseAndTranslate("admin/partials/groups/add-members",{},function(d){const h=[],y=l.dialog({title:"[[groups:details.add-member]]",message:d,buttons:{ok:{callback:function(){const E=[];y.find("[data-uid][data-selected]").each(function(_,A){E.push(h[$(A).attr("data-uid")])}),u(E,function(){y.modal("hide")})}}}});y.on("click","[data-username]",function(){$(this).attr("data-selected")==="1"?$(this).removeAttr("data-selected"):$(this).attr("data-selected",1),$(this).find("i").toggleClass("invisible")}),y.find("input").on("keyup",function(){o.get("/api/users",{query:$(this).val(),paginate:!1},function(E,_){if(E)return m.error(E);_.users.forEach(function(A){h[A.uid]=A}),app.parseAndTranslate("admin/partials/groups/add-members","users",{users:_.users},function(A){y.find("#search-result").html(A)})})})})})}function u(d,h){function y(){d=d.filter(function(_){return!$('[component="groups/members"] [data-uid="'+_.uid+'"]').length}),b(d,function(_){$('[component="groups/members"] tbody').prepend(_)}),h()}const E=d.map(function(_){return _.uid});t==="administrators"?socket.emit("admin.user.makeAdmins",E,function(_){if(_)return m.error(_);y()}):Promise.all(E.map(_=>o.put("/groups/"+ajaxify.data.group.slug+"/membership/"+_))).then(y).catch(m.error)}function e(){const d=$('[component="groups/members/search"]');d.on("keyup",utils.debounce(function(){const h=d.val();socket.emit("groups.searchMembers",{groupName:t,query:h},function(y,E){if(y)return m.error(y);b(E.users,function(_){$('[component="groups/members"] tbody').html(_),$('[component="groups/members"]').attr("data-nextstart",20)})})},250))}function i(){$('[component="groups/members"] tbody').on("scroll",function(){const d=$(this),h=(d[0].scrollHeight-d.innerHeight())*.9;d.scrollTop()>h&&!$('[component="groups/members/search"]').val()&&c()})}function c(){const d=$('[component="groups/members"]');d.attr("loading")||(d.attr("loading",1),socket.emit("groups.loadMoreMembers",{groupName:t,after:d.attr("data-nextstart")},function(h,y){if(h)return m.error(h);y&&y.users.length?r(y.users,function(){d.removeAttr("loading"),d.attr("data-nextstart",y.nextStart)}):d.removeAttr("loading")}))}function r(d,h){d=d.filter(function(y){return!$('[component="groups/members"] [data-uid="'+y.uid+'"]').length}),b(d,function(y){$('[component="groups/members"] tbody').append(y),h()})}function b(d,h){app.parseAndTranslate(s,"group.members",{group:{members:d,isOwner:ajaxify.data.group.isOwner}},h)}return n}.apply(C,g),f!==void 0&&(v.exports=f)},7927:(v,C,p)=>{var g,f;g=[p(32230),p(7237),p(85233)],f=function(o,l,m){const n={};n.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:new Date().getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const i=$("#"+e.alert_id);i.length?s(i,e):t(e)},n.success=function(e,i){n.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:i||5e3})},n.error=function(e,i){if(e=e&&e.message||e,e==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}n.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:i||1e4})},n.remove=function(e){$("#alert_button_"+e).remove()};function t(e){app.parseAndTranslate("alert",e,function(i){let c=$("#"+e.alert_id);if(c.length)return s(c,e);c=i,c.fadeIn(200),l.get("toaster/tray").prepend(c),typeof e.closefn=="function"&&c.find("button").on("click",function(){return e.closefn(),a(c),!1}),e.timeout&&u(c,e),typeof e.clickfn=="function"&&c.addClass("pointer").on("click",function(r){$(r.target).is(".close")||e.clickfn(c,e),a(c)}),m.fire("action:alert.new",{alert:c,params:e})})}function s(e,i){e.find("strong").translateHtml(i.title),e.find("p").translateHtml(i.message),e.attr("class","alert alert-dismissable alert-"+i.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),i.timeout&&u(e,i),m.fire("action:alert.update",{alert:e,params:i}),e.off("click").removeClass("pointer"),typeof i.clickfn=="function"&&e.addClass("pointer").on("click",function(c){$(c.target).is(".close")||i.clickfn(),a(e)})}function a(e){e.fadeOut(500,function(){$(this).remove()})}function u(e,i){const c=i.timeout,r=setTimeout(function(){a(e),typeof i.timeoutfn=="function"&&i.timeoutfn(e,i)},c);e.attr("timeoutId",r),e.css("transition-property","none"),e.removeClass("animate"),setTimeout(function(){e.css("transition-property",""),e.css("transition","width "+(c+450)+"ms linear, background-color "+(c+450)+"ms ease-in"),e.addClass("animate"),m.fire("action:alert.animate",{alert:e,params:i})},50),e.on("mouseenter",function(){$(this).css("transition-duration",0)})}return n}.apply(C,g),f!==void 0&&(v.exports=f)},74344:(v,C,p)=>{var g,f;g=[p(85233)],f=(o=>{const l={},m=config.relative_path+"/api/v3";function n(t,s){t.url=t.url.startsWith("/api")?config.relative_path+t.url:m+t.url;async function a(u){({options:t}=await o.fire("filter:api.options",{options:t})),$.ajax(t).done(e=>{u(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let i;e.responseJSON&&(i=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),u(new Error(i||e.statusText))})}if(typeof s=="function"){a(s);return}return new Promise((u,e)=>{a(function(i,c){i?e(i):u(c)})})}return l.get=(t,s,a)=>n({url:t+(s&&Object.keys(s).length?"?"+$.param(s):"")},a),l.head=(t,s,a)=>n({url:t+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"head"},a),l.post=(t,s,a)=>n({url:t,method:"post",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},a),l.patch=(t,s,a)=>n({url:t,method:"patch",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},a),l.put=(t,s,a)=>n({url:t,method:"put",data:JSON.stringify(s||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},a),l.del=(t,s,a)=>n({url:t,method:"delete",data:JSON.stringify(s),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},a),l.delete=l.del,l}).apply(C,g),f!==void 0&&(v.exports=f)},22905:(v,C,p)=>{var g,f;g=[p(7927)],f=function(o){const l={};return l.init=function(m,n){let t=null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","notwatching","ignoring"];let s=[];Array.isArray(n.localCategories)&&(s=n.localCategories.map(c=>({...c}))),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const a=m.find('[component="category-selector-search"]');if(!a.length)return;const u=a.parent('[component="category/dropdown"]').length>0||a.parent('[component="category-selector"]').length>0;m.on("show.bs.dropdown",function(){u&&(m.find(".dropdown-toggle").addClass("hidden"),a.removeClass("hidden"));function c(){const r=a.find("input").val();r.length>1||!r&&!t?e(r,function(b){t=t||b,i(b)}):!r&&t&&(t.forEach(function(b){b.selected=n.selectedCids.includes(b.cid)}),i(t))}a.on("click",function(r){r.preventDefault(),r.stopPropagation()}),a.find("input").val("").on("keyup",utils.debounce(c,300)),c()}),m.on("shown.bs.dropdown",function(){a.find("input").focus()}),m.on("hide.bs.dropdown",function(){u&&(m.find(".dropdown-toggle").removeClass("hidden"),a.addClass("hidden")),a.off("click"),a.find("input").off("keyup")});function e(c,r){socket.emit("categories.categorySearch",{search:c,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(b,d){if(b)return o.error(b);r(s.concat(d))})}function i(c){app.parseAndTranslate(n.template,{categoryItems:c.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(r){m.find('[component="category/list"]').replaceWith(r.find('[component="category/list"]')),m.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!c.length)})}},l}.apply(C,g),f!==void 0&&(v.exports=f)},50548:(v,C,p)=>{var g,f;g=[p(22905),p(31369),p(85233)],f=function(o,l,m){const n={};return n.init=function(t,s){if(!t||!t.length)return;s=s||{};const a=s.onSelect||function(){};s.states=s.states||["watching","notwatching","ignoring"],s.template="partials/category-selector",m.fire("action:category.selector.options",{el:t,options:s}),o.init(t,s);const u={el:t,selectedCategory:null};t.on("click","[data-cid]",function(){const i=$(this);if(i.hasClass("disabled"))return!1;u.selectCategory(i.attr("data-cid")),a(u.selectedCategory)});const e=u.el.find('[component="category-selector-selected"]').html();return u.selectCategory=function(i){const c=u.el.find('[data-cid="'+i+'"]');u.selectedCategory={cid:i,name:c.attr("data-name")},c.length?u.el.find('[component="category-selector-selected"]').html(c.find('[component="category-markup"]').html()):u.el.find('[component="category-selector-selected"]').html(e)},u.getSelectedCategory=function(){return u.selectedCategory},u.getSelectedCid=function(){return u.selectedCategory?u.selectedCategory.cid:0},u},n.modal=function(t){t=t||{},t.onSelect=t.onSelect||function(){},t.onSubmit=t.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:t.message},function(s){const a=l.dialog({title:t.title||"[[modules:composer.select_category]]",message:s,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:e}}}),u=n.init(a.find('[component="category-selector"]'),t);function e(i){return i.preventDefault(),u.selectedCategory&&(t.onSubmit(u.selectedCategory),a.modal("hide")),!1}t.openOnLoad&&a.on("shown.bs.modal",function(){a.find(".dropdown-toggle").dropdown("toggle")}),a.find("form").on("submit",e)})},n}.apply(C,g),f!==void 0&&(v.exports=f)},7237:(v,C,p)=>{var g;g=function(){const f={};return f.core={"topic/teaser":function(o){return o?$('[component="category/topic"][data-tid="'+o+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(o,l){return $('[component="topic"][data-'+o+'="'+l+'"]')},post:function(o,l){return $('[component="post"][data-'+o+'="'+l+'"]')},"post/content":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/content"]')},"post/header":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/header"]')},"post/anchor":function(o){return $('[component="post"][data-index="'+o+'"] [component="post/anchor"]')},"post/vote-count":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/vote-count"]')},"post/bookmark-count":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/bookmark-count"]')},"user/postcount":function(o){return $('[component="user/postcount"][data-uid="'+o+'"]')},"user/reputation":function(o){return $('[component="user/reputation"][data-uid="'+o+'"]')},"category/topic":function(o,l){return $('[component="category/topic"][data-'+o+'="'+l+'"]')},"categories/category":function(o,l){return $('[component="categories/category"][data-'+o+'="'+l+'"]')},"chat/message":function(o){return $('[component="chat/message"][data-mid="'+o+'"]')},"chat/message/body":function(o){return $('[component="chat/message"][data-mid="'+o+'"] [component="chat/message/body"]')},"chat/recent/room":function(o){return $('[component="chat/recent/room"][data-roomid="'+o+'"]')}},f.get=function(){const o=Array.prototype.slice.call(arguments,1);return f.core[arguments[0]]&&o.length?f.core[arguments[0]].apply(this,o):$('[component="'+arguments[0]+'"]')},f}.call(C,p,C,v),g!==void 0&&(v.exports=g)},7350:(v,C,p)=>{var g;g=function(){const f={};return f.init=function(o){if(utils.isTouchDevice())return;const l=o.find('[component="group-selector-search"]');if(!l.length)return;const m=l.parent('[component="group-selector"]').length>0,n=o.find('[component="group-list"] [data-name]');o.on("show.bs.dropdown",function(){function t(){const s=l.find("input").val().toLowerCase();let a=!0;n.each(function(){const u=$(this),e=u.attr("data-name").toLowerCase().indexOf(s)!==-1;a&&e&&(a=!1),u.toggleClass("hidden",!e)}),o.find('[component="group-list"] [component="group-no-matches"]').toggleClass("hidden",!a)}m&&(o.find(".dropdown-toggle").addClass("hidden"),l.removeClass("hidden")),l.on("click",function(s){s.preventDefault(),s.stopPropagation()}),l.find("input").val("").on("keyup",t),t()}),o.on("shown.bs.dropdown",function(){l.find("input").focus()}),o.on("hide.bs.dropdown",function(){m&&(o.find(".dropdown-toggle").removeClass("hidden"),l.addClass("hidden")),l.off("click").find("input").off("keyup")})},f}.call(C,p,C,v),g!==void 0&&(v.exports=g)},18487:(v,C,p)=>{var g,f;g=[p(59006),p(31369)],f=function(o,l){const m={};return m.init=function(n,t){t=t||function(){};const s=n.hasClass("fa-2x");let a=n.attr("class").replace("fa-2x","").replace("fa","").replace(/\s+/g,"");if($("#icons .selected").removeClass("selected"),a)try{$("#icons .fa-icons .fa."+a).addClass("selected")}catch{a=""}o.render("partials/fontawesome",{}).then(function(u){u=$(u),u.find(".fa-icons").prepend($('<i class="fa fa-nbb-none"></i>'));const e=l.dialog({onEscape:!0,backdrop:!0,show:!1,message:u,title:"Select an Icon",buttons:{noIcon:{label:"No Icon",className:"btn-default",callback:function(){n.attr("class","fa "+(s?"fa-2x ":"")),n.val(""),n.attr("value",""),t(n)}},success:{label:"Select",className:"btn-primary",callback:function(){const i=$(".bootbox .selected").attr("class")||`fa fa-${$(".bootbox #fa-filter").val()}`,c=$("<div></div>").addClass(i).removeClass("fa").removeClass("selected").attr("class"),r=e.find("input").val();c?(n.attr("class","fa "+(s?"fa-2x ":"")+c),n.val(c),n.attr("value",c)):r&&(n.attr("class",r),n.val(r),n.attr("value",r)),t(n)}}}});e.on("show.bs.modal",function(){const i=$(this),c=i.find("input");a&&(i.find("."+a).addClass("selected"),c.val(a.replace("fa-","")))}).modal("show"),e.on("shown.bs.modal",function(){const i=$(this),c=i.find("input"),r=i.find(".fa-icons i"),b=i.find("button.btn-primary");function d(h){i.find("i.selected").removeClass("selected"),h?h.addClass("selected"):c.val().length===0?a&&i.find("."+a).addClass("selected"):i.find("i:visible").first().addClass("selected")}c.selectRange(0,c.val().length),i.find(".icon-container").on("click","i",function(){c.val($(this).attr("class").replace("fa fa-","").replace("selected","")),d($(this))}),c.on("keyup",function(h){h.keyCode!==13?(r.show(),r.each(function(y,E){E.className.match(new RegExp("^fa fa-.*"+c.val()+".*$"))||$(E).hide()}),d()):b.click()})})})},m}.apply(C,g),f!==void 0&&(v.exports=f)},22568:(v,C,p)=>{var g,f,o;(function(l){f=[p(20648)],g=l,o=typeof g=="function"?g.apply(C,f):g,o!==void 0&&(v.exports=o)})(function(l){const m=l("[^\\p{L}\\s\\d\\-_]","g"),n=/[^\w\s\d\-_]/g,t=/^\s+|\s+$/g,s=/\s+/g,a=/-+/g,u=/-$/g,e=/^-/g,i=/^[\w\d\s.,\-@]+$/;return function(r,b){return r?(r=String(r).replace(t,""),i.test(r)?r=r.replace(n,"-"):r=l.replace(r,m,"-"),r=b?r:r.toLocaleLowerCase(),r=r.replace(s,"-"),r=r.replace(a,"-"),r=r.replace(u,""),r=r.replace(e,""),r):""}})}}]);
