"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4834],{8196:(v,b,r)=>{var f,h;f=[r(31369),r(7927),r(62526),r(87285),r(66709),r(84414)],h=function(C,p){const u={};u.init=function(){$("#widgets .nav-pills .dropdown-menu a").on("click",function(o){const e=$(this);$("#widgets .tab-pane").removeClass("active");const t=e.attr("data-template");return $('#widgets .tab-pane[data-template="'+t+'"]').addClass("active"),$("#widgets .selected-template").text(t),$("#widgets .nav-pills .dropdown").trigger("click"),o.preventDefault(),!1}),$("#widget-selector").on("change",function(){$(".available-widgets [data-widget]").addClass("hide"),$('.available-widgets [data-widget="'+$(this).val()+'"]').removeClass("hide")}),$("#widget-selector").trigger("change"),x(),A()};function k(){$('[data-location="drafts"]').insertAfter($('[data-location="drafts"]').closest(".tab-content")),$("#widgets .available-widgets .widget-panel").draggable({helper:function(e){return $(e.target).parents(".widget-panel").clone()},distance:10,connectToSortable:".widget-area"}),$("#widgets .available-containers .containers > [data-container-html]").draggable({helper:function(e){let t=$(e.target);return t=t.attr("data-container-html")?t:t.parents("[data-container-html]"),t.clone().addClass("block").width(t.width()).css("opacity","0.5")},distance:10}).each(function(){$(this).attr("data-container-html",$(this).attr("data-container-html").replace(/\\\{([\s\S]*?)\\\}/g,"{$1}"))}),$("#widgets .widget-area").sortable({update:function(e,t){m(t.item),w(t.item)},connectWith:"div"}).on("click",".delete-widget",function(){const e=$(this).parents(".widget-panel");C.confirm("[[admin/extend/widgets:alert.confirm-delete]]",function(t){t&&e.remove()})}).on("mouseup","> .panel > .panel-heading",function(e){$(this).parent().is(".ui-sortable-helper")||$(e.target).closest(".delete-widget").length||$(this).parent().children(".panel-body").toggleClass("hidden")}),$("#save").on("click",o);function o(){const e=[];$("#widgets [data-template][data-location]").each(function(t,a){a=$(a);const s=a.attr("data-template"),g=a.attr("data-location"),l=a.children(".widget-area"),d=[];l.find(".widget-panel[data-widget]").each(function(){const n={},i=$(this).find("form").serializeArray();for(const c in i)i.hasOwnProperty(c)&&i[c].name&&(n[i[c].name]?(Array.isArray(n[i[c].name])||(n[i[c].name]=[n[i[c].name]]),n[i[c].name].push(i[c].value)):n[i[c].name]=i[c].value);d.push({widget:$(this).attr("data-widget"),data:n})}),e.push({template:s,location:g,widgets:d})}),socket.emit("admin.widgets.set",e,function(t){t&&p.error(t),p.alert({alert_id:"admin:widgets",type:"success",title:"[[admin/extend/widgets:alert.updated]]",message:"[[admin/extend/widgets:alert.update-success]]",timeout:2500})})}$(".color-selector").on("click",".btn",function(){const e=$(this),t=e.parents(".color-selector"),a=t.parents("[data-container-html]"),s=[];t.children().each(function(){s.push($(this).attr("data-class"))}),a.removeClass(s.join(" ")).addClass(e.attr("data-class")),a.attr("data-container-html",a.attr("data-container-html").replace(/class="[a-zA-Z0-9-\s]+"/,'class="'+a[0].className.replace(" pointer ui-draggable ui-draggable-handle","")+'"'))})}function m(o){const e=new Date().getFullYear();o.find(".date-selector").datepicker({changeMonth:!0,changeYear:!0,yearRange:e+":"+(e+100)})}function w(o){o.hasClass("block")||o.addClass("block").css("width","").css("height","").droppable({accept:"[data-container-html]",drop:function(e,t){const a=$(this);a.find(".panel-body .container-html").val(t.draggable.attr("data-container-html")),a.find(".panel-body").removeClass("hidden")},hoverClass:"panel-info"}).children(".panel-heading").append('<div class="pull-right pointer"><span class="delete-widget"><i class="fa fa-times-circle"></i></span></div><div class="pull-left pointer"><span class="toggle-widget"><i class="fa fa-chevron-circle-down"></i></span>&nbsp;</div>').children("small").html("")}function x(){function o(e,t){if(t.title){const a=e.find(".panel-heading strong");a.text(a.text()+" - "+t.title)}return e.find("input, textarea, select").each(function(){const a=$(this),s=t[a.attr("name")];a.attr("type")==="checkbox"?a.prop("checked",!!s).trigger("change"):a.val(s)}),e}$.get(config.relative_path+"/api/admin/extend/widgets",function(e){const t=e.areas;for(let a=0;a<t.length;a+=1){const s=t[a],g=$('#widgets .area[data-template="'+s.template+'"][data-location="'+s.location+'"]').find(".widget-area");g.html("");for(let l=0;l<s.data.length;l+=1){const d=s.data[l],n=$('.available-widgets [data-widget="'+d.widget+'"]').clone(!0).removeClass("hide");g.append(o(n,d.data)),w(n),m(n)}}k()})}function A(){const o=$('[component="clone"]'),e=$('[component="clone/button"]');o.find(".dropdown-menu li").on("click",function(){const t=$(this).find("a").text();e.translateHtml("[[admin/extend/widgets:clone-from]] <strong>"+t+"</strong>"),e.attr("data-template",t)}),e.on("click",function(){const t=e.attr("data-template");if(!t)return p.error("[[admin/extend/widgets:error.select-clone]]");const a=$("#active-widgets .active.tab-pane[data-template] .area"),s=$('#active-widgets .tab-pane[data-template="'+t+'"] .area'),g=a.map(function(){return $(this).attr("data-location")}).get(),l=s.map(function(){const n=$(this).attr("data-location");return g.indexOf(n)!==-1?n:void 0}).get().filter(function(n){return n});function d(n){$('#active-widgets .tab-pane[data-template="'+t+'"] [data-location="'+n+'"]').each(function(){$(this).find("[data-widget]").each(function(){const i=$(this).clone(!0);$('#active-widgets .active.tab-pane[data-template]:not([data-template="global"]) [data-location="'+n+'"] .widget-area').append(i)})})}for(let n=0,i=l.length;n<i;n++){const c=l[n];d(c)}p.success("[[admin/extend/widgets:alert.clone-success]]")})}return u}.apply(b,f),h!==void 0&&(v.exports=h)}}]);
