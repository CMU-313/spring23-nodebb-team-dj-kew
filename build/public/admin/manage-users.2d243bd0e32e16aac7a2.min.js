"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[160,7214,9617,6503,2852,3014,8253,8786,5655,999,831,6193],{54582:(A,C,g)=>{var b,m;b=[g(32230),g(59006),g(86193),g(74344),g(22568),g(31369),g(7927),g(23884)],m=function(o,l,v,f,d,a,t,h){const e={};e.init=function(){$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",function(){const n=utils.params();n.resultsPerPage=$("#results-per-page").val();const i=x(n);ajaxify.go(window.location.pathname+"?"+i)}),$(".export-csv").on("click",function(){return socket.once("event:export-users-csv",function(){t.remove("export-users-start"),t.alert({alert_id:"export-users",type:"success",title:"[[global:alert.success]]",message:"[[admin/manage/users:export-users-completed]]",clickfn:function(){window.location.href=config.relative_path+"/api/admin/users/csv"},timeout:0})}),socket.emit("admin.user.exportUsersCSV",{},function(n){if(n)return t.error(n);t.alert({alert_id:"export-users-start",message:"[[admin/manage/users:export-users-started]]",timeout:ajaxify.data.userCount/5e3*500})}),!1});function r(){const n=[];return $('.users-table [component="user/select/single"]').each(function(){$(this).is(":checked")&&n.push($(this).attr("data-uid"))}),n}function p(n,i){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(n).each(function(){$(this).toggleClass("hidden",!i)})}function E(){$('.users-table [component="user/select/single"]').prop("checked",!1),$('.users-table [component="user/select/all"]').prop("checked",!1)}function _(n){const i=document.querySelector(`.users-table [component="user/select/single"][data-uid="${n}"]`);if(i){const y=i.closest(".user-row");y.parentNode.removeChild(y)}}function N(n,i,y){return function(w){if(w)return t.error(w);t.success(n),i&&p(i,y),E()}}function R(n,i,y){t.success(n),i&&p(i,y),E()}$('[component="user/select/all"]').on("click",function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))}),$(".manage-groups").on("click",function(){const n=r();if(!n.length)return t.error("[[error:no-users-selected]]"),!1;socket.emit("admin.user.loadGroups",n,function(i,y){if(i)return t.error(i);l.render("admin/partials/manage_user_groups",y).then(function(w){const k=a.dialog({message:w,title:"[[admin/manage/users:manage-groups]]",onEscape:!0});k.on("shown.bs.modal",function(){v.group(k.find(".group-search"),function(S,I){const B=$(S.target).attr("data-uid");f.put("/groups/"+I.item.group.slug+"/membership/"+B,void 0).then(()=>{I.item.group.nameEscaped=o.escape(I.item.group.displayName),app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[I.item.group]}]},function(L){$("[data-uid="+B+"] .group-area").append(L.find(".group-area").html())})}).catch(t.error)})}),k.on("click",".group-area a",function(){k.modal("hide")}),k.on("click",".remove-group-icon",function(){const S=$(this).parents("[data-group-name]"),I=S.attr("data-group-name"),B=$(this).parents("[data-uid]").attr("data-uid");return f.del("/groups/"+d(I)+"/membership/"+B).then(()=>{S.remove()}).catch(t.error),!1})})})}),$(".ban-user").on("click",function(){const n=r();if(!n.length)return t.error("[[error:no-users-selected]]"),!1;a.confirm(n.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",function(i){i&&Promise.all(n.map(function(y){return f.put("/users/"+y+"/ban")})).then(()=>{R("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(t.error)})}),$(".ban-user-temporary").on("click",function(){const n=r();if(!n.length)return t.error("[[error:no-users-selected]]"),!1;l.render("admin/partials/temporary-ban",{}).then(function(i){a.dialog({className:"ban-modal",title:"[[user:ban_account]]",message:i,show:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+n.length+"]]",callback:function(){const y=$(".ban-modal form").serializeArray().reduce(function(k,S){return k[S.name]=S.value,k},{}),w=y.length>0?Date.now()+y.length*1e3*60*60*(parseInt(y.unit,10)?24:1):0;Promise.all(n.map(function(k){return f.put("/users/"+k+"/ban",{until:w,reason:y.reason})})).then(()=>{R("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(t.error)}}}})})}),$(".unban-user").on("click",function(){const n=r();if(!n.length)return t.error("[[error:no-users-selected]]"),!1;Promise.all(n.map(function(i){return f.del("/users/"+i+"/ban")})).then(()=>{R("[[admin/manage/users:alerts.unban-success]]",".ban",!1)})}),$(".reset-lockout").on("click",function(){const n=r();n.length&&socket.emit("admin.user.resetLockouts",n,N("[[admin/manage/users:alerts.lockout-reset-success]]"))}),$(".validate-email").on("click",function(){const n=r();n.length&&a.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",function(i){i&&socket.emit("admin.user.validateEmail",n,function(y){if(y)return t.error(y);t.success("[[admin/manage/users:alerts.validate-email-success]]"),p(".notvalidated",!1),p(".validated",!0),E()})})}),$(".send-validation-email").on("click",function(){const n=r();n.length&&socket.emit("admin.user.sendValidationEmail",n,function(i){if(i)return t.error(i);t.success("[[notifications:email-confirm-sent]]")})}),$(".password-reset-email").on("click",function(){const n=r();n.length&&a.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",function(i){i&&socket.emit("admin.user.sendPasswordResetEmail",n,N("[[admin/manage/users:alerts.password-reset-email-sent]]"))})}),$(".force-password-reset").on("click",function(){const n=r();n.length&&a.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",function(i){i&&socket.emit("admin.user.forcePasswordReset",n,N("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))})}),$(".delete-user").on("click",()=>{T("[[admin/manage/users:alerts.confirm-delete]]","/account")}),$(".delete-user-content").on("click",()=>{T("[[admin/manage/users:alerts.confirm-delete-content]]","/content")}),$(".delete-user-and-content").on("click",()=>{T("[[admin/manage/users:alerts.confirm-purge]]","")});const U=document.querySelector(".users-table"),j=document.getElementById("action-dropdown");U.addEventListener("change",n=>{(n.target.closest('[component="user/select/single"]')||n.target.closest('[component="user/select/all"]'))&&(r().length?j.removeAttribute("disabled"):j.setAttribute("disabled","disabled"))});function T(n,i){const y=r();y.length&&a.confirm(n,function(w){w&&Promise.all(y.map(k=>f.del(`/users/${k}${i}`,{}).then(()=>{i!=="/content"&&_(k)}))).then(()=>{i!=="/content"?t.success("[[admin/manage/users:alerts.delete-success]]"):t.success("[[admin/manage/users:alerts.delete-content-success]]"),E(),$('.users-table [component="user/select/single"]').length||ajaxify.refresh()}).catch(t.error)})}function F(){$('[data-action="create"]').on("click",function(){return l.render("admin/partials/create_user_modal",{}).then(function(n){const i=a.dialog({message:n,title:"[[admin/manage/users:alerts.create]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){return W.call(this),!1}}}});i.on("shown.bs.modal",function(){i.find("#create-user-name").focus()})}),!1})}function W(){const n=this,i=document.getElementById("create-user-name").value,y=document.getElementById("create-user-email").value,w=document.getElementById("create-user-password").value,k=document.getElementById("create-user-password-again").value,S=$("#create-modal-error");if(w!==k)return S.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide");const I={username:i,email:y,password:w};f.post("/users",I).then(()=>{n.modal("hide"),n.on("hidden.bs.modal",function(){ajaxify.refresh()}),t.success("[[admin/manage/users:alerts.create-success]]")}).catch(B=>S.translateHtml("[[admin/manage/users:alerts.error-x, "+B.message+"]]").removeClass("hidden"))}s(),F(),D(),O(),h.handle()};function s(){function r(){$(".fa-spinner").removeClass("hidden"),c({searchBy:$("#user-search-by").val(),query:$("#user-search").val(),page:1})}$("#user-search").on("keyup",utils.debounce(r,250)),$("#user-search-by").on("change",r)}function c(r){const p=utils.params();p.searchBy=r.searchBy,p.query=r.query,p.page=r.page,p.sortBy=p.sortBy||"lastonline";const E=decodeURIComponent($.param(p));$.get(config.relative_path+"/api/admin/manage/users?"+E,function(_){u(_);const N=config.relative_path+"/admin/manage/users?"+E;history.pushState&&history.pushState({url:N},null,window.location.protocol+"//"+window.location.host+N)}).fail(function(_){_&&_.responseJSON&&_.responseJSON.error&&t.error(_.responseJSON.error)})}function u(r){l.render("partials/paginator",{pagination:r.pagination}).then(function(p){$(".pagination-container").replaceWith(p)}),app.parseAndTranslate("admin/manage/users","users",r,function(p){if($(".users-table tbody tr").remove(),$(".users-table tbody").append(p),p.find(".timeago").timeago(),$(".fa-spinner").addClass("hidden"),!$("#user-search").val()){$("#user-found-notify").addClass("hidden"),$("#user-notfound-notify").addClass("hidden");return}r&&r.users.length===0?($("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden"),$("#user-found-notify").addClass("hidden")):($("#user-found-notify").translateHtml(o.compile("admin/manage/users:alerts.x-users-found",r.matchCount,r.timing)).removeClass("hidden"),$("#user-notfound-notify").addClass("hidden"))})}function x(r){return $("#user-search").val()?(r.query=$("#user-search").val(),r.searchBy=$("#user-search-by").val()):(delete r.query,delete r.searchBy),decodeURIComponent($.param(r))}function D(){$(".users-table thead th").on("click",function(){const p=$(this).attr("data-sort");if(!p)return;const E=utils.params();E.sortBy=p,ajaxify.data.sortBy===p?E.sortDirection=ajaxify.data.reverse?"asc":"desc":E.sortDirection="desc";const _=x(E);ajaxify.go("admin/manage/users?"+_)})}function P(){const r=[];return $("#filter-by").find("[data-filter-by]").each(function(){$(this).find(".fa-check").length&&r.push($(this).attr("data-filter-by"))}),r}function O(){let r=P();$("#filter-by").on("click","li",function(){const p=$(this);return p.find("i").toggleClass("fa-check",!p.find("i").hasClass("fa-check")),!1}),$("#filter-by").on("hidden.bs.dropdown",function(){const p=P();let E=p.length!==r.length;if(p.length===r.length&&p.forEach(function(_,N){_!==r[N]&&(E=!0)}),r=P(),E){const _=utils.params();_.filters=p;const N=x(_);ajaxify.go("admin/manage/users?"+N)}})}return e}.apply(C,b),m!==void 0&&(A.exports=m)},23884:(A,C,g)=>{var b,m;b=[g(74344),g(59006),g(31369),g(7927)],m=function(o,l,v,f){const d={};function a(){return ajaxify.data.template.name.startsWith("admin/")}return d.handle=function(){$('[component="user/invite"]').on("click",function(t){t.preventDefault(),o.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(h=>{l.parse("modals/invite",{groups:h},function(e){v.dialog({message:e,title:`[[${a()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${a()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${a()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:d.send}}})})}).catch(f.error)})},d.send=function(){const t=$("#invite-modal-emails"),h=$("#invite-modal-groups"),e={emails:t.val().split(",").map(s=>s.trim()).filter(Boolean).filter((s,c,u)=>c===u.indexOf(s)).join(","),groupsToJoin:h.val()};e.emails&&o.post(`/users/${app.user.uid}/invites`,e).then(()=>{f.success(`[[${a()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${e.emails.replace(/,/g,"&#44; ")}]]`)}).catch(f.error)},d}.apply(C,b),m!==void 0&&(A.exports=m)},7927:(A,C,g)=>{var b,m;b=[g(32230),g(7237),g(85233)],m=function(o,l,v){const f={};f.alert=function(e){e.alert_id="alert_button_"+(e.alert_id?e.alert_id:new Date().getTime()),e.title=e.title&&e.title.trim()||"",e.message=e.message?e.message.trim():"",e.type=e.type||"info";const s=$("#"+e.alert_id);s.length?a(s,e):d(e)},f.success=function(e,s){f.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:e,type:"success",timeout:s||5e3})},f.error=function(e,s){if(e=e&&e.message||e,e==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}f.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:e,type:"danger",timeout:s||1e4})},f.remove=function(e){$("#alert_button_"+e).remove()};function d(e){app.parseAndTranslate("alert",e,function(s){let c=$("#"+e.alert_id);if(c.length)return a(c,e);c=s,c.fadeIn(200),l.get("toaster/tray").prepend(c),typeof e.closefn=="function"&&c.find("button").on("click",function(){return e.closefn(),t(c),!1}),e.timeout&&h(c,e),typeof e.clickfn=="function"&&c.addClass("pointer").on("click",function(u){$(u.target).is(".close")||e.clickfn(c,e),t(c)}),v.fire("action:alert.new",{alert:c,params:e})})}function a(e,s){e.find("strong").translateHtml(s.title),e.find("p").translateHtml(s.message),e.attr("class","alert alert-dismissable alert-"+s.type+" clearfix"),clearTimeout(parseInt(e.attr("timeoutId"),10)),s.timeout&&h(e,s),v.fire("action:alert.update",{alert:e,params:s}),e.off("click").removeClass("pointer"),typeof s.clickfn=="function"&&e.addClass("pointer").on("click",function(c){$(c.target).is(".close")||s.clickfn(),t(e)})}function t(e){e.fadeOut(500,function(){$(this).remove()})}function h(e,s){const c=s.timeout,u=setTimeout(function(){t(e),typeof s.timeoutfn=="function"&&s.timeoutfn(e,s)},c);e.attr("timeoutId",u),e.css("transition-property","none"),e.removeClass("animate"),setTimeout(function(){e.css("transition-property",""),e.css("transition","width "+(c+450)+"ms linear, background-color "+(c+450)+"ms ease-in"),e.addClass("animate"),v.fire("action:alert.animate",{alert:e,params:s})},50),e.on("mouseenter",function(){$(this).css("transition-duration",0)})}return f}.apply(C,b),m!==void 0&&(A.exports=m)},74344:(A,C,g)=>{var b,m;b=[g(85233)],m=(o=>{const l={},v=config.relative_path+"/api/v3";function f(d,a){d.url=d.url.startsWith("/api")?config.relative_path+d.url:v+d.url;async function t(h){({options:d}=await o.fire("filter:api.options",{options:d})),$.ajax(d).done(e=>{h(null,e&&e.hasOwnProperty("status")&&e.hasOwnProperty("response")?e.response:e||{})}).fail(e=>{let s;e.responseJSON&&(s=e.responseJSON.status&&e.responseJSON.status.message?e.responseJSON.status.message:e.responseJSON.error),h(new Error(s||e.statusText))})}if(typeof a=="function"){t(a);return}return new Promise((h,e)=>{t(function(s,c){s?e(s):h(c)})})}return l.get=(d,a,t)=>f({url:d+(a&&Object.keys(a).length?"?"+$.param(a):"")},t),l.head=(d,a,t)=>f({url:d+(a&&Object.keys(a).length?"?"+$.param(a):""),method:"head"},t),l.post=(d,a,t)=>f({url:d,method:"post",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},t),l.patch=(d,a,t)=>f({url:d,method:"patch",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},t),l.put=(d,a,t)=>f({url:d,method:"put",data:JSON.stringify(a||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},t),l.del=(d,a,t)=>f({url:d,method:"delete",data:JSON.stringify(a),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},t),l.delete=l.del,l}).apply(C,b),m!==void 0&&(A.exports=m)},86193:(A,C,g)=>{var b,m;b=[g(74344),g(7927)],m=function(o,l){const v={},f={delay:200};v.init=a=>{const{input:t,source:h,onSelect:e,delay:s}={...f,...a};app.loadJQueryUI(function(){t.autocomplete({delay:s,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(c,u){d(t,e,c,u)},source:h})})},v.user=function(a,t,h){typeof t=="function"&&(h=t,t={}),t=t||{},v.init({input:a,onSelect:h,source:(e,s)=>{t.query=e.term,o.get("/api/users",t,function(c,u){if(c)return l.error(c);if(u&&u.users){const x=u.users.map(function(D){const P=$("<div></div>").html(D.username).text();return D&&{label:P,value:P,user:{uid:D.uid,name:D.username,slug:D.userslug,username:D.username,userslug:D.userslug,picture:D.picture,banned:D.banned,"icon:text":D["icon:text"],"icon:bgColor":D["icon:bgColor"]}}});s(x)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},v.group=function(a,t){v.init({input:a,onSelect:t,source:(h,e)=>{socket.emit("groups.search",{query:h.term},function(s,c){if(s)return l.error(s);if(c&&c.length){const u=c.map(function(x){return x&&{label:x.name,value:x.name,group:x}});e(u)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},v.tag=function(a,t){v.init({input:a,onSelect:t,delay:100,source:(h,e)=>{socket.emit("topics.autocompleteTags",{query:h.term,cid:ajaxify.data.cid||0},function(s,c){if(s)return l.error(s);c&&e(c),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function d(a,t,h,e){t=t||function(){};const s=jQuery.Event("keypress");s.which=13,s.keyCode=13,setTimeout(function(){a.trigger(s)},100),t(h,e)}return v}.apply(C,b),m!==void 0&&(A.exports=m)},7237:(A,C,g)=>{var b;b=function(){const m={};return m.core={"topic/teaser":function(o){return o?$('[component="category/topic"][data-tid="'+o+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(o,l){return $('[component="topic"][data-'+o+'="'+l+'"]')},post:function(o,l){return $('[component="post"][data-'+o+'="'+l+'"]')},"post/content":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/content"]')},"post/header":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/header"]')},"post/anchor":function(o){return $('[component="post"][data-index="'+o+'"] [component="post/anchor"]')},"post/vote-count":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/vote-count"]')},"post/bookmark-count":function(o){return $('[component="post"][data-pid="'+o+'"] [component="post/bookmark-count"]')},"user/postcount":function(o){return $('[component="user/postcount"][data-uid="'+o+'"]')},"user/reputation":function(o){return $('[component="user/reputation"][data-uid="'+o+'"]')},"category/topic":function(o,l){return $('[component="category/topic"][data-'+o+'="'+l+'"]')},"categories/category":function(o,l){return $('[component="categories/category"][data-'+o+'="'+l+'"]')},"chat/message":function(o){return $('[component="chat/message"][data-mid="'+o+'"]')},"chat/message/body":function(o){return $('[component="chat/message"][data-mid="'+o+'"] [component="chat/message/body"]')},"chat/recent/room":function(o){return $('[component="chat/recent/room"][data-roomid="'+o+'"]')}},m.get=function(){const o=Array.prototype.slice.call(arguments,1);return m.core[arguments[0]]&&o.length?m.core[arguments[0]].apply(this,o):$('[component="'+arguments[0]+'"]')},m}.call(C,g,C,A),b!==void 0&&(A.exports=b)},22568:(A,C,g)=>{var b,m,o;(function(l){m=[g(20648)],b=l,o=typeof b=="function"?b.apply(C,m):b,o!==void 0&&(A.exports=o)})(function(l){const v=l("[^\\p{L}\\s\\d\\-_]","g"),f=/[^\w\s\d\-_]/g,d=/^\s+|\s+$/g,a=/\s+/g,t=/-+/g,h=/-$/g,e=/^-/g,s=/^[\w\d\s.,\-@]+$/;return function(u,x){return u?(u=String(u).replace(d,""),s.test(u)?u=u.replace(f,"-"):u=l.replace(u,v,"-"),u=x?u:u.toLocaleLowerCase(),u=u.replace(a,"-"),u=u.replace(t,"-"),u=u.replace(h,""),u=u.replace(e,""),u):""}})}}]);
