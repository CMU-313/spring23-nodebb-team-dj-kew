"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[524,8894,2735,8306,6862],{30524:(E,I,u)=>{var w,y;w=[u(7237),u(32230),u(42441),u(81018),u(18596),u(46862),u(2585),u(85233),u(31369),u(7927),u(93216),u(74344),u(33371)],y=function(d,c,n,s,p,o,f,v,r,x,l,h,D){const e={initialised:!1};let m=!1;return e.init=function(){const t=utils.findBootstrapEnvironment();e.initialised||(e.addSocketListeners(),e.addGlobalEventListeners()),s.init(),e.addEventListeners(),e.setActive(),(t==="md"||t==="lg")&&e.addHotkeys(),$(document).ready(function(){v.fire("action:chat.loaded",$(".chats-full"))}),e.initialised=!0,o.scrollToBottom($(".expanded-chat ul.chat-content")),p.init(),ajaxify.data.hasOwnProperty("roomId")&&d.get("chat/input").focus()},e.addEventListeners=function(){e.addSendHandlers(ajaxify.data.roomId,$(".chat-input"),$('.expanded-chat button[data-action="send"]')),e.addPopoutHandler(),e.addActionHandlers(d.get("chat/messages"),ajaxify.data.roomId),e.addMemberHandler(ajaxify.data.roomId,d.get("chat/controls").find('[data-action="members"]')),e.addRenameHandler(ajaxify.data.roomId,d.get("chat/controls").find('[data-action="rename"]')),e.addLeaveHandler(ajaxify.data.roomId,d.get("chat/controls").find('[data-action="leave"]')),e.addScrollHandler(ajaxify.data.roomId,ajaxify.data.uid,$(".chat-content")),e.addScrollBottomHandler($(".chat-content")),e.addCharactersLeftHandler($('[component="chat/main-wrapper"]')),e.addIPHandler($('[component="chat/main-wrapper"]')),e.createAutoComplete($('[component="chat/input"]')),e.addUploadHandler({dragDropAreaEl:$(".chats-full"),pasteEl:$('[component="chat/input"]'),uploadFormEl:$('[component="chat/upload"]'),inputEl:$('[component="chat/input"]')}),$('[data-action="close"]').on("click",function(){e.switchChat()})},e.addUploadHandler=function(t){D.init({dragDropAreaEl:t.dragDropAreaEl,pasteEl:t.pasteEl,uploadFormEl:t.uploadFormEl,route:"/api/post/upload",callback:function(a){const i=t.inputEl;let g=i.val();a.forEach(A=>{g=g+(g?`
`:"")+(A.isImage?"!":"")+`[${A.filename}](${A.url})`}),i.val(g)}})},e.addIPHandler=function(t){t.on("click",".chat-ip-button",function(){const a=$(this).parent(),i=a.parents("[data-mid]").attr("data-mid");socket.emit("modules.chats.getIP",i,function(g,A){if(g)return x.error(g);a.html(A)})})},e.addPopoutHandler=function(){$('[data-action="pop-out"]').on("click",function(){const t=d.get("chat/input").val(),a=ajaxify.data.roomId;app.previousUrl&&app.previousUrl.match(/chats/)?ajaxify.go("user/"+ajaxify.data.userslug+"/chats",function(){l.openChat(a,ajaxify.data.uid)},!0):(window.history.go(-1),l.openChat(a,ajaxify.data.uid)),$(window).one("action:chat.loaded",function(){d.get("chat/input").val(t)})})},e.addScrollHandler=function(t,a,i){let g=!1;i.off("scroll").on("scroll",function(){if(o.toggleScrollUpAlert(i),g)return;const A=(i[0].scrollHeight-i.height())*.1;if(i.scrollTop()>=A)return;g=!0;const C=parseInt(i.children("[data-mid]").length,10);h.get(`/chats/${t}/messages`,{uid:a,start:C}).then(k=>{if(k=k.messages,!k){g=!1;return}if(k=k.filter(function(S){return!$('[component="chat/message"][data-mid="'+S.messageId+'"]').length}),!k.length){g=!1;return}o.parseMessage(k,function(S){const T=i.scrollTop(),R=i[0].scrollHeight;S=$(S),i.prepend(S),S.find(".timeago").timeago(),S.find("img:not(.not-responsive)").addClass("img-responsive"),i.scrollTop(i[0].scrollHeight-R+T),g=!1})}).catch(x.error)})},e.addScrollBottomHandler=function(t){t.parent().find('[component="chat/messages/scroll-up-alert"]').off("click").on("click",function(){o.scrollToBottom(t)})},e.addCharactersLeftHandler=function(t){t.find('[component="chat/input"]').on("change keyup paste",function(){o.updateRemainingLength(t)})},e.addActionHandlers=function(t,a){t.on("click","[data-action]",function(){const i=$(this).parents("[data-mid]").attr("data-mid");switch(this.getAttribute("data-action")){case"edit":{const A=$('[data-roomid="'+a+'"] [component="chat/input"]');o.prepEdit(A,i,a);break}case"delete":o.delete(i,a);break;case"restore":o.restore(i,a);break}})},e.addHotkeys=function(){n.bind("ctrl+up",function(){const a=$(".chats-list .bg-info").prev();a.length&&e.switchChat(a.attr("data-roomid"))}),n.bind("ctrl+down",function(){const a=$(".chats-list .bg-info").next();a.length&&e.switchChat(a.attr("data-roomid"))}),n.bind("up",function(t){if(t.target===d.get("chat/input").get(0)){const a=d.get("chat/messages").find('.chat-message[data-self="1"]').last();if(!a.length)return;const i=a.attr("data-mid"),g=d.get("chat/input");o.prepEdit(g,i,ajaxify.data.roomId)}})},e.addMemberHandler=function(t,a){let i;a.on("click",function(){app.parseAndTranslate("partials/modals/manage_room",{},function(g){i=r.dialog({title:"[[modules:chat.manage-room]]",message:g}),i.attr("component","chat/manage-modal"),e.refreshParticipantsList(t,i),e.addKickHandler(t,i);const A=i.find("input"),C=i.find(".text-danger");u.e(6193).then(function(){var k=[u(86193),u(32230)];(function(S,T){S.user(A,function(R,b){C.text(""),h.post(`/chats/${t}/users`,{uids:[b.item.user.uid]}).then(j=>{e.refreshParticipantsList(t,i,j),A.val("")}).catch(j=>{T.translate(j.message,function(H){C.text(H)})})})}).apply(null,k)}).catch(u.oe)})})},e.addKickHandler=function(t,a){a.on("click",'[data-action="kick"]',function(){const i=parseInt(this.getAttribute("data-uid"),10);h.delete(`/chats/${t}/users/${i}`,{}).then(g=>{e.refreshParticipantsList(t,a,g)}).catch(x.error)})},e.addLeaveHandler=function(t,a){a.on("click",function(){r.confirm({size:"small",title:"[[modules:chat.leave]]",message:'<p>[[modules:chat.leave-prompt]]</p><p class="help-block">[[modules:chat.leave-help]]</p>',callback:function(i){i&&h.delete(`/chats/${t}/users/${app.user.uid}`,{}).then(()=>{const g=a.parents(".chat-modal");g.length?l.close(g):ajaxify.go("chats")}).catch(x.error)}})})},e.refreshParticipantsList=async(t,a,i)=>{const g=a.find(".list-group");if(!i)try{i=await h.get(`/chats/${t}/users`,{})}catch{c.translate("[[error:invalid-data]]",function(C){g.find("li").text(C)})}app.parseAndTranslate("partials/modals/manage_room_users",i,function(A){g.html(A)})},e.addRenameHandler=function(t,a,i){let g;a.on("click",function(){app.parseAndTranslate("partials/modals/rename_room",{name:i||ajaxify.data.roomName},function(C){g=r.dialog({title:"[[modules:chat.rename-room]]",message:C,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:A}}})})});function A(){h.put(`/chats/${t}`,{name:g.find("#roomName").val()}).catch(x.error)}},e.addSendHandlers=function(t,a,i){a.off("keypress").on("keypress",function(g){if(g.which===13&&!g.shiftKey)return o.sendMessage(t,a),!1}),i.off("click").on("click",function(){return o.sendMessage(t,a),a.focus(),!1})},e.createAutoComplete=function(t){if(!t.length)return;const a={element:t,strategies:[],options:{style:{"z-index":2e4,flex:0,top:"inherit"},placement:"top"}};$(window).trigger("chat:autocomplete:init",a),a.strategies.length&&f.setup(a)},e.leave=function(t){const a=t.attr("data-roomid");h.delete(`/chats/${a}/users/${app.user.uid}`,{}).then(()=>{parseInt(a,10)===parseInt(ajaxify.data.roomId,10)?ajaxify.go("user/"+ajaxify.data.userslug+"/chats"):t.remove();const i=l.getModal(a);i.length&&l.close(i)}).catch(x.error)},e.switchChat=function(t){t||(t="");const a="user/"+ajaxify.data.userslug+"/chats/"+t+window.location.search;self.fetch?fetch(config.relative_path+"/api/"+a,{credentials:"include"}).then(function(i){i.ok?i.json().then(function(g){app.parseAndTranslate("partials/chats/message-window",g,function(A){d.get("chat/main-wrapper").html(A),A.find(".timeago").timeago(),ajaxify.data=g,e.setActive(),e.addEventListeners(),v.fire("action:chat.loaded",$(".chats-full")),o.scrollToBottom($(".expanded-chat ul.chat-content")),history.pushState&&history.pushState({url:a},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+a)})}):console.warn("[search] Received "+i.status)}).catch(function(i){console.warn("[search] "+i.message)}):ajaxify.go(a)},e.addGlobalEventListeners=function(){$(window).on("mousemove keypress click",function(){m&&ajaxify.data.roomId&&(socket.emit("modules.chats.markRead",ajaxify.data.roomId),m=!1)})},e.addSocketListeners=function(){socket.on("event:chats.receive",function(t){if(parseInt(t.roomId,10)===parseInt(ajaxify.data.roomId,10))m=t.self===0,t.message.self=t.self,o.appendChatMessage($(".expanded-chat .chat-content"),t.message);else if(ajaxify.data.template.chats){const a=$("[data-roomid="+t.roomId+"]");if(a.length>0)a.addClass("unread");else{const i=d.get("chat/recent");app.parseAndTranslate("partials/chats/recent_room",{rooms:{roomId:t.roomId,lastUser:t.message.fromUser,usernames:t.message.fromUser.username,unread:!0}},function(g){i.prepend(g)})}}}),socket.on("event:user_status_change",function(t){app.updateUserStatus($('.chats-list [data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}),o.addSocketListeners(),socket.on("event:chats.roomRename",function(t){const i=d.get("chat/recent/room",t.roomId).find('[component="chat/title"]');ajaxify.data.roomName=t.newName,i.text(t.newName)})},e.setActive=function(){ajaxify.data.roomId&&(socket.emit("modules.chats.markRead",ajaxify.data.roomId),$('[data-roomid="'+ajaxify.data.roomId+'"]').toggleClass("unread",!1),$('.expanded-chat [component="chat/input"]').focus()),$(".chats-list li").removeClass("bg-info"),$('.chats-list li[data-roomid="'+ajaxify.data.roomId+'"]').addClass("bg-info"),d.get("chat/nav-wrapper").attr("data-loaded",ajaxify.data.roomId?"1":"0")},e}.apply(I,w),y!==void 0&&(E.exports=y)},46862:(E,I,u)=>{var w,y;w=[u(7237),u(32230),u(59006),u(85233),u(31369),u(7927),u(44882),u(74344)],y=function(d,c,n,s,p,o,f,v){const r={};r.sendMessage=async function(e,m){let t=m.val(),a=m.attr("data-mid");if(!t.trim().length)return;m.val(""),m.removeAttr("data-mid"),r.updateRemainingLength(m.parent());const i={roomId:e,message:t,mid:a};s.fire("action:chat.sent",i),{roomId:e,message:t,mid:a}=await s.fire("filter:chat.send",i),a?v.put(`/chats/${e}/messages/${a}`,{message:t}).catch(g=>(m.val(t),m.attr("data-mid",a),r.updateRemainingLength(m.parent()),o.error(g))):v.post(`/chats/${e}`,{message:t}).catch(g=>(m.val(t),r.updateRemainingLength(m.parent()),g.message==="[[error:email-not-confirmed-chat]]"?f.showEmailConfirmWarning(g.message):o.alert({alert_id:"chat_spam_error",title:"[[global:alert.error]]",message:g.message,type:"danger",timeout:1e4})))},r.updateRemainingLength=function(e){const m=e.find('[component="chat/input"]');e.find('[component="chat/message/length"]').text(m.val().length),e.find('[component="chat/message/remaining"]').text(config.maximumChatMessageLength-m.val().length),s.fire("action:chat.updateRemainingLength",{parent:e})},r.appendChatMessage=function(e,m){const t=parseInt(e.find(".chat-message").last().attr("data-uid"),10),a=parseInt(e.find(".chat-message").last().attr("data-timestamp"),10);Array.isArray(m)||(m.newSet=t!==parseInt(m.fromuid,10)||parseInt(m.timestamp,10)>parseInt(a,10)+1e3*60*3),r.parseMessage(m,function(i){x(e,i)})};function x(e,m){const t=$(m),a=r.isAtBottom(e);t.appendTo(e),t.find(".timeago").timeago(),t.find("img:not(.not-responsive)").addClass("img-responsive"),a&&r.scrollToBottom(e),s.fire("action:chat.received",{messageEl:t})}r.parseMessage=function(e,m){function t(a){c.translate(a,m)}Array.isArray(e)?n.render("partials/chats/message"+(Array.isArray(e)?"s":""),{messages:e}).then(t):n.render("partials/chats/"+(e.system?"system-message":"message"),{messages:e}).then(t)},r.isAtBottom=function(e,m){if(e.length)return e[0].scrollHeight-(e.outerHeight()+e.scrollTop())<(m||100)},r.scrollToBottom=function(e){e&&e.length&&(e.scrollTop(e[0].scrollHeight-e.height()),e.parent().find('[component="chat/messages/scroll-up-alert"]').addClass("hidden"))},r.toggleScrollUpAlert=function(e){const m=r.isAtBottom(e,300);e.parent().find('[component="chat/messages/scroll-up-alert"]').toggleClass("hidden",m)},r.prepEdit=function(e,m,t){socket.emit("modules.chats.getRaw",{mid:m,roomId:t},function(a,i){if(a)return o.error(a);e.val().length===0&&(e.attr("data-mid",m).addClass("editing"),e.val(i).focus(),s.fire("action:chat.prepEdit",{inputEl:e,messageId:m,roomId:t}))})},r.addSocketListeners=function(){socket.removeListener("event:chats.edit",l),socket.on("event:chats.edit",l),socket.removeListener("event:chats.delete",h),socket.on("event:chats.delete",h),socket.removeListener("event:chats.restore",D),socket.on("event:chats.restore",D)};function l(e){e.messages.forEach(function(m){const t=parseInt(m.fromuid,10)===parseInt(app.user.uid,10);m.self=t?1:0,r.parseMessage(m,function(a){const i=d.get("chat/message",m.messageId);i.length&&(i.replaceWith(a),d.get("chat/message",m.messageId).find(".timeago").timeago())})})}function h(e){d.get("chat/message",e).toggleClass("deleted",!0).find('[component="chat/message/body"]').translateHtml("[[modules:chat.message-deleted]]")}function D(e){d.get("chat/message",e.messageId).toggleClass("deleted",!1).find('[component="chat/message/body"]').html(e.content)}return r.delete=function(e,m){c.translate("[[modules:chat.delete_message_confirm]]",function(t){p.confirm(t,function(a){a&&v.delete(`/chats/${m}/messages/${e}`,{}).then(()=>{d.get("chat/message",e).toggleClass("deleted",!0)}).catch(o.error)})})},r.restore=function(e,m){v.post(`/chats/${m}/messages/${e}`,{}).then(()=>{d.get("chat/message",e).toggleClass("deleted",!1)}).catch(o.error)},r}.apply(I,w),y!==void 0&&(E.exports=y)},2585:(E,I,u)=>{var w,y;w=[u(83713),u(70675),u(88207),u(62336)],y=function(d,{Textcomplete:c},{TextareaEditor:n},{ContenteditableEditor:s}){var p={_active:{}};return $(window).on("action:composer.discard",function(o,f){p._active.hasOwnProperty(f.post_uuid)&&(p._active[f.post_uuid].destroy(),delete p._active[f.post_uuid])}),p.init=function(o,f){var v=o.find(".write"),r="composer-autocomplete-dropdown-"+f,x;if(v.length){var l={element:v,strategies:[],options:{style:{"z-index":2e4},className:r+" dropdown-menu textcomplete-dropdown"}};v.on("keyup",function(){clearTimeout(x),x=setTimeout(function(){var h=document.querySelector("."+r);if(h){var D=h.getBoundingClientRect(),e=parseFloat(h.style.marginTop,10)||0,m=window.innerHeight+e-10-D.bottom;h.style.marginTop=Math.min(m,0)+"px"}},0)}),$(window).trigger("composer:autocomplete:init",l),p._active[f]=p.setup(l),l.element.on("textComplete:select",function(){d.render(o)})}},p.setup=function({element:o,strategies:f,options:v}){const r=o.get(0);if(r){var x;r.nodeName==="TEXTAREA"?x=new n(r):r.nodeName==="DIV"&&r.getAttribute("contenteditable")==="true"&&(x=new s(r)),r.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var l=new c(x,f,{dropdown:v});return l.on("rendered",function(){l.dropdown.items.length&&l.dropdown.items[0].activate()}),l}},p}.apply(I,w),y!==void 0&&(E.exports=y)},83713:(E,I,u)=>{var w,y;w=[u(85233)],y=function(d){var c={};return c.render=function(n,s){if(s=s||function(){},!n.find(".preview-container").is(":visible"))return s();var p=n.find("textarea");socket.emit("plugins.composer.renderPreview",p.val(),function(o,f){o||(f=$("<div>"+f+"</div>"),f.find("img:not(.not-responsive)").addClass("img-responsive"),n.find(".preview").html(f),d.fire("action:composer.preview"),s())})},c.matchScroll=function(n){if(n.find(".preview-container").is(":visible")){var s=n.find("textarea"),p=n.find(".preview");if(s.length&&p.length){var o=s[0].scrollHeight-s.height();if(o===0)return;var f=s.scrollTop()/o;p.scrollTop(Math.max(p[0].scrollHeight-p.height(),0)*f)}}},c.handleToggler=function(n){c.env=utils.findBootstrapEnvironment();var s=n.find(".write-container .toggle-preview"),p=n.find(".preview-container .toggle-preview"),o=$(".preview-container"),f=$(".write-container");function v(){x(!1),c.env!=="xs"&&c.env!=="sm"&&localStorage.setItem("composer:previewToggled",!0)}function r(){x(!0),c.env!=="xs"&&c.env!=="sm"&&localStorage.removeItem("composer:previewToggled")}function x(l){c.env==="xs"||c.env==="sm"?(o.toggleClass("hide",!1),f.toggleClass("maximized",!1),s.toggleClass("hide",!0),o.toggleClass("hidden-xs hidden-sm",!l),f.toggleClass("hidden-xs hidden-sm",l),l&&c.render(n)):(o.toggleClass("hide",!l),f.toggleClass("maximized",!l),s.toggleClass("hide",l)),c.matchScroll(n)}c.toggle=x,p.on("click",function(){v(),n.find(".write").focus()}),s.on("click",function(){r(),n.find(".write").focus()}),localStorage.getItem("composer:previewToggled")||c.env==="xs"||c.env==="sm"?v():r()},c}.apply(I,w),y!==void 0&&(E.exports=y)},44882:(E,I,u)=>{var w,y;w=[u(31369),u(32230),u(66603),u(7927),u(85233)],y=function(d,c,n,s,p){const o={};let f,v;o.show=function(){p.one("action:ajaxify.end",()=>{x(),r(),o.showEmailConfirmWarning()})},o.showEmailConfirmWarning=function(l){if(!config.emailPrompt||!app.user.uid||parseInt(n.getItem("email-confirm-dismiss"),10)===1)return;const h={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{n.setItem("email-confirm-dismiss",1)}};app.user.email?!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(h.message=l||"[[error:email-not-confirmed]]",h.clickfn=function(){s.remove("email_confirm"),ajaxify.go("/me/edit/email")},s.alert(h)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(h.message="[[error:email-not-confirmed-email-sent]]",s.alert(h)):(h.message="[[error:no-email-to-confirm]]",h.clickfn=function(){s.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},s.alert(h))};function r(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||n.getItem("cookieconsent")==="1"||(config.cookies.message=c.unescape(config.cookies.message),config.cookies.dismiss=c.unescape(config.cookies.dismiss),config.cookies.link=c.unescape(config.cookies.link),config.cookies.link_url=c.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(l){$(document.body).append(l),$(document.body).addClass("cookie-consent-open");const h=$(".cookie-consent");h.find("button").on("click",function(){n.setItem("cookieconsent","1"),h.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function x(){const l=utils.params({full:!0});f=l.has("loggedin"),v=l.get("register"),f&&(s.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),l.delete("loggedin")),v&&(d.alert({message:utils.escapeHTML(decodeURIComponent(v))}),l.delete("register")),l.has("lang")&&l.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${l.get("lang")}", but that is already the forum default language.`),l.delete("lang"));const h=l.toString();ajaxify.updateHistory(ajaxify.currentPage+(h?`?${h}`:"")+document.location.hash,!0)}return o.showInvalidSession=function(){d.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},o.showSessionMismatch=function(){d.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},o}.apply(I,w),y!==void 0&&(E.exports=y)},66603:(E,I,u)=>{var w;w=function(){function y(){this._store={},this._keys=[]}y.prototype.isMock=!0,y.prototype.setItem=function(n,s){n=String(n),this._keys.indexOf(n)===-1&&this._keys.push(n),this._store[n]=s},y.prototype.getItem=function(n){return n=String(n),this._keys.indexOf(n)===-1?null:this._store[n]},y.prototype.removeItem=function(n){n=String(n),this._keys=this._keys.filter(function(s){return s!==n}),this._store[n]=null},y.prototype.clear=function(){this._keys=[],this._store={}},y.prototype.key=function(n){return n=parseInt(n,10)||0,this._keys[n]},Object.defineProperty&&Object.defineProperty(y.prototype,"length",{get:function(){return this._keys.length}});let d;const c=Date.now().toString();try{if(d=window.localStorage,d.setItem(c,c),d.getItem(c)!==c)throw Error("localStorage behaved unexpectedly");return d.removeItem(c),d}catch(n){console.warn(n),console.warn("localStorage failed, falling back on sessionStorage");try{if(d=window.sessionStorage,d.setItem(c,c),d.getItem(c)!==c)throw Error("sessionStorage behaved unexpectedly");return d.removeItem(c),d}catch(s){return console.warn(s),console.warn("sessionStorage failed, falling back on memory storage"),new y}}}.call(I,u,I,E),w!==void 0&&(E.exports=w)},33371:(E,I,u)=>{var w,y;w=[u(7927)],y=function(d){const c={};return c.init=function(n){const s=n.uploadFormEl;s.length&&(s.attr("action",config.relative_path+n.route),n.dragDropAreaEl&&c.handleDragDrop({container:n.dragDropAreaEl,callback:function(p){c.ajaxSubmit({uploadForm:s,upload:p,callback:n.callback})}}),n.pasteEl&&c.handlePaste({container:n.pasteEl,callback:function(p){c.ajaxSubmit({uploadForm:s,upload:p,callback:n.callback})}}))},c.handleDragDrop=function(n){let s=!1;const p=n.container,o=n.container.find(".imagedrop");p.on("dragenter",function(){s||(o.css("top","0px"),o.css("height",p.height()+"px"),o.css("line-height",p.height()+"px"),o.show(),o.on("dragleave",function(){o.hide(),o.off("dragleave")}))}),o.on("drop",function(r){r.preventDefault();const x=r.originalEvent.dataTransfer.files;if(x.length){let h;if(window.FormData){h=new FormData;for(var l=0;l<x.length;++l)h.append("files[]",x[l],x[l].name)}n.callback({files:x,formData:h})}return o.hide(),!1});function f(v){return v.preventDefault(),!1}$(document).off("dragstart").on("dragstart",function(){s=!0}).off("dragend").on("dragend, mouseup",function(){s=!1}),o.on("dragover",f),o.on("dragenter",f)},c.handlePaste=function(n){n.container.on("paste",function(p){const o=(p.clipboardData||p.originalEvent.clipboardData||{}).items,f=[],v=[];let r=null;window.FormData&&(r=new FormData),[].forEach.call(o,function(x){const l=x.getAsFile();if(l){const h=utils.generateUUID()+"-"+l.name;r&&r.append("files[]",l,h),f.push(l),v.push(h)}}),f.length&&n.callback({files:f,fileNames:v,formData:r})})},c.ajaxSubmit=function(n){const s=[...n.upload.files];for(let o=0;o<s.length;++o){const f=s[o].type.match(/image./);if(f&&!app.user.privileges["upload:post:image"]||!f&&!app.user.privileges["upload:post:file"])return d.error("[[error:no-privileges]]");if(s[o].size>parseInt(config.maximumFileSize,10)*1024)return n.uploadForm[0].reset(),d.error("[[error:file-too-big, "+config.maximumFileSize+"]]")}const p=Date.now();n.uploadForm.off("submit").on("submit",function(){return $(this).ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},resetForm:!0,clearForm:!0,formData:n.upload.formData,error:function(o){let f=o.responseJSON&&(o.responseJSON.error||o.responseJSON.status&&o.responseJSON.status.message)||"[[error:parse-error]]";o&&o.status===413&&(f=o.statusText||"Request Entity Too Large"),d.error(f),d.remove(p)},uploadProgress:function(o,f,v,r){d.alert({alert_id:p,message:"[[modules:composer.uploading, "+r+"%]]"})},success:function(o){const f=o.response.images;if(f&&f.length)for(var v=0;v<f.length;++v)f[v].filename=s[v].name,f[v].isImage=/image./.test(s[v].type);n.callback(f)},complete:function(){n.uploadForm[0].reset(),setTimeout(d.remove,100,p)}}),!1}),n.uploadForm.submit()},c}.apply(I,w),y!==void 0&&(E.exports=y)}}]);
