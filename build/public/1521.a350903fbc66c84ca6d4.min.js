"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1521,2160,8306,3913,7073],{44541:(D,L,m)=>{var I,E;I=[m(27145),m(32230),m(22143),m(45482),m(47913),m(88186),m(98755),m(83713),m(38259),m(2585),m(98166),m(75203),m(62023),m(74344),m(31369),m(7927),m(85233),m(44882),m(7073),m(10577)],E=function(v,p,u,g,c,x,a,s,r,o,n,f,w,h,C,O,b,k,z,A){var t={active:void 0,posts:{},bsEnvironment:void 0,formatting:void 0};$(window).off("resize",q).on("resize",q),q(),$(window).on("action:composer.topics.post",function(e,i){localStorage.removeItem("category:"+i.data.cid+":bookmark"),localStorage.removeItem("category:"+i.data.cid+":bookmark:clicked")}),$(window).on("popstate",function(){var e=utils.findBootstrapEnvironment();if(t.active&&(e==="xs"||e==="sm")){if(!t.posts[t.active].modified){t.discard(t.active),t.discardConfirm&&t.discardConfirm.length&&(t.discardConfirm.modal("hide"),delete t.discardConfirm);return}p.translate("[[modules:composer.discard]]",function(i){t.discardConfirm=C.confirm(i,function(l){l?t.discard(t.active):t.posts[t.active].modified=!0}),t.posts[t.active].modified=!1})}});function R(){var e=t.bsEnvironment;(ajaxify.data.template.compose===!0||e==="xs"||e==="sm")&&history.back()}function q(){var e=utils.findBootstrapEnvironment(),i=e==="xs"||e==="sm";s.toggle&&(s.env!==e&&i&&(s.env=e,s.toggle(!1)),s.env=e),t.active!==void 0&&(r.reposition($('.composer[data-uuid="'+t.active+'"]')),!i&&window.location.pathname.startsWith(config.relative_path+"/compose")?history.back():i&&!window.location.pathname.startsWith(config.relative_path+"/compose")&&te()),t.bsEnvironment=e}function re(e){var i,l;e.hasOwnProperty("cid")?i="cid":e.hasOwnProperty("tid")?i="tid":e.hasOwnProperty("pid")&&(i="pid"),l=e[i];for(var d in t.posts)if(t.posts[d].hasOwnProperty(i)&&l===t.posts[d][i])return d;return!1}function Z(e){var i=utils.generateUUID(),l=re(e);if(l)return v.updateActive(l),t.load(l);var d="[[topic:composer.new_topic]]";e.action==="posts.reply"?d="[[topic:composer.replying_to]]":e.action==="posts.edit"&&(d="[[topic:composer.editing]]"),p.translate(d,function(y){v.push("composer",i,{title:y.replace("%1",'"'+e.title+'"')})}),e.hasOwnProperty("cid")?e.save_id=["composer",app.user.uid,"cid",e.cid].join(":"):e.hasOwnProperty("tid")?e.save_id=["composer",app.user.uid,"tid",e.tid].join(":"):e.hasOwnProperty("pid")&&(e.save_id=["composer",app.user.uid,"pid",e.pid].join(":")),t.posts[i]=e,t.load(i)}async function F(e,i){$('.composer[data-uuid="'+e+'"]').find(".composer-submit").removeAttr("disabled"),$('.composer[data-uuid="'+e+'"]').find(".composer-submit-anon").removeAttr("disabled"),$('.composer[data-uuid="'+e+'"]').find(".composer-submit-private").removeAttr("disabled");const{showAlert:l}=await b.fire("filter:composer.error",{post_uuid:e,message:i,showAlert:!0});l&&O.alert({type:"danger",timeout:1e4,title:"",message:i,alert_id:"post_error"})}t.findByTid=function(e){for(var i in t.posts)if(t.posts.hasOwnProperty(i)&&t.posts[i].hasOwnProperty("tid")&&parseInt(t.posts[i].tid,10)===parseInt(e,10))return i;return null},t.addButton=function(e,i,l){g.addButton(e,i,l)},t.newTopic=async e=>{var i={action:"topics.post",cid:e.cid,handle:e.handle,title:e.title||"",body:e.body||"",tags:e.tags||[],modified:!!(e.title&&e.title.length||e.body&&e.body.length),isMain:!0};({pushData:i}=await b.fire("filter:composer.topic.push",{data:e,pushData:i})),Z(i)},t.addQuote=function(e,i,l,d,y,S,P){P=P||t.active;var M=(d||"").replace(/([\\`*_{}[\]()#+\-.!])/g,"\\$1").replace(/\[/g,"&#91;").replace(/\]/g,"&#93;").replace(/%/g,"&#37;").replace(/,/g,"&#44;");S&&(S="> "+S.replace(/\n/g,`
> `)+`

`);var T="["+M+"]("+config.relative_path+"/post/"+(l||i)+")";if(P===void 0){d&&(l||i)?t.newReply(e,i,d,"[[modules:composer.user_said_in, "+y+", "+T+`]]
`+S):t.newReply(e,i,d,"[[modules:composer.user_said, "+y+`]]
`+S);return}else P!==t.active&&t.load(P);var B=$('.composer[data-uuid="'+P+'"]'),W=B.find("textarea"),j=W.val();d&&(l||i)?p.translate("[[modules:composer.user_said_in, "+y+", "+T+`]]
`,config.defaultLang,Y):p.translate("[[modules:composer.user_said, "+y+`]]
`,config.defaultLang,Y);function Y(N){t.posts[P].body=(j.length?j+`

`:"")+N+S,W.val(t.posts[P].body),V(B),s.render(B)}},t.newReply=function(e,i,l,d){p.translate(d,config.defaultLang,function(y){Z({action:"posts.reply",tid:e,toPid:i,title:l,body:y,modified:!!(l&&l.length||y&&y.length),isMain:!1})})},t.editPost=function(e){socket.emit("plugins.composer.push",e,function(i,l){if(i)return O.error(i);l.action="posts.edit",l.pid=e,l.modified=!1,Z(l)})},t.load=function(e){var i=$('.composer[data-uuid="'+e+'"]');i.length?(ie(e),r.reposition(i),V(i),ne()):t.formatting?ee(e):socket.emit("plugins.composer.getFormattingOptions",function(l,d){if(l)return O.error(l);t.formatting=d,ee(e)})},t.enhance=function(e,i,l){!i&&!l&&(i=utils.generateUUID(),t.posts[i]=ajaxify.data,l=ajaxify.data,e.attr("data-uuid",i));var d=e.find("textarea"),y=e.find(".composer-submit"),S=e.find(".composer-submit-anon"),P=e.find(".composer-submit-private");a.init(e,t.posts[i]),n.init(e,t.posts),g.addHandler(e),g.addComposerButtons(),s.handleToggler(e),u.initialize(i),x.init(e,t.posts[i]),o.init(e,i),e.on("change","input, textarea",function(){t.posts[i].modified=!0,c.updateVisibility("available",t.posts[i].save_id,!0),c.updateVisibility("open",t.posts[i].save_id,!0)}),y.on("click",function(T){T.preventDefault(),T.stopPropagation(),$(this).attr("disabled",!0),J(i)}),S.on("click",function(T){T.preventDefault(),T.stopPropagation(),$(this).attr("disabled",!0),J(i,!0)}),P.on("click",function(T){T.preventDefault(),T.stopPropagation(),$(this).attr("disabled",!0),J(i,null,!0)}),m.e(2441).then(function(){var T=[m(42441)];(function(B){B(e.get(0)).bind("mod+enter",function(){y.attr("disabled",!0),J(i)})}).apply(null,T)}).catch(m.oe),e.find(".composer-discard").on("click",function(T){if(T.preventDefault(),!t.posts[i].modified)return t.discard(i),R();g.exitFullscreen();var B=$(this).prop("disabled",!0);p.translate("[[modules:composer.discard]]",function(W){C.confirm(W,function(j){j&&(t.discard(i),R()),B.prop("disabled",!1)})})}),e.find(".composer-minimize, .minimize .trigger").on("click",function(T){T.preventDefault(),T.stopPropagation(),t.minimize(i)}),d.on("input propertychange",utils.debounce(function(){s.render(e)},250)),d.on("scroll",function(){s.matchScroll(e)}),c.init(e,l);const M=c.get(l.save_id);s.render(e,function(){s.matchScroll(e)}),le(e),fe(e),V(e),l.action==="posts.edit"&&t.updateThumbCount(i,e),A.isEnabled||$('[data-format="zen"]').addClass("hidden"),b.fire("action:composer.enhanced",{postContainer:e,postData:l,draft:M})};async function ce(e){return ajaxify.data.template.category?ajaxify.data:parseInt(e.cid,10)?await h.get(`/api/category/${e.cid}`,{}):null}async function ee(e){var i=t.posts[e],l=i?i.hasOwnProperty("cid"):!1,d=i?!!i.isMain:!1,y=i?!!i.pid:!1,S=i?parseInt(i.uid,10)===0:!1;const P=i.timestamp>Date.now();var M=i.title.replace(/%/g,"&#37;").replace(/,/g,"&#44;");i.category=await ce(i);const T=i.category?i.category.privileges:ajaxify.data.privileges;var B={title:M,titleLength:M.length,body:i.body,mobile:t.bsEnvironment==="xs"||t.bsEnvironment==="sm",resizable:!0,thumb:i.thumb,isTopicOrMain:l||d,maximumTitleLength:config.maximumTitleLength,maximumPostLength:config.maximumPostLength,minimumTagLength:config.minimumTagLength,maximumTagLength:config.maximumTagLength,isTopic:l,isEditing:y,canSchedule:!!(d&&T&&(T["topics:schedule"]&&!y||P&&T.view_scheduled)),showHandleInput:config.allowGuestHandles&&(app.user.uid===0||y&&S&&app.user.isAdmin),handle:i?i.handle||"":void 0,formatting:t.formatting,tagWhitelist:i.category?i.category.tagWhitelist:ajaxify.data.tagWhitelist,privileges:app.user.privileges,selectedCategory:i.category,submitOptions:[]};B.mobile&&(te(),app.toggleNavbar(!1)),i.mobile=t.bsEnvironment==="xs"||t.bsEnvironment==="sm",{postData:i,createData:B}=await b.fire("filter:composer.create",{postData:i,createData:B}),app.parseAndTranslate("composer",B,function(W){if(!$('.composer.composer[data-uuid="'+e+'"]').length){W=$(W),W.find(".title").each(function(){$(this).text(p.unescape($(this).text()))}),W.attr("data-uuid",e),$(document.body).append(W);var j=$(W[0]);if(r.reposition(j),t.enhance(j,e,i),ie(e),j.on("click",function(){v.isActive(e)||v.updateActive(e)}),r.handleResize(j),t.bsEnvironment==="xs"||t.bsEnvironment==="sm"){var Y=j.find(".composer-submit"),N=j.find(".mobile-navbar .composer-submit"),Q=j.find(".write"),_=Q.attr("tabindex");Y.removeAttr("tabindex"),N.attr("tabindex",parseInt(_,10)+1),$(".category-name-container").on("click",function(){$(".category-selector").toggleClass("open")})}$(window).trigger("action:composer.loaded",{postContainer:j,post_uuid:e,composerData:t.posts[e],formatting:t.formatting}),f.apply(j.find(".write")),V(j),ne()}})}function te(){var e="compose?p="+window.location.pathname,i=window.location.pathname.slice(1)+window.location.search;i.startsWith(config.relative_path.slice(1))&&(i=i.slice(config.relative_path.length)),window.history.replaceState({url:null,returnPath:i},i,config.relative_path+"/"+i),window.history.pushState({url:e},e,`${config.relative_path}/${i}`)}function le(e){var i=e.find(".help");socket.emit("plugins.composer.renderHelp",function(l,d){!l&&d&&d.length>0&&(i.removeClass("hidden"),i.on("click",function(){C.alert(d)}))})}function fe(e){var i=e.attr("data-uuid"),l=t.posts[i]&&t.posts[i].action==="posts.edit",d=utils.findBootstrapEnvironment(),y=d==="xs"||d==="sm";l||y||z.enableQuickSearch({searchElements:{inputEl:e.find("input.title"),resultEl:e.find(".quick-search-container")},hideOnNoMatches:!0})}function ie(e){t.active&&t.active!==e&&t.minimize(t.active),t.active=e,$(window).trigger("action:composer.activate",{post_uuid:e})}function V(e){setTimeout(function(){var i=e.find("input.title");i.length?i.focus():e.find("textarea").focus().putCursorAtEnd()},20)}async function J(e,i,l){var d=t.posts[e],y=$('.composer[data-uuid="'+e+'"]'),S=y.find(".handle"),P=y.find(".title"),M=y.find("textarea"),T=y.find("input#topic-thumb-url"),B=d.hasOwnProperty("template")&&d.template.compose===!0;const W=y.find(".composer-submit"),j=y.find(".composer-submit-anon"),Y=y.find(".composer-submit-private");P.val(P.val().trim()),M.val(utils.rtrim(M.val())),T.length&&T.val(T.val().trim());var N=d.action,Q=(d.hasOwnProperty("cid")||parseInt(d.pid,10))&&y.find("input.title").length,_=!Q||Q&&parseInt(d.cid,10),K={post_uuid:e,postData:d,postContainer:y,titleEl:P,titleLen:P.val().length,bodyEl:M,bodyLen:M.val().length};if(await b.fire("filter:composer.check",K),$(window).trigger("action:composer.check",K),K.error)return F(e,K.error);if(u.inProgress[e]&&u.inProgress[e].length)return F(e,"[[error:still-uploading]]");if(Q&&K.titleLen<parseInt(config.minimumTitleLength,10))return F(e,"[[error:title-too-short, "+config.minimumTitleLength+"]]");if(Q&&K.titleLen>parseInt(config.maximumTitleLength,10))return F(e,"[[error:title-too-long, "+config.maximumTitleLength+"]]");if(N==="topics.post"&&!_)return F(e,"[[error:category-not-selected]]");if(K.bodyLen<parseInt(config.minimumPostLength,10))return F(e,"[[error:content-too-short, "+config.minimumPostLength+"]]");if(K.bodyLen>parseInt(config.maximumPostLength,10))return F(e,"[[error:content-too-long, "+config.maximumPostLength+"]]");if(Q&&!x.isEnoughTags(e))return F(e,"[[error:not-enough-tags, "+x.minTagCount()+"]]");if(n.isActive()&&n.getTimestamp()<=Date.now())return F(e,"[[error:scheduling-to-past]]");let H={uuid:e},ae="post",G="";N==="topics.post"?(G="/topics",H={...H,handle:S?S.val():void 0,title:P.val(),content:M.val(),thumb:T.val()||"",cid:a.getSelectedCid(),tags:x.getTags(e),timestamp:n.getTimestamp(),isAnon:i,isPrivate:l}):N==="posts.reply"?(G=`/topics/${d.tid}`,H={...H,tid:d.tid,handle:S?S.val():void 0,content:M.val(),toPid:d.toPid,isAnon:i,isPrivate:l}):N==="posts.edit"&&(ae="put",G=`/posts/${d.pid}`,H={...H,pid:d.pid,handle:S?S.val():void 0,content:M.val(),title:P.val(),thumb:T.val()||"",tags:x.getTags(e),timestamp:n.getTimestamp(),isAnon:i,isPrivate:l});var X={composerEl:y,action:N,composerData:H,postData:d,redirect:!0};await b.fire("filter:composer.submit",X),b.fire("action:composer.submit",Object.freeze(X));var de=$('#taskbar .composer[data-uuid="'+e+'"] i'),se=y.find(".write");de.removeClass("fa-plus").addClass("fa-circle-o-notch fa-spin"),t.minimize(e),se.prop("readonly",!0),h[ae](G,H).then(U=>{W.removeAttr("disabled"),j.removeAttr("disabled"),Y.removeAttr("disabled"),d.submitted=!0,t.discard(e),c.removeDraft(d.save_id),U.queued?O.alert({type:"success",title:"[[global:alert.success]]",message:U.message,timeout:1e4,clickfn:function(){ajaxify.go(`/post-queue/${U.id}`)}}):N==="topics.post"?X.redirect&&ajaxify.go("topic/"+U.slug,void 0,B||t.bsEnvironment==="xs"||t.bsEnvironment==="sm"):N==="posts.reply"?B||t.bsEnvironment==="xs"||t.bsEnvironment==="sm"?window.history.back():X.redirect&&(ajaxify.data.template.name!=="topic"||ajaxify.data.template.topic&&parseInt(d.tid,10)!==parseInt(ajaxify.data.tid,10))&&ajaxify.go("post/"+U.pid):R(),b.fire("action:composer."+N,{composerData:H,data:U})}).catch(U=>{if(t.load(e),se.prop("readonly",!1),U.message==="[[error:email-not-confirmed]]")return k.showEmailConfirmWarning(U.message);F(e,U.message)})}function ne(){$("html").addClass("composing")}function oe(){$("body").css({paddingBottom:0}),$("html").removeClass("composing"),app.toggleNavbar(!0)}return t.discard=function(e){if(t.posts[e]){var i=t.posts[e],l=$('.composer[data-uuid="'+e+'"]');l.remove(),c.removeDraft(i.save_id),w.deleteAll(e),v.discard("composer",e),$('[data-action="post"]').removeAttr("disabled"),b.fire("action:composer.discard",{post_uuid:e,postData:i}),delete t.posts[e],t.active=void 0}n.reset(),oe()},t.close=t.discard,t.minimize=function(e){var i=$('.composer[data-uuid="'+e+'"]');i.css("visibility","hidden"),t.active=void 0,v.minimize("composer",e),$(window).trigger("action:composer.minimize",{post_uuid:e}),oe()},t.minimizeActive=function(){t.active&&t.miminize(t.active)},t.updateThumbCount=function(e,i){const l=t.posts[e];if(l.action==="topics.post"||l.action==="posts.edit"&&l.isMain){const d=[w.get(e)];l.pid&&d.push(w.getByPid(l.pid)),Promise.all(d).then(y=>{y=y.reduce((S,P)=>(S=S.concat(P),S)),y.length&&i.find('[data-format="thumbs"]').attr("data-count",y.length)})}},t}.apply(L,I),E!==void 0&&(D.exports=E)},2585:(D,L,m)=>{var I,E;I=[m(83713),m(70675),m(88207),m(62336)],E=function(v,{Textcomplete:p},{TextareaEditor:u},{ContenteditableEditor:g}){var c={_active:{}};return $(window).on("action:composer.discard",function(x,a){c._active.hasOwnProperty(a.post_uuid)&&(c._active[a.post_uuid].destroy(),delete c._active[a.post_uuid])}),c.init=function(x,a){var s=x.find(".write"),r="composer-autocomplete-dropdown-"+a,o;if(s.length){var n={element:s,strategies:[],options:{style:{"z-index":2e4},className:r+" dropdown-menu textcomplete-dropdown"}};s.on("keyup",function(){clearTimeout(o),o=setTimeout(function(){var f=document.querySelector("."+r);if(f){var w=f.getBoundingClientRect(),h=parseFloat(f.style.marginTop,10)||0,C=window.innerHeight+h-10-w.bottom;f.style.marginTop=Math.min(C,0)+"px"}},0)}),$(window).trigger("composer:autocomplete:init",n),c._active[a]=c.setup(n),n.element.on("textComplete:select",function(){v.render(x)})}},c.setup=function({element:x,strategies:a,options:s}){const r=x.get(0);if(r){var o;r.nodeName==="TEXTAREA"?o=new u(r):r.nodeName==="DIV"&&r.getAttribute("contenteditable")==="true"&&(o=new g(r)),r.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var n=new p(o,a,{dropdown:s});return n.on("rendered",function(){n.dropdown.items.length&&n.dropdown.items[0].activate()}),n}},c}.apply(L,I),E!==void 0&&(D.exports=E)},98166:(D,L,m)=>{var I,E;I=[m(59006),m(31369),m(7927)],E=function(v,p,u){const g={},c={timestamp:0,open:!1,edit:!1,posts:{}};let x=[],a;const s={el:null,icon:null,defaultText:"",activeText:""};let r,o;$(window).on("action:composer.activate",h),g.init=function(A,t){c.timestamp=0,c.posts=t,x=A[0].querySelectorAll(".display-scheduler"),a=A[0].querySelectorAll(".display-scheduler i"),s.el=A[0].querySelector(".composer-submit:not(.btn-sm)"),s.icon=s.el.querySelector("i"),s.defaultText=s.el.lastChild.textContent,s.activeText=s.el.getAttribute("data-text-variant"),a.forEach(R=>R.addEventListener("click",n))},g.getTimestamp=function(){return!g.isActive()||isNaN(c.timestamp)?0:c.timestamp},g.isActive=function(){return c.timestamp>0},g.isOpen=function(){return c.open},g.reset=function(){c.timestamp=0},g.onChangeCategory=function(A){z(A.privileges["topics:schedule"]),k(!1),g.reset()};async function n(){const A=await v.render("modals/topic-scheduler");p.dialog({message:A,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:f,onHidden:w,onEscape:!0,buttons:{cancel:{label:c.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(c.timestamp?"btn-warning":"btn-default")+(c.edit?" hidden":""),callback:b},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:O}}})}function f(A){c.open=!0;const t=A.target.querySelector(".datetime-picker");r=t.querySelector('input[type="date"]'),o=t.querySelector('input[type="time"]'),C()}function w(){c.open=!1}function h(A,{post_uuid:t}){c.edit=!1;const R=c.posts[t];R&&R.isMain&&R.timestamp>Date.now()&&(c.timestamp=R.timestamp,c.edit=!0,k())}function C(){const A=new Date,t=new Date(A.getTime()-A.getTimezoneOffset()*6e4).toJSON();if(r.setAttribute("min",t.slice(0,10)),o.setAttribute("min",t.slice(11,-8)),g.isActive()){const R=new Date(c.timestamp-A.getTimezoneOffset()*6e4).toJSON();r.value=R.slice(0,10),o.value=R.slice(11,-8)}}function O(){const A=r.value&&o.value,t=new Date(`${r.value} ${o.value}`).getTime();if(!A||isNaN(t)||t<Date.now()){c.timestamp=0;const R=t<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return u.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:R}),!1}c.timestamp||k(!0),c.timestamp=t}function b(){c.timestamp&&(k(!1),c.timestamp=0)}function k(A=!0){a.forEach(t=>t.classList.toggle("active",A)),s.icon&&(s.icon.classList.toggle("fa-check",!A),s.icon.classList.toggle("fa-clock-o",A)),s.el.lastChild.textContent=A?s.activeText:s.defaultText}function z(A){x.forEach(t=>t.classList.toggle("hidden",!A))}return g}.apply(L,I),E!==void 0&&(D.exports=E)},88186:(D,L,m)=>{var I,E;I=[m(7927)],E=function(v){var p={},u,g;p.init=function(s,r){var o=s.find(".tags");if(o.length){u=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,g=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,o.tagsinput({confirmKeys:[13,44],trimValue:!0});var n=s.find(".bootstrap-tagsinput input");c(s,r,ajaxify.data),app.loadJQueryUI(function(){n.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:s.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(h,C){socket.emit("topics.autocompleteTags",{query:h.term,cid:r.cid},function(O,b){if(O)return v.error(O);b&&C(b),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){x(n)}}),a(r.tags,o),o.on("beforeItemAdd",function(h){var C=g&&g<=p.getTags(s.attr("data-uuid")).length,O=utils.cleanUpTag(h.item,config.maximumTagLength),b=O!==h.item;if(h.cancel=b||h.item.length<config.minimumTagLength||h.item.length>config.maximumTagLength||C,h.item.length<config.minimumTagLength)return v.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(h.item.length>config.maximumTagLength)return v.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(C)return v.error("[[error:too-many-tags, "+g+"]]");b&&o.tagsinput("add",O)});var f=!1,w=!1;o.on("itemRemoved",function(h){if(w){w=!1;return}h.item&&socket.emit("topics.canRemoveTag",{tag:h.item},function(C,O){if(C)return v.error(C);O||(v.error("[[error:cant-remove-system-tag]]"),f=!0,o.tagsinput("add",h.item))})}),o.on("itemAdded",function(h){if(f){f=!1;return}var C=r.hasOwnProperty("cid")?r.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:h.item,cid:C||0},function(O,b){if(O)return v.error(O);if(!b)return w=!0,o.tagsinput("remove",h.item);$(window).trigger("action:tag.added",{cid:C,tagEl:o,tag:h.item}),n.length&&n.autocomplete("close")})})}),n.attr("tabIndex",o.attr("tabIndex")),n.on("blur",function(){x(n)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var f=$(this).attr("data-tag");return f&&a([f],o),!1})}},p.isEnoughTags=function(s){return p.getTags(s).length>=u},p.minTagCount=function(){return u},p.onChangeCategory=function(s,r,o,n){var f=s.find('[component="composer/tag/dropdown"]');f.length&&(c(s,r,n),f.toggleClass("hidden",!n.tagWhitelist||!n.tagWhitelist.length),n.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:n.tagWhitelist},function(w){f.find(".dropdown-menu").html(w)}))};function c(s,r,o){var n=s.find(".tags"),f=s.find(".bootstrap-tagsinput input");f.length&&(o.hasOwnProperty("minTags")&&(u=o.minTags),o.hasOwnProperty("maxTags")&&(g=o.maxTags),o.tagWhitelist&&o.tagWhitelist.length?(f.attr("readonly",""),f.attr("placeholder",""),n.tagsinput("items").slice().forEach(function(w){o.tagWhitelist.indexOf(w)===-1&&n.tagsinput("remove",w)})):(f.removeAttr("readonly"),f.attr("placeholder",s.find("input.tags").attr("placeholder"))),s.find(".tags-container").toggleClass("hidden",o.privileges&&o.privileges.hasOwnProperty("topics:tag")&&!o.privileges["topics:tag"]||g===0&&!r&&!r.tags&&!r.tags.length),o.privileges&&o.privileges.hasOwnProperty("topics:tag")&&!o.privileges["topics:tag"]&&n.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:s,tagWhitelist:o.tagWhitelist,tagsInput:f}))}function x(s){var r=jQuery.Event("keypress");r.which=13,r.keyCode=13,setTimeout(function(){s.trigger(r)},100)}function a(s,r){if(s&&s.length)for(var o=0;o<s.length;++o)r.tagsinput("add",s[o])}return p.getTags=function(s){return $('.composer[data-uuid="'+s+'"] .tags').tagsinput("items")},p}.apply(L,I),E!==void 0&&(D.exports=E)},44882:(D,L,m)=>{var I,E;I=[m(31369),m(32230),m(66603),m(7927),m(85233)],E=function(v,p,u,g,c){const x={};let a,s;x.show=function(){c.one("action:ajaxify.end",()=>{o(),r(),x.showEmailConfirmWarning()})},x.showEmailConfirmWarning=function(n){if(!config.emailPrompt||!app.user.uid||parseInt(u.getItem("email-confirm-dismiss"),10)===1)return;const f={alert_id:"email_confirm",type:"warning",timeout:0,closefn:()=>{u.setItem("email-confirm-dismiss",1)}};app.user.email?!app.user["email:confirmed"]&&!app.user.isEmailConfirmSent?(f.message=n||"[[error:email-not-confirmed]]",f.clickfn=function(){g.remove("email_confirm"),ajaxify.go("/me/edit/email")},g.alert(f)):!app.user["email:confirmed"]&&app.user.isEmailConfirmSent&&(f.message="[[error:email-not-confirmed-email-sent]]",g.alert(f)):(f.message="[[error:no-email-to-confirm]]",f.clickfn=function(){g.remove("email_confirm"),ajaxify.go("user/"+app.user.userslug+"/edit/email")},g.alert(f))};function r(){!config.cookies.enabled||!navigator.cookieEnabled||app.inAdmin||u.getItem("cookieconsent")==="1"||(config.cookies.message=p.unescape(config.cookies.message),config.cookies.dismiss=p.unescape(config.cookies.dismiss),config.cookies.link=p.unescape(config.cookies.link),config.cookies.link_url=p.unescape(config.cookies.link_url),app.parseAndTranslate("partials/cookie-consent",config.cookies,function(n){$(document.body).append(n),$(document.body).addClass("cookie-consent-open");const f=$(".cookie-consent");f.find("button").on("click",function(){u.setItem("cookieconsent","1"),f.remove(),$(document.body).removeClass("cookie-consent-open")})}))}function o(){const n=utils.params({full:!0});a=n.has("loggedin"),s=n.get("register"),a&&(g.alert({type:"success",title:"[[global:welcome_back]] "+app.user.username+"!",message:"[[global:you_have_successfully_logged_in]]",timeout:5e3}),n.delete("loggedin")),s&&(v.alert({message:utils.escapeHTML(decodeURIComponent(s))}),n.delete("register")),n.has("lang")&&n.get("lang")===config.defaultLang&&(console.info(`The "lang" parameter was passed in to set the language to "${n.get("lang")}", but that is already the forum default language.`),n.delete("lang"));const f=n.toString();ajaxify.updateHistory(ajaxify.currentPage+(f?`?${f}`:"")+document.location.hash,!0)}return x.showInvalidSession=function(){v.alert({title:"[[error:invalid-session]]",message:"[[error:invalid-session-text]]",closeButton:!1,callback:function(){window.location.reload()}})},x.showSessionMismatch=function(){v.alert({title:"[[error:session-mismatch]]",message:"[[error:session-mismatch-text]]",closeButton:!1,callback:function(){window.location.reload()}})},x}.apply(L,I),E!==void 0&&(D.exports=E)},75203:(D,L,m)=>{var I;I=function(){const E={};return E.apply=function(v){$(v).on("mousewheel",function(p){const u=this.scrollTop,g=this.scrollHeight,c=Math.round(this.getBoundingClientRect().height);if(p.originalEvent.deltaY<0&&u===0||p.originalEvent.deltaY>0&&c+u>=g)return!1})},E}.call(L,m,L,D),I!==void 0&&(D.exports=I)},7073:(D,L,m)=>{var I,E;I=[m(32230),m(66603),m(85233),m(7927)],E=function(v,p,u,g){const c={current:{}};c.init=function(a){if(!config.searchEnabled)return;a=a||{in:config.searchDefaultInQuick||"titles"};const s=$("#search-button"),r=$("#search-fields"),o=$("#search-fields input"),n=$("#quick-search-container");$("#search-form .advanced-search-link").off("mousedown").on("mousedown",function(){ajaxify.go("/search")}),$("#search-form").off("submit").on("submit",function(){o.blur()}),o.off("blur").on("blur",function(){setTimeout(function(){o.is(":focus")||(r.addClass("hidden"),s.removeClass("hidden"))},200)}),o.off("focus");const f={inputEl:o,resultEl:n};c.enableQuickSearch({searchOptions:a,searchElements:f}),s.off("click").on("click",function(w){return!config.loggedIn&&!app.user.privileges["search:content"]?(g.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(w.stopPropagation(),c.showAndFocusInput(),!1)}),$("#search-form").off("submit").on("submit",function(){const w=$(this).find("input"),h=c.getSearchPreferences();return h.term=w.val(),h.in=a.in,u.fire("action:search.submit",{searchOptions:h,searchElements:f}),c.query(h,function(){w.val("")}),!1})},c.enableQuickSearch=function(a){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const s=Object.assign({in:config.searchDefaultInQuick||"titles"},a.searchOptions),r=a.searchElements.resultEl,o=a.searchElements.inputEl;let n=o.val();const f=r.find(".filter-category");function w(){ajaxify.data.template.category&&ajaxify.data.cid&&v.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(b){const k=$("<div></div>").html(b).text();f.find(".name").text(k)}),f.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function h(){a.searchOptions=Object.assign({},s),a.searchOptions.term=o.val(),w(),ajaxify.data.template.category&&ajaxify.data.cid&&f.find('input[type="checkbox"]').is(":checked")&&(a.searchOptions.categories=[ajaxify.data.cid],a.searchOptions.searchChildren=!0),r.removeClass("hidden").find(".quick-search-results-container").html(""),r.find(".loading-indicator").removeClass("hidden"),u.fire("action:search.quick.start",a),a.searchOptions.searchOnly=1,c.api(a.searchOptions,function(b){if(r.find(".loading-indicator").addClass("hidden"),!b.posts||a.hideOnNoMatches&&!b.posts.length)return r.addClass("hidden").find(".quick-search-results-container").html("");b.posts.forEach(function(k){const z=$("<div>"+k.content+"</div>").text(),A=o.val().toLowerCase().replace(/^in:topic-\d+/,""),t=Math.max(0,z.toLowerCase().indexOf(A)-40);k.snippet=utils.escapeHTML((t>0?"...":"")+z.slice(t,t+80)+(z.length-t>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",b,function(k){k.length&&k.find(".timeago").timeago(),r.toggleClass("hidden",!k.length||!o.is(":focus")).find(".quick-search-results-container").html(k.length?k:"");const z=r.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");c.highlightMatches(a.searchOptions.term,z),u.fire("action:search.quick.complete",{data:b,options:a})})})}r.find('.filter-category input[type="checkbox"]').on("change",function(){o.focus(),h()}),o.off("keyup").on("keyup",utils.debounce(function(){if(o.val().length<3){r.addClass("hidden"),n=o.val();return}if(o.val()!==n){if(n=o.val(),!o.is(":focus"))return r.addClass("hidden");h()}},500));let C=!1;r.on("mousedown",function(){$(window).one("mouseup",function(){r.addClass("hidden")}),C=!0}),o.on("blur",function(){!o.is(":focus")&&!C&&!r.hasClass("hidden")&&r.addClass("hidden")});let O=!1;u.on("action:ajaxify.end",function(){ajaxify.isCold()||(O=!0)}),o.on("focus",function(){C=!1;const b=o.val();n=b,b&&r.find("#quick-search-results").children().length&&(w(),O?(h(),O=!1):r.removeClass("hidden"),o[0].setSelectionRange(b.startsWith("in:topic")?b.indexOf(" ")+1:0,b.length))}),o.off("refresh").on("refresh",function(){h()})},c.showAndFocusInput=function(){$("#search-fields").removeClass("hidden"),$("#search-button").addClass("hidden"),$("#search-fields input").focus()},c.query=function(a,s){s=s||function(){},ajaxify.go("search?"+x(a)),s()},c.api=function(a,s){const r=config.relative_path+"/api/search?"+x(a);a.searchOnly=void 0;const o=config.relative_path+"/search?"+x(a);$.get(r,function(n){n.url=o,s(n)})};function x(a){const s=a.in||"titles",r=a.by||"";let o=a.term.replace(/^[ ?#]*/,"");try{o=encodeURIComponent(o)}catch{return g.error("[[error:invalid-search-term]]")}const n={term:o,in:s};return a.matchWords&&(n.matchWords=a.matchWords),r&&r.length&&(s==="posts"||s==="titles"||s==="titlesposts")&&(n.by=r),a.categories&&a.categories.length&&(n.categories=a.categories,a.searchChildren&&(n.searchChildren=a.searchChildren)),a.hasTags&&a.hasTags.length&&(n.hasTags=a.hasTags),parseInt(a.replies,10)>0&&(n.replies=a.replies,n.repliesFilter=a.repliesFilter||"atleast"),a.timeRange&&(n.timeRange=a.timeRange,n.timeFilter=a.timeFilter||"newer"),a.sortBy&&(n.sortBy=a.sortBy,n.sortDirection=a.sortDirection),a.showAs&&(n.showAs=a.showAs),a.searchOnly&&(n.searchOnly=a.searchOnly),u.fire("action:search.createQueryString",{query:n,data:a}),decodeURIComponent($.param(n))}return c.getSearchPreferences=function(){try{return JSON.parse(p.getItem("search-preferences")||"{}")}catch{return{}}},c.highlightMatches=function(a,s){if(!a||!s.length)return;a=utils.escapeHTML(a.replace(/^"/,"").replace(/"$/,"").trim());const r=a.split(" ").map(function(n){return utils.escapeRegexChars(n)}).join("|"),o=new RegExp("("+r+")","gi");s.each(function(){const n=$(this),f=[];n.find("*").each(function(){$(this).after("<!-- "+f.length+" -->"),f.push($("<div></div>").append($(this)))}),n.html(n.html().replace(o,function(w,h){return'<strong class="search-match">'+h+"</strong>"})),f.forEach(function(w,h){n.html(n.html().replace("<!-- "+h+" -->",function(){return w.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-responsive")},c}.apply(L,I),E!==void 0&&(D.exports=E)},66603:(D,L,m)=>{var I;I=function(){function E(){this._store={},this._keys=[]}E.prototype.isMock=!0,E.prototype.setItem=function(u,g){u=String(u),this._keys.indexOf(u)===-1&&this._keys.push(u),this._store[u]=g},E.prototype.getItem=function(u){return u=String(u),this._keys.indexOf(u)===-1?null:this._store[u]},E.prototype.removeItem=function(u){u=String(u),this._keys=this._keys.filter(function(g){return g!==u}),this._store[u]=null},E.prototype.clear=function(){this._keys=[],this._store={}},E.prototype.key=function(u){return u=parseInt(u,10)||0,this._keys[u]},Object.defineProperty&&Object.defineProperty(E.prototype,"length",{get:function(){return this._keys.length}});let v;const p=Date.now().toString();try{if(v=window.localStorage,v.setItem(p,p),v.getItem(p)!==p)throw Error("localStorage behaved unexpectedly");return v.removeItem(p),v}catch(u){console.warn(u),console.warn("localStorage failed, falling back on sessionStorage");try{if(v=window.sessionStorage,v.setItem(p,p),v.getItem(p)!==p)throw Error("sessionStorage behaved unexpectedly");return v.removeItem(p),v}catch(g){return console.warn(g),console.warn("sessionStorage failed, falling back on memory storage"),new E}}}.call(L,m,L,D),I!==void 0&&(D.exports=I)}}]);
