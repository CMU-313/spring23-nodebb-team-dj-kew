(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[9986],{69986:(D,O,p)=>{"use strict";var T,A;T=[p(32230),p(7237),p(42840),p(16943),p(85233),p(7927)],A=function(v,l,h,m,d,o){const i={};let c={};const P=({notifications:n})=>new Promise(a=>{v.toggleTimeagoShorthand(function(){for(let r=0;r<n.length;r+=1)n[r].timeago=$.timeago(new Date(parseInt(n[r].datetime,10)));v.toggleTimeagoShorthand(),a({notifications:n})})});d.on("filter:notifications.load",P),i.loadNotifications=function(n,a){a=a||function(){},socket.emit("notifications.get",null,function(r,s){if(r)return o.error(r);const I=s.unread.concat(s.read).sort(function(S,B){return parseInt(S.datetime,10)>parseInt(B.datetime,10)?-1:1});d.fire("filter:notifications.load",{notifications:I}).then(({notifications:S})=>{app.parseAndTranslate("partials/notifications_list",{notifications:S},function(B){n.html(B),n.off("click").on("click","[data-nid]",function(C){const E=$(this);if(F(E)&&(C.stopPropagation(),C.preventDefault(),l.get("notifications/list").dropdown("toggle")),!E.hasClass("unread"))return;const W=E.attr("data-nid");u(W,!0)}),l.get("notifications").on("click",".mark-all-read",i.markAllRead),n.on("click",".mark-read",function(){const C=$(this).parents("li"),E=C.hasClass("unread"),R=C.attr("data-nid");return u(R,E,function(){C.toggleClass("unread")}),!1}),d.fire("action:notifications.loaded",{notifications:I,list:n}),a()})})})},i.onNewNotification=function(n){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),socket.emit("notifications.getCount",function(a,r){if(a)return o.error(a);i.updateNotifCount(r)}),c[n.nid]||(c[n.nid]=!0)};function u(n,a,r){socket.emit("notifications.mark"+(a?"Read":"Unread"),n,function(s){if(s)return o.error(s);a&&c[n]&&delete c[n],r&&r()})}function F(n){const a=n.attr("data-pid"),r=n.attr("data-path"),s=l.get("post","pid",a);return r.startsWith(config.relative_path+"/post/")&&a&&s.length&&ajaxify.data.template.topic?(h.scrollToIndex(s.attr("data-index"),!0),!0):!1}return i.updateNotifCount=function(n){const a=l.get("notifications/icon");n=Math.max(0,n),n>0?a.removeClass("fa-bell-o").addClass("fa-bell"):a.removeClass("fa-bell").addClass("fa-bell-o"),a.toggleClass("unread-count",n>0),a.attr("data-content",n>99?"99+":n);const r={count:n,updateFavicon:!0};d.fire("action:notification.updateCount",r),r.updateFavicon&&m.setBubble(n>99?"99+":n),h.setAppBadge&&h.setAppBadge(n)},i.markAllRead=function(){socket.emit("notifications.markAllRead",function(n){n&&o.error(n),c={}})},i}.apply(O,T),A!==void 0&&(D.exports=A)},16943:(D,O,p)=>{var T,A;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var v={},l=null,h=null,m=null,d=null,o={},i=Math.ceil(window.devicePixelRatio)||1,c=16*i,P={width:7,height:9,font:10*i+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},u=function(){var t=navigator.userAgent.toLowerCase();return function(e){return t.indexOf(e)!==-1}}(),F={ie:u("trident"),chrome:u("chrome"),webkit:u("chrome")||u("safari"),safari:u("safari")&&!u("chrome"),mozilla:u("mozilla")&&!u("chrome")&&!u("safari")},n=function(){for(var t=document.getElementsByTagName("link"),e=0,f=t.length;e<f;e++)if((t[e].getAttribute("rel")||"").match(/\bicon\b/i))return t[e];return!1},a=function(){for(var t=document.getElementsByTagName("link"),e=0,f=t.length;e<f;e++){var w=typeof t[e]<"u";w&&(t[e].getAttribute("rel")||"").match(/\bicon\b/i)&&t[e].parentNode.removeChild(t[e])}},r=function(){if(!h||!l){var t=n();l=t?t.getAttribute("href"):"/favicon.ico",h||(h=l)}return l},s=function(){return d||(d=document.createElement("canvas"),d.width=c,d.height=c),d},I=function(t){if(t){a();var e=document.createElement("link");e.type="image/x-icon",e.rel="icon",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}},S=function(t){window.console&&window.console.log(t)},B=function(t,w){if(!s().getContext||F.ie||F.safari||o.fallback==="force")return C(t);var f=s().getContext("2d"),w=w||"#000000",M=r();m=document.createElement("img"),m.onload=function(){f.clearRect(0,0,c,c),f.drawImage(m,0,0,m.width,m.height,0,0,c,c),(t+"").length>0&&E(f,t,w),R()},!M.match(/^data/)&&o.crossOrigin&&(m.crossOrigin="anonymous"),m.src=M},C=function(t){if(o.fallback){var e=document.title;e[0]==="("&&(e=e.slice(e.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+e:document.title=e}},E=function(t,e,f){typeof e=="number"&&e>99&&o.abbreviate&&(e=W(e));var w=(e+"").length-1,M=o.width*i+6*i*w,z=o.height*i,y=c-z,k=c-M-i,b=16*i,N=16*i,g=2*i;t.font=(F.webkit?"bold ":"")+o.font,t.fillStyle=o.background,t.strokeStyle=o.background,t.lineWidth=i,t.beginPath(),t.moveTo(k+g,y),t.quadraticCurveTo(k,y,k,y+g),t.lineTo(k,b-g),t.quadraticCurveTo(k,b,k+g,b),t.lineTo(N-g,b),t.quadraticCurveTo(N,b,N,b-g),t.lineTo(N,y+g),t.quadraticCurveTo(N,y,N-g,y),t.closePath(),t.fill(),t.beginPath(),t.strokeStyle="rgba(0,0,0,0.3)",t.moveTo(k+g/2,b),t.lineTo(N-g/2,b),t.stroke(),t.fillStyle=o.color,t.textAlign="right",t.textBaseline="top",t.fillText(e,i===2?29:15,F.mozilla?7*i:6*i)},R=function(){s().getContext&&I(s().toDataURL())},W=function(t){for(var e=[["G",1e9],["M",1e6],["k",1e3]],f=0;f<e.length;++f)if(t>=e[f][1]){t=_(t/e[f][1])+e[f][0];break}return t},_=function(t,e){var f=new Number(t);return f.toFixed(e)};v.setOptions=function(t){o={},t.colour&&(t.color=t.colour);for(var e in P)o[e]=t.hasOwnProperty(e)?t[e]:P[e];return this},v.setImage=function(t){return l=t,R(),this},v.setBubble=function(t,e){return t=t||"",B(t,e),this},v.reset=function(){l=h,I(h)},v.setOptions(P),T=v,A=typeof T=="function"?T.call(O,p,O,D):T,A!==void 0&&(D.exports=A)})()}}]);
