"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3094],{53094:(_,b,l)=>{var p,f;p=[l(7237),l(3547),l(32230),l(7927),l(74344)],f=function(P,t,r,c,u){const m={};let o,d,s;m.init=function(n){o||(s=ajaxify.data.tid,app.parseAndTranslate("modals/move-post",{},function(i){o=i,d=o.find("#move_posts_confirm"),$("body").append(o),o.find(".close,#move_posts_cancel").on("click",y),o.find("#topicId").on("keyup",utils.debounce(g,200)),t.init(E),v(),n&&t.togglePostSelection(n,n.attr("data-pid")),$(window).off("action:ajaxify.end",e).on("action:ajaxify.end",e),d.on("click",function(){const h=a();if(!h)return;d.attr("disabled",!0);const A={pids:t.pids.slice(),tid:h};if(config.undoTimeout>0)return c.alert({alert_id:"pids_move_"+t.pids.join("-"),title:"[[topic:thread_tools.move-posts]]",message:"[[topic:topic_move_posts_success]]",type:"success",timeout:1e4,timeoutfn:function(){x(A)},clickfn:function(I,C){delete C.timeoutfn,c.success("[[topic:topic_move_posts_undone]]"),d.removeAttr("disabled")}});x(A)})}))};function e(){if(!o)return;const n=o.find("#topicId");let i=null;ajaxify.data.template.topic&&ajaxify.data.tid&&parseInt(ajaxify.data.tid,10)!==s&&(i=ajaxify.data.tid),i&&!n.val()&&n.val(i),g()}function a(){const n=o.find("#topicId");return n.length&&n.val()?n.val():ajaxify.data.template.topic&&ajaxify.data.tid}function v(){if(!o)return;const n=a();t.pids.length?n&&parseInt(n,10)!==parseInt(s,10)?u.get("/topics/"+n,{}).then(function(i){if(!i||!i.tid)return c.error("[[error:no-topic]]");if(i.scheduled)return c.error("[[error:cant-move-posts-to-scheduled]]");const h=r.compile("topic:x-posts-will-be-moved-to-y",t.pids.length,i.title);o.find("#pids").translateHtml(h)}):o.find("#pids").translateHtml("[[topic:x-posts-selected, "+t.pids.length+"]]"):o.find("#pids").translateHtml("[[topic:no-posts-selected]]")}function g(){if(!o)return;const n=a();t.pids.length&&n&&parseInt(n,10)!==parseInt(s,10)?d.removeAttr("disabled"):d.attr("disabled",!0),v()}function E(){g()}function x(n){n.tid&&Promise.all(n.pids.map(i=>u.put(`/posts/${i}/move`,{tid:n.tid}))).then(()=>{n.pids.forEach(function(i){P.get("post","pid",i).fadeOut(500,function(){$(this).remove()})}),y()}).catch(c.error)}function y(){o&&(o.remove(),o=null,t.disable(),$(window).off("action:ajaxify.end",e))}return m}.apply(b,p),f!==void 0&&(_.exports=f)},3547:(_,b,l)=>{var p,f;p=[l(7237)],f=function(P){const t={};let r;t.pids=[];let c=!1;t.init=function(s,e){t.pids.length=0,r=s,e=e||{},c=e.allowMainPostSelect||!1,$("#content").on("click",'[component="topic"] [component="post"]',u),o()};function u(s){s.stopPropagation();const e=$(this).attr("data-pid"),a=$('[component="topic"] [data-pid="'+e+'"]');!c&&parseInt($(this).attr("data-index"),10)===0||t.togglePostSelection(a,e)}t.disable=function(){t.pids.forEach(function(s){P.get("post","pid",s).toggleClass("bg-success",!1)}),$("#content").off("click",'[component="topic"] [component="post"]',u),d()},t.togglePostSelection=function(s,e){if(e){const a=t.pids.indexOf(e);a===-1?(t.pids.push(e),s.toggleClass("bg-success",!0)):(t.pids.splice(a,1),s.toggleClass("bg-success",!1)),t.pids.length&&t.pids.sort(function(v,g){return v-g}),typeof r=="function"&&r()}};function m(){return!1}function o(){$("#content").on("click",'[component="post"] button, [component="post"] a',m)}function d(){$("#content").off("click",'[component="post"] button, [component="post"] a',m)}return t}.apply(b,p),f!==void 0&&(_.exports=f)}}]);
