"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[9593,7214,9617,6503,3014,8786,2550,5655,831],{94039:(h,y,d)=>{var m,f;m=[d(98192),d(74344),d(31369),d(7927)],f=((a,u,x,p)=>{const c={};c.openChangeModal=()=>{socket.emit("user.getProfilePictures",{uid:ajaxify.data.uid},function(n,t){if(n)return p.error(n);const o=t.reduce(function(i,r){return i||r.type==="uploaded"},!1);app.parseAndTranslate("partials/modals/change_picture_modal",{pictures:t,uploaded:o,icon:{text:ajaxify.data["icon:text"],bgColor:ajaxify.data["icon:bgColor"]},defaultAvatar:ajaxify.data.defaultAvatar,allowProfileImageUploads:ajaxify.data.allowProfileImageUploads,iconBackgrounds:config.iconBackgrounds,user:{uid:ajaxify.data.uid,username:ajaxify.data.username,picture:ajaxify.data.picture,"icon:text":ajaxify.data["icon:text"],"icon:bgColor":ajaxify.data["icon:bgColor"]}},function(i){const r=x.dialog({className:"picture-switcher",title:"[[user:change_picture]]",message:i,show:!0,buttons:{close:{label:"[[global:close]]",callback:k,className:"btn-link"},update:{label:"[[global:save_changes]]",callback:g}}});r.on("shown.bs.modal",l),r.on("click",".list-group-item",function(){r.find(".list-group-item").removeClass("active"),$(this).addClass("active")}),r.on("change",'input[type="radio"][name="icon:bgColor"]',C=>{const b=C.target.value;r.find(".user-icon").css("background-color",b)}),e(r);function l(){ajaxify.data.picture?r.find(".list-group-item img").each(function(){this.getAttribute("src")===ajaxify.data.picture&&$(this).parents(".list-group-item").addClass("active")}):r.find(".list-group-item .user-icon").parents(".list-group-item").addClass("active");const C=document.querySelector(`.modal input[type="radio"][value="${ajaxify.data["icon:bgColor"]}"]`);C?C.checked=!0:document.querySelector('.modal input[type="radio"]').checked=!0}function g(){const C=r.find(".list-group-item.active").attr("data-type"),b=document.querySelector('.modal.picture-switcher input[type="radio"]:checked').value||"transparent";s(C,b).then(()=>{c.updateHeader(C==="default"?"":r.find(".list-group-item.active img").attr("src"),b),ajaxify.refresh()}).catch(p.error)}function k(){r.modal("hide")}})})},c.updateHeader=(n,t)=>{parseInt(ajaxify.data.theirid,10)===parseInt(ajaxify.data.yourid,10)&&(!n&&ajaxify.data.defaultAvatar&&(n=ajaxify.data.defaultAvatar),$('#header [component="avatar/picture"]')[n?"show":"hide"](),$('#header [component="avatar/icon"]')[n?"hide":"show"](),n&&$('#header [component="avatar/picture"]').attr("src",n),t&&document.querySelectorAll('[component="navbar"] [component="avatar/icon"]').forEach(o=>{o.style["background-color"]=t}))};function e(n){function t(i){i=(i.startsWith("http")?"":config.relative_path)+i+"?"+Date.now(),c.updateHeader(i),ajaxify.data.picture&&ajaxify.data.picture.length?($("#user-current-picture, img.avatar").attr("src",i),ajaxify.data.uploadedpicture=i):ajaxify.refresh(function(){$("#user-current-picture, img.avatar").attr("src",i)})}function o(){ajaxify.data.uploadedpicture===ajaxify.data.picture&&(ajaxify.refresh(),c.updateHeader())}n.find('[data-action="upload"]').on("click",function(){return n.modal("hide"),a.show({socketMethod:"user.uploadCroppedPicture",route:config.relative_path+"/api/user/"+ajaxify.data.userslug+"/uploadpicture",aspectRatio:1/1,paramName:"uid",paramValue:ajaxify.data.theirid,fileSize:ajaxify.data.maximumProfileImageSize,allowSkippingCrop:!1,title:"[[user:upload_picture]]",description:"[[user:upload_a_picture]]",accept:ajaxify.data.allowedProfileImageExtensions},function(i){t(i)}),!1}),n.find('[data-action="upload-url"]').on("click",function(){return n.modal("hide"),app.parseAndTranslate("partials/modals/upload_picture_from_url_modal",{},function(i){i.modal("show"),i.find(".upload-btn").on("click",function(){const r=i.find("#uploadFromUrl").val();return r&&(i.modal("hide"),a.handleImageCrop({url:r,socketMethod:"user.uploadCroppedPicture",aspectRatio:1,allowSkippingCrop:!1,paramName:"uid",paramValue:ajaxify.data.theirid},t)),!1})}),!1}),n.find('[data-action="remove-uploaded"]').on("click",function(){socket.emit("user.removeUploadedPicture",{uid:ajaxify.data.theirid},function(i){if(n.modal("hide"),i)return p.error(i);o()})})}function s(n,t){return u.put(`/users/${ajaxify.data.theirid}/picture`,{type:n,bgColor:t})}return c}).apply(y,m),f!==void 0&&(h.exports=f)},7927:(h,y,d)=>{var m,f;m=[d(32230),d(7237),d(85233)],f=function(a,u,x){const p={};p.alert=function(t){t.alert_id="alert_button_"+(t.alert_id?t.alert_id:new Date().getTime()),t.title=t.title&&t.title.trim()||"",t.message=t.message?t.message.trim():"",t.type=t.type||"info";const o=$("#"+t.alert_id);o.length?e(o,t):c(t)},p.success=function(t,o){p.alert({alert_id:utils.generateUUID(),title:"[[global:alert.success]]",message:t,type:"success",timeout:o||5e3})},p.error=function(t,o){if(t=t&&t.message||t,t==="[[error:revalidate-failure]]"){socket.disconnect(),app.reconnect();return}p.alert({alert_id:utils.generateUUID(),title:"[[global:alert.error]]",message:t,type:"danger",timeout:o||1e4})},p.remove=function(t){$("#alert_button_"+t).remove()};function c(t){app.parseAndTranslate("alert",t,function(o){let i=$("#"+t.alert_id);if(i.length)return e(i,t);i=o,i.fadeIn(200),u.get("toaster/tray").prepend(i),typeof t.closefn=="function"&&i.find("button").on("click",function(){return t.closefn(),s(i),!1}),t.timeout&&n(i,t),typeof t.clickfn=="function"&&i.addClass("pointer").on("click",function(r){$(r.target).is(".close")||t.clickfn(i,t),s(i)}),x.fire("action:alert.new",{alert:i,params:t})})}function e(t,o){t.find("strong").translateHtml(o.title),t.find("p").translateHtml(o.message),t.attr("class","alert alert-dismissable alert-"+o.type+" clearfix"),clearTimeout(parseInt(t.attr("timeoutId"),10)),o.timeout&&n(t,o),x.fire("action:alert.update",{alert:t,params:o}),t.off("click").removeClass("pointer"),typeof o.clickfn=="function"&&t.addClass("pointer").on("click",function(i){$(i.target).is(".close")||o.clickfn(),s(t)})}function s(t){t.fadeOut(500,function(){$(this).remove()})}function n(t,o){const i=o.timeout,r=setTimeout(function(){s(t),typeof o.timeoutfn=="function"&&o.timeoutfn(t,o)},i);t.attr("timeoutId",r),t.css("transition-property","none"),t.removeClass("animate"),setTimeout(function(){t.css("transition-property",""),t.css("transition","width "+(i+450)+"ms linear, background-color "+(i+450)+"ms ease-in"),t.addClass("animate"),x.fire("action:alert.animate",{alert:t,params:o})},50),t.on("mouseenter",function(){$(this).css("transition-duration",0)})}return p}.apply(y,m),f!==void 0&&(h.exports=f)},74344:(h,y,d)=>{var m,f;m=[d(85233)],f=(a=>{const u={},x=config.relative_path+"/api/v3";function p(c,e){c.url=c.url.startsWith("/api")?config.relative_path+c.url:x+c.url;async function s(n){({options:c}=await a.fire("filter:api.options",{options:c})),$.ajax(c).done(t=>{n(null,t&&t.hasOwnProperty("status")&&t.hasOwnProperty("response")?t.response:t||{})}).fail(t=>{let o;t.responseJSON&&(o=t.responseJSON.status&&t.responseJSON.status.message?t.responseJSON.status.message:t.responseJSON.error),n(new Error(o||t.statusText))})}if(typeof e=="function"){s(e);return}return new Promise((n,t)=>{s(function(o,i){o?t(o):n(i)})})}return u.get=(c,e,s)=>p({url:c+(e&&Object.keys(e).length?"?"+$.param(e):"")},s),u.head=(c,e,s)=>p({url:c+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"head"},s),u.post=(c,e,s)=>p({url:c,method:"post",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},s),u.patch=(c,e,s)=>p({url:c,method:"patch",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},s),u.put=(c,e,s)=>p({url:c,method:"put",data:JSON.stringify(e||{}),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},s),u.del=(c,e,s)=>p({url:c,method:"delete",data:JSON.stringify(e),contentType:"application/json; charset=utf-8",headers:{"x-csrf-token":config.csrf_token}},s),u.delete=u.del,u}).apply(y,m),f!==void 0&&(h.exports=f)},7237:(h,y,d)=>{var m;m=function(){const f={};return f.core={"topic/teaser":function(a){return a?$('[component="category/topic"][data-tid="'+a+'"] [component="topic/teaser"]'):$('[component="topic/teaser"]')},topic:function(a,u){return $('[component="topic"][data-'+a+'="'+u+'"]')},post:function(a,u){return $('[component="post"][data-'+a+'="'+u+'"]')},"post/content":function(a){return $('[component="post"][data-pid="'+a+'"] [component="post/content"]')},"post/header":function(a){return $('[component="post"][data-pid="'+a+'"] [component="post/header"]')},"post/anchor":function(a){return $('[component="post"][data-index="'+a+'"] [component="post/anchor"]')},"post/vote-count":function(a){return $('[component="post"][data-pid="'+a+'"] [component="post/vote-count"]')},"post/bookmark-count":function(a){return $('[component="post"][data-pid="'+a+'"] [component="post/bookmark-count"]')},"user/postcount":function(a){return $('[component="user/postcount"][data-uid="'+a+'"]')},"user/reputation":function(a){return $('[component="user/reputation"][data-uid="'+a+'"]')},"category/topic":function(a,u){return $('[component="category/topic"][data-'+a+'="'+u+'"]')},"categories/category":function(a,u){return $('[component="categories/category"][data-'+a+'="'+u+'"]')},"chat/message":function(a){return $('[component="chat/message"][data-mid="'+a+'"]')},"chat/message/body":function(a){return $('[component="chat/message"][data-mid="'+a+'"] [component="chat/message/body"]')},"chat/recent/room":function(a){return $('[component="chat/recent/room"][data-roomid="'+a+'"]')}},f.get=function(){const a=Array.prototype.slice.call(arguments,1);return f.core[arguments[0]]&&a.length?f.core[arguments[0]].apply(this,a):$('[component="'+arguments[0]+'"]')},f}.call(y,d,y,h),m!==void 0&&(h.exports=m)},98192:(h,y,d)=>{var m,f;m=[d(7927)],f=function(a){const u={};u.show=function(e,s){const n=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("partials/modals/upload_file_modal",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:n,title:e.title||"[[global:upload_file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const o=t.find("#uploadForm");e.route&&o.attr("action",e.route),t.find("#fileUploadSubmitBtn").on("click",function(){return $(this).addClass("disabled"),e.uploadModal=t,c(e,s),!1})})},u.handleImageCrop=function(e,s){$("#crop-picture-modal").remove(),app.parseAndTranslate("modals/crop_picture",{url:utils.escapeHTML(e.url)},async function(n){n.modal({backdrop:"static"}).modal("show");const t=parseInt($(window).height()/2,10),o=document.getElementById("cropped-image");$(o).css("max-height",t);const i=(await d.e(1649).then(d.t.bind(d,33129,23))).default;let r=new i(o,{aspectRatio:e.aspectRatio,autoCropArea:1,viewMode:1,checkCrossOrigin:!0,cropmove:function(){e.restrictImageDimension&&(r.cropBoxData.width>e.imageDimension&&r.setCropBoxData({width:e.imageDimension}),r.cropBoxData.height>e.imageDimension&&r.setCropBoxData({height:e.imageDimension}))},ready:function(){if(!p(r,e))return n.modal("hide");if(e.restrictImageDimension){const l=o.width<o.height?o.width:o.height,g=l>e.imageDimension?e.imageDimension:l;r.setCropBoxData({width:g,height:g})}n.find(".rotate").on("click",function(){const l=this.getAttribute("data-degrees");r.rotate(l)}),n.find(".flip").on("click",function(){const l=this.getAttribute("data-option");this.getAttribute("data-method")==="scaleX"?r.scaleX(l):r.scaleY(l),this.setAttribute("data-option",l*-1)}),n.find(".reset").on("click",function(){r.reset()}),n.find(".crop-btn").on("click",function(){$(this).addClass("disabled");const l=p(r,e);l&&(n.find("#upload-progress-bar").css("width","0%"),n.find("#upload-progress-box").show().removeClass("hide"),x({data:e,imageData:l,progressBarEl:n.find("#upload-progress-bar")},function(g,k){if(g)return n.find("#upload-progress-box").hide(),n.find(".upload-btn").removeClass("disabled"),n.find(".crop-btn").removeClass("disabled"),a.error(g);s(k.url),n.modal("hide")}))}),n.find(".upload-btn").on("click",async function(){$(this).addClass("disabled"),r.destroy();const l=(await d.e(1649).then(d.t.bind(d,33129,23))).default;r=new l(o,{viewMode:1,autoCropArea:1,ready:function(){n.find(".crop-btn").trigger("click")}})})}})})};function x(e,s){const n={};n[e.data.paramName]=e.data.paramValue,n.method=e.data.socketMethod,n.size=e.imageData.length,n.progress=0;const t=1e5;function o(){const i=e.imageData.slice(n.progress,n.progress+t);socket.emit("uploads.upload",{chunk:i,params:n},function(r,l){if(r)return a.error(r);if(n.progress+t<n.size)return n.progress+=i.length,e.progressBarEl.css("width",(n.progress/n.size*100).toFixed(2)+"%"),setTimeout(o,100);e.progressBarEl.css("width","100%"),s(null,l)})}o()}function p(e,s){let n;try{n=s.imageType?e.getCroppedCanvas().toDataURL(s.imageType):e.getCroppedCanvas().toDataURL()}catch(t){["The operation is insecure.","Failed to execute 'toDataURL' on 'HTMLCanvasElement': Tainted canvases may not be exported."].indexOf(t.message)!==-1?a.error("[[error:cors-error]]"):a.error(t.message);return}return n}function c(e,s){function n(l,g){l==="error"&&e.uploadModal.find("#fileUploadSubmitBtn").removeClass("disabled"),e.uploadModal.find("#alert-"+l).translateText(g).removeClass("hide")}const t=e.uploadModal.find("#fileInput");if(!t.val())return n("error","[[uploads:select-file-to-upload]]");const o=t[0].files[0],i=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;if(i&&o.size>i*1024)return n("error","[[error:file-too-big, "+i+"]]");if(o.name.endsWith(".gif")){d.e(3564).then(function(){var l=[d(50431)];(function(g){g.ajaxSubmit(e.uploadModal,s)}).apply(null,l)}).catch(d.oe);return}const r=new FileReader;r.addEventListener("load",function(){const l=r.result;e.uploadModal.modal("hide"),u.handleImageCrop({url:l,imageType:o.type,socketMethod:e.socketMethod,aspectRatio:e.aspectRatio,allowSkippingCrop:e.allowSkippingCrop,restrictImageDimension:e.restrictImageDimension,imageDimension:e.imageDimension,paramName:e.paramName,paramValue:e.paramValue},s)},!1),o&&r.readAsDataURL(o)}return u}.apply(y,m),f!==void 0&&(h.exports=f)}}]);
