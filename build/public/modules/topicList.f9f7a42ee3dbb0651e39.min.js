"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8704,613],{29412:(D,I,g)=>{var x,m;x=[g(69941),g(60392),g(7237),g(74344),g(31369),g(7927)],m=function(C,T,a,p,w,u){const n={};n.init=function(){C.init(o),v(),a.get("topic/delete").on("click",function(){return l("del","/state","delete",f),!1}),a.get("topic/restore").on("click",function(){return l("put","/state","restore",f),!1}),a.get("topic/purge").on("click",function(){return l("del","","purge",f),!1}),a.get("topic/lock").on("click",function(){return l("put","/lock","lock",t),!1}),a.get("topic/unlock").on("click",function(){return l("del","/lock","unlock",t),!1}),a.get("topic/pin").on("click",function(){return l("put","/pin","pin",t),!1}),a.get("topic/unpin").on("click",function(){return l("del","/pin","unpin",t),!1}),a.get("topic/mark-unread-for-all").on("click",function(){const e=C.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(i){if(i)return u.error(i);u.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(d){$('[component="category/topic"][data-tid="'+d+'"]').addClass("unread")}),t()}),!1):u.error("[[error:no-topics-selected]]")}),a.get("topic/move").on("click",function(){return g.e(7378).then(function(){var e=[g(57378)];(function(i){const d=C.getSelectedTids();if(!d.length)return u.error("[[error:no-topics-selected]]");i.init(d,null,t)}).apply(null,e)}).catch(g.oe),!1}),a.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return u.error("[[error:invalid-data]]");g.e(7378).then(function(){var i=[g(57378)];(function(d){d.init(null,e,function(A){if(A)return u.error(A);ajaxify.refresh()})}).apply(null,i)}).catch(g.oe)}),a.get("topic/merge").on("click",function(){const e=C.getSelectedTids();g.e(28).then(function(){var i=[g(90028)];(function(d){d.init(function(){e.length&&e.forEach(function(A){d.addTopic(A)})})}).apply(null,i)}).catch(g.oe)}),n.removeListeners(),socket.on("event:topic_deleted",j),socket.on("event:topic_restored",j),socket.on("event:topic_purged",h),socket.on("event:topic_locked",c),socket.on("event:topic_unlocked",c),socket.on("event:topic_pinned",S),socket.on("event:topic_unpinned",S),socket.on("event:topic_moved",s)};function l(e,i,d,A){A||(A=function(){});const k=C.getSelectedTids(),E={},L=function(N){N&&Promise.all(k.map(U=>p[e](`/topics/${U}${i}`,E))).then(A).catch(u.error)};if(!k.length)return u.error("[[error:no-topics-selected]]");switch(d){case"delete":case"restore":case"purge":w.confirm(`[[topic:thread_tools.${d}_confirm]]`,L);break;case"pin":T.requestPinExpiry(E,L.bind(null,!0));break;default:L(!0);break}}n.removeListeners=function(){socket.removeListener("event:topic_deleted",j),socket.removeListener("event:topic_restored",j),socket.removeListener("event:topic_purged",h),socket.removeListener("event:topic_locked",c),socket.removeListener("event:topic_unlocked",c),socket.removeListener("event:topic_pinned",S),socket.removeListener("event:topic_unpinned",S),socket.removeListener("event:topic_moved",s)};function r(){$(".thread-tools.open").find(".dropdown-toggle").trigger("click")}function t(){r(),C.unselectAll()}function f(){r(),o()}function o(){const e=C.getSelectedTids(),i=y(F,e),d=R(F,e),A=y(W,e),k=y(M,e),E=y(B,e),L=R(B,e);a.get("topic/delete").toggleClass("hidden",i),a.get("topic/restore").toggleClass("hidden",E||!i),a.get("topic/purge").toggleClass("hidden",!d),a.get("topic/lock").toggleClass("hidden",k),a.get("topic/unlock").toggleClass("hidden",!k),a.get("topic/pin").toggleClass("hidden",L||A),a.get("topic/unpin").toggleClass("hidden",L||!A),a.get("topic/merge").toggleClass("hidden",E)}function y(e,i){for(let d=0;d<i.length;d+=1)if(e(i[d]))return!0;return!1}function R(e,i){for(let d=0;d<i.length;d+=1)if(!e(i[d]))return!1;return!0}function F(e){return P(e).hasClass("deleted")}function M(e){return P(e).hasClass("locked")}function W(e){return P(e).hasClass("pinned")}function B(e){return P(e).hasClass("scheduled")}function P(e){return a.get("category/topic","tid",e)}function j(e){const i=P(e.tid);i.toggleClass("deleted",e.isDeleted),i.find('[component="topic/locked"]').toggleClass("hide",!e.isDeleted)}function S(e){const i=P(e.tid);i.toggleClass("pinned",e.isPinned),i.find('[component="topic/pinned"]').toggleClass("hide",!e.isPinned),ajaxify.refresh()}function c(e){const i=P(e.tid);i.toggleClass("locked",e.isLocked),i.find('[component="topic/locked"]').toggleClass("hide",!e.isLocked)}function s(e){P(e.tid).remove()}function h(e){P(e.tid).remove()}function v(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(i=>i.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const i=$('[component="category"]').filter(function(A,k){return!$(k).parents("[widget-area],[data-widget-area]").length});let d=0;i.sortable({handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){d=parseInt(i.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(A,k){socket.emit("topics.orderPinnedTopics",{tid:k.item.attr("data-tid"),order:d+k.item.index()},function(E){if(E)return u.error(E);i.find('[component="category/topic"].pinned').each((L,N)=>{$(N).attr("data-index",d+L)})})}})})}return n}.apply(I,x),m!==void 0&&(D.exports=m)},39941:(D,I,g)=>{var x,m;x=[g(22905),g(74344),g(85233)],m=function(C,T,a){const p={};p.init=function(u,n){if(!u||!u.length)return;n=n||{},n.states=n.states||["watching","notwatching","ignoring"],n.template="partials/category-filter",a.fire("action:category.filter.options",{el:u,options:n}),C.init(u,n);let l=[],r=[];Array.isArray(n.selectedCids)?l=n.selectedCids.map(t=>parseInt(t,10)):Array.isArray(ajaxify.data.selectedCids)&&(l=ajaxify.data.selectedCids.map(t=>parseInt(t,10))),r=l.slice(),u.on("hidden.bs.dropdown",function(){let t=r.length!==l.length;if(r.forEach(function(f,o){f!==l[o]&&(t=!0)}),t&&w(u,l),n.onHidden){n.onHidden({changed:t,selectedCids:l.slice()});return}if(t){let f=window.location.pathname;const o=utils.params();l.length&&(o.cid=l,f+="?"+decodeURIComponent($.param(o))),ajaxify.go(f)}}),u.on("click",'[component="category/list"] [data-cid]',function(){const t=u.find('[component="category/list"]'),f=$(this),o=f.find("a").attr("href");if(o&&o!=="#"&&o.length)return;const y=parseInt(f.attr("data-cid"),10),R=f.find('[component="category/select/icon"]');return l.includes(y)?l.splice(l.indexOf(y),1):l.push(y),l.sort(function(F,M){return F-M}),n.selectedCids=l,R.toggleClass("invisible"),t.find('li[data-all="all"] i').toggleClass("invisible",!!l.length),n.onSelect&&n.onSelect({cid:y,selectedCids:l.slice()}),!1})};function w(u,n){n.length>1?l({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):n.length===1?T.get(`/categories/${n[0]}`,{}).then(l):l();function l(r){app.parseAndTranslate("partials/category-filter-content",{selectedCategory:r},function(t){u.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return p}.apply(I,x),m!==void 0&&(D.exports=m)},22905:(D,I,g)=>{var x,m;x=[g(7927)],m=function(C){const T={};return T.init=function(a,p){let w=null;p=p||{},p.privilege=p.privilege||"topics:read",p.states=p.states||["watching","notwatching","ignoring"];let u=[];Array.isArray(p.localCategories)&&(u=p.localCategories.map(f=>({...f}))),p.selectedCids=p.selectedCids||ajaxify.data.selectedCids||[];const n=a.find('[component="category-selector-search"]');if(!n.length)return;const l=n.parent('[component="category/dropdown"]').length>0||n.parent('[component="category-selector"]').length>0;a.on("show.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").addClass("hidden"),n.removeClass("hidden"));function f(){const o=n.find("input").val();o.length>1||!o&&!w?r(o,function(y){w=w||y,t(y)}):!o&&w&&(w.forEach(function(y){y.selected=p.selectedCids.includes(y.cid)}),t(w))}n.on("click",function(o){o.preventDefault(),o.stopPropagation()}),n.find("input").val("").on("keyup",utils.debounce(f,300)),f()}),a.on("shown.bs.dropdown",function(){n.find("input").focus()}),a.on("hide.bs.dropdown",function(){l&&(a.find(".dropdown-toggle").removeClass("hidden"),n.addClass("hidden")),n.off("click"),n.find("input").off("keyup")});function r(f,o){socket.emit("categories.categorySearch",{search:f,query:utils.params(),parentCid:p.parentCid||0,selectedCids:p.selectedCids,privilege:p.privilege,states:p.states,showLinks:p.showLinks},function(y,R){if(y)return C.error(y);o(u.concat(R))})}function t(f){app.parseAndTranslate(p.template,{categoryItems:f.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(o){a.find('[component="category/list"]').replaceWith(o.find('[component="category/list"]')),a.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!f.length)})}},T}.apply(I,x),m!==void 0&&(D.exports=m)},14745:(D,I,g)=>{var x,m;x=[g(25142),g(66044),g(69941),g(39941),g(29412),g(85233)],m=function(C,T,a,p,w,u){const n={};let l="",r=0,t=0,f,o;const y=[];$(window).on("action:ajaxify.start",function(){n.removeListeners(),w.removeListeners()}),n.init=function(c,s){o=R(),l=c,f=s||P,w.init(),n.watchForNewPosts();const h=["watching"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?h.push("notwatching","ignoring"):c!=="unread"&&h.push("notwatching"),p.init($('[component="category/dropdown"]'),{states:h}),config.usePagination||C.init(n.loadMoreTopics),T.init(function(v,e){f(v,1,function(i,d){S(l,i.topics,ajaxify.data.showSelect,1,function(){e(),d()})})}),$("body").height()<=$(window).height()&&o.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){n.loadMoreTopics(1)}),u.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function R(){return $('[component="category"]').filter(function(c,s){return!$(s).parents("[widget-area],[data-widget-area]").length})}n.watchForNewPosts=function(){$("#new-topics-alert").on("click",function(){$(this).addClass("hide")}),t=0,r=0,n.removeListeners(),socket.on("event:new_topic",F),socket.on("event:new_post",M)},n.removeListeners=function(){socket.removeListener("event:new_topic",F),socket.removeListener("event:new_post",M)};function F(c){const s=ajaxify.data,h=s.selectedCids&&s.selectedCids.length&&s.selectedCids.indexOf(parseInt(c.cid,10))===-1,v=s.selectedFilter&&s.selectedFilter.filter==="watched",e=s.template.category&&parseInt(s.cid,10)!==parseInt(c.cid,10),i=!!(h||v||e||y.includes(c.tid));u.fire("filter:topicList.onNewTopic",{topic:c,preventAlert:i}).then(d=>{d.preventAlert||(c.scheduled&&c.tid&&y.push(c.tid),r+=1,W())})}function M(c){const s=c.posts[0];if(!s||!s.topic||s.topic.isFollowing)return;const h=ajaxify.data,v=parseInt(s.topic.mainPid,10)===parseInt(s.pid,10),e=h.selectedCids&&h.selectedCids.length&&h.selectedCids.indexOf(parseInt(s.topic.cid,10))===-1,i=h.selectedFilter&&h.selectedFilter.filter==="new",d=h.selectedFilter&&h.selectedFilter.filter==="watched"&&!s.topic.isFollowing,A=h.template.category&&parseInt(h.cid,10)!==parseInt(s.topic.cid,10),k=!!(v||e||i||d||A);u.fire("filter:topicList.onNewPost",{post:s,preventAlert:k}).then(E=>{E.preventAlert||(t+=1,W())})}function W(){let c="";r===0?t===1?c="[[recent:there-is-a-new-post]]":t>1&&(c="[[recent:there-are-new-posts, "+t+"]]"):r===1?t===0?c="[[recent:there-is-a-new-topic]]":t===1?c="[[recent:there-is-a-new-topic-and-a-new-post]]":t>1&&(c="[[recent:there-is-a-new-topic-and-new-posts, "+t+"]]"):r>1&&(t===0?c="[[recent:there-are-new-topics, "+r+"]]":t===1?c="[[recent:there-are-new-topics-and-a-new-post, "+r+"]]":t>1&&(c="[[recent:there-are-new-topics-and-new-posts, "+r+", "+t+"]]")),c+=" [[recent:click-here-to-reload]]",$("#new-topics-alert").translateText(c).removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide")}n.loadMoreTopics=function(c){if(!o.length||!o.children().length)return;const s=o.find('[component="category/topic"]'),h=c>0?s.last():s.first(),v=(parseInt(h.attr("data-index"),10)||0)+(c>0?1:0);!utils.isNumber(v)||v===0&&o.find('[component="category/topic"][data-index="0"]').length||f(v,c,function(e,i){S(l,e.topics,ajaxify.data.showSelect,c,i)})};function B(c,s){return Math.floor(c/config.topicsPerPage)+(s>0?1:0)}function P(c,s,h){h=h||function(){};const v=utils.params();v.page=B(c,s),C.loadMoreXhr(v,h)}function j(c){return c.filter(function(s){return!o.find('[component="category/topic"][data-tid="'+s.tid+'"]').length})}function S(c,s,h,v,e){if(!s||!s.length||(s=j(s),!s.length))return $("#load-more-btn").hide(),e();let i,d;const A=o.find('[component="category/topic"]');v>0&&s.length?i=A.last():v<0&&s.length&&(d=A.first());const k={topics:s,showSelect:h,template:{name:c}};k.template[c]=!0,u.fire("action:topics.loading",{topics:s,after:i,before:d}),app.parseAndTranslate(c,"topics",k,function(E){if(o.removeClass("hidden"),$("#category-no-topics").remove(),i&&i.length)E.insertAfter(i);else if(d&&d.length){const L=$(document).height(),N=$(window).scrollTop();E.insertBefore(d),$(window).scrollTop(N+($(document).height()-L))}else o.append(E);a.getSelectedTids().length||C.removeExtra(o.find('[component="category/topic"]'),v,Math.max(60,config.topicsPerPage*3)),E.find(".timeago").timeago(),app.createUserTooltips(E),utils.makeNumbersHumanReadable(E.find(".human-readable-number")),u.fire("action:topics.loaded",{topics:s,template:c}),e()})}return n}.apply(I,x),m!==void 0&&(D.exports=m)},69941:(D,I,g)=>{var x,m;x=[g(7237)],m=function(C){const T={};let a,p;T.init=function(r){p=$('[component="category"]'),p.on("selectstart",'[component="topic/select"]',function(t){t.preventDefault()}),p.on("click",'[component="topic/select"]',function(t){const f=$(this);if(t.shiftKey)return u($(this).parents('[component="category/topic"]').attr("data-tid")),a=f,!1;const o=f.parents("[data-tid]").hasClass("selected");w(f,!o),a=f,typeof r=="function"&&r()})};function w(r,t){r.toggleClass("fa-check-square-o",t),r.toggleClass("fa-square-o",!t),r.parents('[component="category/topic"]').toggleClass("selected",t)}T.getSelectedTids=function(){const r=[];return p&&p.find('[component="category/topic"].selected').each(function(){r.push($(this).attr("data-tid"))}),r},T.unselectAll=function(){p&&(p.find('[component="category/topic"].selected').removeClass("selected"),p.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0))};function u(r){a||(a=$('[component="category/topic"]').first().find('[component="topic/select"]'));const t=C.get("category/topic","tid",r).hasClass("selected"),f=l(r),o=l(a.parents('[component="category/topic"]').attr("data-tid"));n(f,o,!t)}function n(r,t,f){if(r>t){const o=r;r=t,t=o}for(let o=r;o<=t;o+=1){const y=$('[component="category/topic"]').eq(o);w(y.find('[component="topic/select"]'),f)}}function l(r){return C.get("category/topic","tid",r).index('[component="category/topic"]')}return T}.apply(I,x),m!==void 0&&(D.exports=m)}}]);
