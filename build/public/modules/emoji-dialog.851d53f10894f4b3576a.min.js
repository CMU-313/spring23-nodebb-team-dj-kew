(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4625,7986,2735,1322,2160,5400],{99398:(D,R,m)=>{"use strict";var w,b;w=[m(83713)],b=function(y){var e={};return e.insertIntoTextarea=function(t,l){var a={context:this,textarea:t,value:l,preventDefault:!1};if($(window).trigger("action:composer.insertIntoTextarea",a),!a.preventDefault){var c=$(a.textarea),f=c.val(),n=c.parents('[component="composer"]');c.val(f.slice(0,a.textarea.selectionStart)+a.value+f.slice(a.textarea.selectionStart)),y.render(n)}},e.wrapSelectionInTextareaWith=function(t,l,a){var c={context:this,textarea:t,leading:l,trailing:a,preventDefault:!1};if($(window).trigger("action:composer.wrapSelectionInTextareaWith",c),!c.preventDefault){a===void 0&&(a=l);var f=$(t),n=f.val(),i=/^(\s*)([\s\S]*?)(\s*)$/.exec(n.slice(t.selectionStart,t.selectionEnd));return i[2]||(i=[null,"",n.slice(t.selectionStart,t.selectionEnd),""]),f.val(n.slice(0,t.selectionStart)+i[1]+l+i[2]+a+i[3]+n.slice(t.selectionEnd)),[i[1].length,i[3].length]}},e.updateTextareaSelection=function(t,l,a){var c={context:this,textarea:t,start:l,end:a,preventDefault:!1};$(window).trigger("action:composer.updateTextareaSelection",c),!c.preventDefault&&(t.setSelectionRange(c.start,c.end),$(c.textarea).focus())},e.getBlockData=function(t,l,a){var c=t.value;l=l.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");var f=new RegExp(l,"g"),n,i=[],g;for(c=c.split(`
`).reduce(function(d,C){return d!==null||(d=a<=C.length?C:null,d===null&&(a-=C.length+1)),d},null);(n=f.exec(c))!==null;)i.push(n.index);return g={in:!!(i.reduce(function(d,C){return a>=C+2&&(d+=1),d},0)%2),atEnd:i.reduce(function(d,C){return d||a===C},!1)},g.atEnd=g.in?g.atEnd:!1,g},e}.apply(R,w),b!==void 0&&(D.exports=b)},83713:(D,R,m)=>{"use strict";var w,b;w=[m(85233)],b=function(y){var e={};return e.render=function(t,l){if(l=l||function(){},!t.find(".preview-container").is(":visible"))return l();var a=t.find("textarea");socket.emit("plugins.composer.renderPreview",a.val(),function(c,f){c||(f=$("<div>"+f+"</div>"),f.find("img:not(.not-responsive)").addClass("img-responsive"),t.find(".preview").html(f),y.fire("action:composer.preview"),l())})},e.matchScroll=function(t){if(t.find(".preview-container").is(":visible")){var l=t.find("textarea"),a=t.find(".preview");if(l.length&&a.length){var c=l[0].scrollHeight-l.height();if(c===0)return;var f=l.scrollTop()/c;a.scrollTop(Math.max(a[0].scrollHeight-a.height(),0)*f)}}},e.handleToggler=function(t){e.env=utils.findBootstrapEnvironment();var l=t.find(".write-container .toggle-preview"),a=t.find(".preview-container .toggle-preview"),c=$(".preview-container"),f=$(".write-container");function n(){g(!1),e.env!=="xs"&&e.env!=="sm"&&localStorage.setItem("composer:previewToggled",!0)}function i(){g(!0),e.env!=="xs"&&e.env!=="sm"&&localStorage.removeItem("composer:previewToggled")}function g(d){e.env==="xs"||e.env==="sm"?(c.toggleClass("hide",!1),f.toggleClass("maximized",!1),l.toggleClass("hide",!0),c.toggleClass("hidden-xs hidden-sm",!d),f.toggleClass("hidden-xs hidden-sm",d),d&&e.render(t)):(c.toggleClass("hide",!d),f.toggleClass("maximized",!d),l.toggleClass("hide",d)),e.matchScroll(t)}e.toggle=g,a.on("click",function(){n(),t.find(".write").focus()}),l.on("click",function(){i(),t.find(".write").focus()}),localStorage.getItem("composer:previewToggled")||e.env==="xs"||e.env==="sm"?n():i()},e}.apply(R,w),b!==void 0&&(D.exports=b)},6721:(D,R,m)=>{var w,b;w=[m,R,m(32230),m(59006),m(99398),m(75203),m(40646)],b=function(y,e,t,l,a,c,f){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.toggleForInsert=e.toggle=e.init=e.dialogActions=void 0;var n=$("html");e.dialogActions={open:function(p){return n.addClass("emoji-insert"),p.addClass("open"),p.appendTo(document.fullscreenElement||"body"),p.find(".emoji-dialog-search").focus(),setTimeout(function(){$(document).off("click",i).on("click",i)},0),p},close:function(p){return $(document).off("click",i),n.removeClass("emoji-insert"),p.removeClass("open")}};function i(p){var o=$("#emoji-dialog");!$(p.target).is(".emoji-dialog *")&&o.length&&e.dialogActions.close(o)}var g={people:10,nature:9,food:8,activity:7,travel:6,objects:5,symbols:4,flags:3,regional:2,modifier:1,other:0};config.emojiCustomFirst&&(g.custom=100);var d=t.Translator.create();function C(p,o){return p<o?-1:p>o?1:0}function S(p){Promise.all([$.getJSON(f.base+"/emoji/categories.json?"+f.buster),$.getJSON(f.base+"/emoji/packs.json?"+f.buster),new Promise(function(o){return f.init(o)})]).then(function(o){var r=o[0],u=o[1],s=Object.keys(r).map(function(v){var E=r[v].map(function(h){return f.table[h]});return{name:v,emojis:E.map(function(h){return{name:h.name,html:f.buildEmoji(h,!0)}}).sort(function(h,A){return C(h.name,A.name)})}}).sort(function(v,E){var h=g[v.name]||0,A=g[E.name]||0;return A-h});return l.render("partials/emoji-dialog",{categories:s,packs:u})}).then(function(o){return d.translate(o)}).then(function(o){var r=$(o).appendTo(document.fullscreenElement||"body");r.find(".emoji-dialog-search").on("input",function(h){var A=h.target.value;if(!A){r.find(".emoji-dialog-search-results").addClass("hidden"),r.find(".nav-tabs .emoji-dialog-search-results").next().find("a").tab("show");return}var T=f.search(A).slice(0,100).map(function(P){return'<a class="emoji-link" name="'+P.name+'" href="#">'+f.buildEmoji(P,!1)+"</a>"}).join(`
`);r.find(".tab-pane.emoji-dialog-search-results").html(T),r.find(".emoji-dialog-search-results").removeClass("hidden"),r.find(".nav-tabs .emoji-dialog-search-results a").tab("show")});var u=r.find(".emoji-tabs .tab-content");function s(h){var A=u[0].getBoundingClientRect(),T=Math.ceil(A.width*A.height/(40*40));h.find(".emoji-link img.defer").filter(function(P,I){if(P<=T)return!0;var j=I.getBoundingClientRect();return j.right>A.left&&j.left<A.right&&j.bottom>A.top&&j.top<A.bottom}).removeClass("defer").each(function(P,I){var j=I.getAttribute("data-src");I.setAttribute("src",j)})}var v=r.find(".emoji-tabs .nav-tabs a").click(function(h){h.preventDefault(),$(h.target).tab("show")}).on("show.bs.tab",function(h){s($(h.target.getAttribute("href")))}).eq(1);setTimeout(function(){return v.trigger("show.bs.tab")},10),u.on("scroll",function(){s(u.find(".tab-pane.active"))}),c.apply(u[0]);var E=function(){return e.dialogActions.close(r)};$(window).on(["action:composer.discard","action:composer.submit","action:composer.minimize","action:chat.minimize","action:chat.closed"].join(" "),E),r.find(".close").on("click",E),r.draggable&&r.draggable({handle:".top-bar"}),p(r)}).catch(function(o){console.error("Failed to initialize emoji dialog",o)})}e.init=S;function B(p,o){function r(s){if(s.hasClass("open")){e.dialogActions.close(s);return}s.off("click").on("click",".emoji-link",function(h){h.preventDefault();var A=h.currentTarget.name;o(h,A,s)});var v=p?p.getBoundingClientRect():{top:window.innerHeight/3,left:window.innerWidth/3},E={bottom:"auto",top:"auto",right:"auto",left:"auto"};v.top>440?E.top=v.top-400+"px":E.top=v.top+40+"px",v.left<window.innerWidth/2?E.left=v.left+40+"px":E.left=v.left-400+"px",s.css(E),e.dialogActions.open(s)}var u=$("#emoji-dialog");u.length?r(u):S(r)}e.toggle=B;function M(p,o,r,u){var s;u&&u.target?s=$(u.target):s=$(p).parents(".composer-container").find('[data-format="emoji-add-emoji"]'),s=s[0],B(s,function(v,E){var h=":"+E+": ",A=p.selectionStart,T=p.selectionEnd,P=T+h.length,I=A===T?P:A;a.insertIntoTextarea(p,h),a.updateTextareaSelection(p,I,P),$(p).trigger("input")})}e.toggleForInsert=M}.apply(R,w),b!==void 0&&(D.exports=b)},40646:(D,R,m)=>{var w,b;w=[m,R],b=function(y,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.init=e.strategy=e.search=e.table=e.buildEmoji=e.buster=e.base=void 0;var t=config.assetBaseUrl+"/plugins/nodebb-plugin-emoji";e.base=t;var l=config["cache-buster"];e.buster=l;function a(n,i){var g=":"+n.name+":",d=i?" defer":"";return n.image?`<img
      `+(i?"data-":"")+'src="'+t+"/emoji/"+n.pack+"/"+n.image+"?"+l+`"
      class="not-responsive emoji emoji-`+n.pack+" emoji--"+n.name+" "+d+`"
      title="`+g+`"
      alt="`+n.character+`"
    />`:`<span
    class="emoji-`+n.pack+" emoji--"+n.name+`"
    title="`+g+`"
  ><span>`+n.character+"</span></span>"}e.buildEmoji=a,e.strategy={match:/\B:([^\s\n:]+)$/,search:function(n,i){i(e.search(n.toLowerCase().replace(/[_-]/g,"")).slice(0,10))},index:1,replace:function(n){return":"+n.name+": "},template:function(n){return a(n)+" "+n.name},cache:!0};var c;function f(n){return c=c||Promise.all([new Promise(function(i,g){m.e(2645).then(function(){var d=[m(91919)];i.apply(null,d)}.bind(this)).catch(g.bind(this))}),new Promise(function(i,g){m.e(320).then(function(){var d=[m(78726)];i.apply(null,d)}.bind(this)).catch(g.bind(this))}),new Promise(function(i,g){Promise.all([m.e(6177),m.e(2526),m.e(5482),m.e(588)]).then(function(){var d=[m(45482)];i.apply(null,d)}.bind(this)).catch(g.bind(this))}),$.getJSON(t+"/emoji/table.json?"+l)]).then(function(i){var g=i[0],d=i[1],C=i[2],S=i[3];e.table=S;var B=Object.keys(e.table).map(function(o){var r=e.table[o];return{name:o,aliases:r.aliases,keywords:r.keywords,character:r.character,image:r.image,pack:r.pack}});function M(o,r){for(var u=r.length,s=0;s<u;s+=1)if(g(o,r[s]))return r[s];return null}function p(o){function r(u,s){var v=s*(1+d(o,u));return u.startsWith(o)?v-2:v}return B.filter(function(u){if(g(o,u.name))return u.score=r(u.name,1),!0;var s=M(o,u.aliases);if(s)return u.score=r(s,3),!0;var v=M(o,u.keywords);return v?(u.score=r(v,7),!0):!1}).sort(function(u,s){return u.score-s.score}).sort(function(u,s){var v=+u.name.startsWith(o),E=+s.name.startsWith(o);return E-v})}e.search=p,C.addButtonDispatch("emoji-add-emoji",function(o,r,u,s){new Promise(function(v,E){m.e(5400).then(function(){var h=[m(6721)];v.apply(null,h)}.bind(this)).catch(E.bind(this))}).then(function(v){var E=v.toggleForInsert;return E(o,r,u,s)})})}).catch(function(i){var g=Error("[[emoji:meta-load-failed]]");throw console.error(g),app.alertError(g),i}),n&&c.then(function(){return setTimeout(n,0)}),c}e.init=f}.apply(R,w),b!==void 0&&(D.exports=b)},75203:(D,R,m)=>{"use strict";var w;w=function(){const b={};return b.apply=function(y){$(y).on("mousewheel",function(e){const t=this.scrollTop,l=this.scrollHeight,a=Math.round(this.getBoundingClientRect().height);if(e.originalEvent.deltaY<0&&t===0||e.originalEvent.deltaY>0&&a+t>=l)return!1})},b}.call(R,m,R,D),w!==void 0&&(D.exports=w)}}]);
