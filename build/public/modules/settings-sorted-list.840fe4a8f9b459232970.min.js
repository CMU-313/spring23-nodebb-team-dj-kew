"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[7673],{66370:(j,w,u)=>{var A,g;A=[u(59006),u(31369),u(85233),u(62526)],g=function(v,T,c){let p;const h={types:["sorted-list"],use:function(){p=this},set:function(t,e){const s=t.attr("data-sorted-list");e[s]=[],t.find('[data-type="item"]').each(function(a,d){const i=$(d).attr("data-sorted-list-uuid"),o=p.helper.serializeForm($('[data-sorted-list-object="'+s+'"][data-sorted-list-uuid="'+i+'"]'));B(o),e[s].push(o)})},get:async(t,e)=>{const{listEl:s,key:a,formTpl:d,formValues:i}=await c.fire("filter:settings.sorted-list.load",{listEl:t.find('[data-type="list"]'),key:t.attr("data-sorted-list"),formTpl:t.attr("data-form-template"),formValues:{}}),o=await v.render(d,i);$('[data-sorted-list="'+a+'"] [data-type="add"]').on("click",function(){const f=T.confirm(o,function(l){l&&h.addItem(f.find("form").children(),t)});c.fire("action:settings.sorted-list.modal",{modal:f})});const m=t.parents("form").attr("data-socket-get"),r=ajaxify.data[m?e:"settings"][a];if(Array.isArray(r)&&typeof r[0]!="string"){const f=await Promise.all(r.map(async l=>{({item:l}=await c.fire("filter:settings.sorted-list.loadItem",{item:l}));const y=utils.generateUUID(),b=$(o).deserialize(l);return b.attr("data-sorted-list-uuid",y),b.attr("data-sorted-list-object",a),$("#content").append(b.hide()),{itemUUID:y,item:l}}));for(const{itemUUID:l,item:y}of f)await E(t,l,y),c.fire("action:settings.sorted-list.itemLoaded",{element:s.get(0)});c.fire("action:settings.sorted-list.loaded",{containerEl:t.get(0),listEl:s.get(0),hash:e,key:a})}s.sortable().addClass("pointer")},addItem:async(t,e)=>{const s=e.attr("data-sorted-list"),a=utils.generateUUID(),d=$('<form class="" data-sorted-list-uuid="'+a+'" data-sorted-list-object="'+s+'"></form>');d.append(t),$("#content").append(d.hide());let i=p.helper.serializeForm(d);({item:i}=await c.fire("filter:settings.sorted-list.loadItem",{item:i})),E(e,a,i)}};function I(t,e){t.find('[data-sorted-list-uuid="'+e+'"] [data-type="remove"]').on("click",function(){$('[data-sorted-list-uuid="'+e+'"]').remove()})}function C(t,e){const s=t.find('[data-type="list"]'),a=t.attr("data-sorted-list");$('[data-sorted-list-uuid="'+e+'"] [data-type="edit"]').on("click",function(){const i=$('[data-sorted-list-uuid="'+e+'"][data-sorted-list-object="'+a+'"]'),o=i.clone(!0).show();o.find("select").each((m,r)=>{r.value=i.find(`select#${r.id}`).val()});const n=T.confirm(o,async m=>{if(m){const r=$('<form class="" data-sorted-list-uuid="'+e+'" data-sorted-list-object="'+a+'"></form>');r.append(n.find("form").children()),$("#content").find('[data-sorted-list-uuid="'+e+'"][data-sorted-list-object="'+a+'"]').remove(),$("#content").append(r.hide());let f=p.helper.serializeForm(r);({item:f}=await c.fire("filter:settings.sorted-list.loadItem",{item:f})),B(f);const l=s.find('[data-sorted-list-uuid="'+e+'"]');E(t,e,f,l)}});c.fire("action:settings.sorted-list.modal",{modal:n})})}function E(t,e,s,a){const d=t.find('[data-type="list"]'),i=t.attr("data-item-template");return B(s),new Promise(o=>{app.parseAndTranslate(i,s,function(n){n=$(n),a?a.replaceWith(n):d.append(n),n.attr("data-sorted-list-uuid",e),I(t,e),C(t,e),c.fire("action:settings.sorted-list.parse",{itemHtml:n}),o()})})}function B(t){return Object.entries(t||{}).forEach(([e,s])=>{t[e]=typeof s=="string"?utils.stripHTMLTags(s,utils.stripTags):s})}return h}.apply(w,A),g!==void 0&&(j.exports=g)}}]);
