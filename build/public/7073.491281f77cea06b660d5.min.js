"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[7073],{7073:(E,b,d)=>{var v,p;v=[d(32230),d(66603),d(85233),d(7927)],p=function(k,O,h,x){const r={current:{}};r.init=function(e){if(!config.searchEnabled)return;e=e||{in:config.searchDefaultInQuick||"titles"};const i=$("#search-button"),s=$("#search-fields"),t=$("#search-fields input"),n=$("#quick-search-container");$("#search-form .advanced-search-link").off("mousedown").on("mousedown",function(){ajaxify.go("/search")}),$("#search-form").off("submit").on("submit",function(){t.blur()}),t.off("blur").on("blur",function(){setTimeout(function(){t.is(":focus")||(s.addClass("hidden"),i.removeClass("hidden"))},200)}),t.off("focus");const o={inputEl:t,resultEl:n};r.enableQuickSearch({searchOptions:e,searchElements:o}),i.off("click").on("click",function(l){return!config.loggedIn&&!app.user.privileges["search:content"]?(x.alert({message:"[[error:search-requires-login]]",timeout:3e3}),ajaxify.go("login"),!1):(l.stopPropagation(),r.showAndFocusInput(),!1)}),$("#search-form").off("submit").on("submit",function(){const l=$(this).find("input"),c=r.getSearchPreferences();return c.term=l.val(),c.in=e.in,h.fire("action:search.submit",{searchOptions:c,searchElements:o}),r.query(c,function(){l.val("")}),!1})},r.enableQuickSearch=function(e){if(!config.searchEnabled||!app.user.privileges["search:content"])return;const i=Object.assign({in:config.searchDefaultInQuick||"titles"},e.searchOptions),s=e.searchElements.resultEl,t=e.searchElements.inputEl;let n=t.val();const o=s.find(".filter-category");function l(){ajaxify.data.template.category&&ajaxify.data.cid&&k.translate("[[search:search-in-category, "+ajaxify.data.name+"]]",function(a){const f=$("<div></div>").html(a).text();o.find(".name").text(f)}),o.toggleClass("hidden",!(ajaxify.data.template.category&&ajaxify.data.cid))}function c(){e.searchOptions=Object.assign({},i),e.searchOptions.term=t.val(),l(),ajaxify.data.template.category&&ajaxify.data.cid&&o.find('input[type="checkbox"]').is(":checked")&&(e.searchOptions.categories=[ajaxify.data.cid],e.searchOptions.searchChildren=!0),s.removeClass("hidden").find(".quick-search-results-container").html(""),s.find(".loading-indicator").removeClass("hidden"),h.fire("action:search.quick.start",e),e.searchOptions.searchOnly=1,r.api(e.searchOptions,function(a){if(s.find(".loading-indicator").addClass("hidden"),!a.posts||e.hideOnNoMatches&&!a.posts.length)return s.addClass("hidden").find(".quick-search-results-container").html("");a.posts.forEach(function(f){const u=$("<div>"+f.content+"</div>").text(),j=t.val().toLowerCase().replace(/^in:topic-\d+/,""),g=Math.max(0,u.toLowerCase().indexOf(j)-40);f.snippet=utils.escapeHTML((g>0?"...":"")+u.slice(g,g+80)+(u.length-g>80?"...":""))}),app.parseAndTranslate("partials/quick-search-results",a,function(f){f.length&&f.find(".timeago").timeago(),s.toggleClass("hidden",!f.length||!t.is(":focus")).find(".quick-search-results-container").html(f.length?f:"");const u=s.find(".quick-search-results .quick-search-title, .quick-search-results .snippet");r.highlightMatches(e.searchOptions.term,u),h.fire("action:search.quick.complete",{data:a,options:e})})})}s.find('.filter-category input[type="checkbox"]').on("change",function(){t.focus(),c()}),t.off("keyup").on("keyup",utils.debounce(function(){if(t.val().length<3){s.addClass("hidden"),n=t.val();return}if(t.val()!==n){if(n=t.val(),!t.is(":focus"))return s.addClass("hidden");c()}},500));let y=!1;s.on("mousedown",function(){$(window).one("mouseup",function(){s.addClass("hidden")}),y=!0}),t.on("blur",function(){!t.is(":focus")&&!y&&!s.hasClass("hidden")&&s.addClass("hidden")});let C=!1;h.on("action:ajaxify.end",function(){ajaxify.isCold()||(C=!0)}),t.on("focus",function(){y=!1;const a=t.val();n=a,a&&s.find("#quick-search-results").children().length&&(l(),C?(c(),C=!1):s.removeClass("hidden"),t[0].setSelectionRange(a.startsWith("in:topic")?a.indexOf(" ")+1:0,a.length))}),t.off("refresh").on("refresh",function(){c()})},r.showAndFocusInput=function(){$("#search-fields").removeClass("hidden"),$("#search-button").addClass("hidden"),$("#search-fields input").focus()},r.query=function(e,i){i=i||function(){},ajaxify.go("search?"+m(e)),i()},r.api=function(e,i){const s=config.relative_path+"/api/search?"+m(e);e.searchOnly=void 0;const t=config.relative_path+"/search?"+m(e);$.get(s,function(n){n.url=t,i(n)})};function m(e){const i=e.in||"titles",s=e.by||"";let t=e.term.replace(/^[ ?#]*/,"");try{t=encodeURIComponent(t)}catch{return x.error("[[error:invalid-search-term]]")}const n={term:t,in:i};return e.matchWords&&(n.matchWords=e.matchWords),s&&s.length&&(i==="posts"||i==="titles"||i==="titlesposts")&&(n.by=s),e.categories&&e.categories.length&&(n.categories=e.categories,e.searchChildren&&(n.searchChildren=e.searchChildren)),e.hasTags&&e.hasTags.length&&(n.hasTags=e.hasTags),parseInt(e.replies,10)>0&&(n.replies=e.replies,n.repliesFilter=e.repliesFilter||"atleast"),e.timeRange&&(n.timeRange=e.timeRange,n.timeFilter=e.timeFilter||"newer"),e.sortBy&&(n.sortBy=e.sortBy,n.sortDirection=e.sortDirection),e.showAs&&(n.showAs=e.showAs),e.searchOnly&&(n.searchOnly=e.searchOnly),h.fire("action:search.createQueryString",{query:n,data:e}),decodeURIComponent($.param(n))}return r.getSearchPreferences=function(){try{return JSON.parse(O.getItem("search-preferences")||"{}")}catch{return{}}},r.highlightMatches=function(e,i){if(!e||!i.length)return;e=utils.escapeHTML(e.replace(/^"/,"").replace(/"$/,"").trim());const s=e.split(" ").map(function(n){return utils.escapeRegexChars(n)}).join("|"),t=new RegExp("("+s+")","gi");i.each(function(){const n=$(this),o=[];n.find("*").each(function(){$(this).after("<!-- "+o.length+" -->"),o.push($("<div></div>").append($(this)))}),n.html(n.html().replace(t,function(l,c){return'<strong class="search-match">'+c+"</strong>"})),o.forEach(function(l,c){n.html(n.html().replace("<!-- "+c+" -->",function(){return l.html()}))})}),$(".search-result-text").find("img:not(.not-responsive)").addClass("img-responsive")},r}.apply(b,v),p!==void 0&&(E.exports=p)}}]);
