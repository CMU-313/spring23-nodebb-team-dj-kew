"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[4654,6922],{34654:(g,b,f)=>{var c,l;c=[f(74344),f(31369),f(7927),f(47720)],l=function(p,d,s){const r={},m={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"};r.open=function(t){config.enablePostHistory&&p.get(`/posts/${t}/diffs`,{}).then(n=>{h(n).then(i=>{const e=d.dialog({title:"[[topic:diffs.title]]",message:i,size:"large"});if(!n.timestamps.length)return;const o=e.find("select"),a=e.find('button[data-action="restore"]'),u=e.find('button[data-action="delete"]'),E=e.find("ul.posts-list"),_=e.find(".number-of-diffs strong");o.on("change",function(){r.load(t,this.value,E),a.prop("disabled",n.timestamps.indexOf(this.value)===0),u.prop("disabled",n.timestamps.indexOf(this.value)===0)}),a.on("click",function(){r.restore(t,o.val(),e)}),u.on("click",function(){r.delete(t,o.val(),o,_)}),e.on("shown.bs.modal",function(){r.load(t,o.val(),E),a.prop("disabled",!0),u.prop("disabled",!0)})})}).catch(s.error)},r.load=function(t,n,i){config.enablePostHistory&&p.get(`/posts/${t}/diffs/${n}`,{}).then(e=>{e.deleted=!!parseInt(e.deleted,10),app.parseAndTranslate("partials/posts_list","posts",{posts:[e]},function(o){i.empty().append(o),i.find(".timeago").timeago()})}).catch(s.error)},r.restore=function(t,n,i){config.enablePostHistory&&p.put(`/posts/${t}/diffs/${n}`,{}).then(()=>{i.modal("hide"),s.success("[[topic:diffs.post-restored]]")}).catch(s.error)},r.delete=function(t,n,i,e){p.del(`/posts/${t}/diffs/${n}`).then(o=>{h(o,"diffs").then(a=>{i.empty().append(a),i.trigger("change");const u=i.find("option").length;e.text(u),s.success("[[topic:diffs.deleted]]")})}).catch(s.error)};function h(t,n){return new Promise(i=>{const e=[{diffs:t.revisions.map(function(o){const a=parseInt(o.timestamp,10);return{username:o.username,timestamp:a,pretty:new Date(a).toLocaleString(config.userLang.replace("_","-"),m)}}),numDiffs:t.timestamps.length,editable:t.editable,deletable:t.deletable},function(o){i(o)}];n&&e.unshift(n),app.parseAndTranslate("partials/modals/post_history",...e)})}return r}.apply(b,c),l!==void 0&&(g.exports=l)},47720:(g,b)=>{var f,c;f=[],c=function(){const l={};return l.wrapImagesInLinks=function(p){p.find('[component="post/content"] img:not(.emoji)').each(function(){const d=$(this);let s=d.attr("src")||"";const r=d.attr("alt")||"",m=/-resized(\.[\w]+)?$/;if(s==="about:blank")return;utils.isRelativeUrl(s)&&m.test(s)&&(s=s.replace(m,"$1"));const h=s.split(".").slice(1).pop(),t=r.split("/").pop(),n=t.split(".").slice(1).pop();d.parent().is("a")||d.wrap('<a href="'+s+'" '+(!h&&n?' download="'+t+'" ':"")+' target="_blank" rel="noopener">')})},l}.apply(b,f),c!==void 0&&(g.exports=c)}}]);
