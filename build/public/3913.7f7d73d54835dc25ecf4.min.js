"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[3913],{98166:(E,_,x)=>{var w,T;w=[x(59006),x(31369),x(7927)],T=function(p,f,y){const c={},i={timestamp:0,open:!1,edit:!1,posts:{}};let b=[],v;const t={el:null,icon:null,defaultText:"",activeText:""};let n,e;$(window).on("action:composer.activate",r),c.init=function(a,l){i.timestamp=0,i.posts=l,b=a[0].querySelectorAll(".display-scheduler"),v=a[0].querySelectorAll(".display-scheduler i"),t.el=a[0].querySelector(".composer-submit:not(.btn-sm)"),t.icon=t.el.querySelector("i"),t.defaultText=t.el.lastChild.textContent,t.activeText=t.el.getAttribute("data-text-variant"),v.forEach(m=>m.addEventListener("click",o))},c.getTimestamp=function(){return!c.isActive()||isNaN(i.timestamp)?0:i.timestamp},c.isActive=function(){return i.timestamp>0},c.isOpen=function(){return i.open},c.reset=function(){i.timestamp=0},c.onChangeCategory=function(a){k(a.privileges["topics:schedule"]),A(!1),c.reset()};async function o(){const a=await p.render("modals/topic-scheduler");f.dialog({message:a,title:"[[modules:composer.schedule-for]]",className:"topic-scheduler",onShown:s,onHidden:d,onEscape:!0,buttons:{cancel:{label:i.timestamp?"[[modules:composer.cancel-scheduling]]":"[[modules:bootbox.cancel]]",className:(i.timestamp?"btn-warning":"btn-default")+(i.edit?" hidden":""),callback:h},set:{label:"[[modules:composer.set-schedule-date]]",className:"btn-primary",callback:g}}})}function s(a){i.open=!0;const l=a.target.querySelector(".datetime-picker");n=l.querySelector('input[type="date"]'),e=l.querySelector('input[type="time"]'),u()}function d(){i.open=!1}function r(a,{post_uuid:l}){i.edit=!1;const m=i.posts[l];m&&m.isMain&&m.timestamp>Date.now()&&(i.timestamp=m.timestamp,i.edit=!0,A())}function u(){const a=new Date,l=new Date(a.getTime()-a.getTimezoneOffset()*6e4).toJSON();if(n.setAttribute("min",l.slice(0,10)),e.setAttribute("min",l.slice(11,-8)),c.isActive()){const m=new Date(i.timestamp-a.getTimezoneOffset()*6e4).toJSON();n.value=m.slice(0,10),e.value=m.slice(11,-8)}}function g(){const a=n.value&&e.value,l=new Date(`${n.value} ${e.value}`).getTime();if(!a||isNaN(l)||l<Date.now()){i.timestamp=0;const m=l<Date.now()?"[[error:scheduling-to-past]]":"[[error:invalid-schedule-date]]";return y.alert({type:"danger",timeout:3e3,title:"",alert_id:"post_error",message:m}),!1}i.timestamp||A(!0),i.timestamp=l}function h(){i.timestamp&&(A(!1),i.timestamp=0)}function A(a=!0){v.forEach(l=>l.classList.toggle("active",a)),t.icon&&(t.icon.classList.toggle("fa-check",!a),t.icon.classList.toggle("fa-clock-o",a)),t.el.lastChild.textContent=a?t.activeText:t.defaultText}function k(a){b.forEach(l=>l.classList.toggle("hidden",!a))}return c}.apply(_,w),T!==void 0&&(E.exports=T)},88186:(E,_,x)=>{var w,T;w=[x(7927)],T=function(p){var f={},y,c;f.init=function(t,n){var e=t.find(".tags");if(e.length){y=ajaxify.data.hasOwnProperty("minTags")?ajaxify.data.minTags:config.minimumTagsPerTopic,c=ajaxify.data.hasOwnProperty("maxTags")?ajaxify.data.maxTags:config.maximumTagsPerTopic,e.tagsinput({confirmKeys:[13,44],trimValue:!0});var o=t.find(".bootstrap-tagsinput input");i(t,n,ajaxify.data),app.loadJQueryUI(function(){o.autocomplete({delay:100,position:{my:"left bottom",at:"left top",collision:"flip"},appendTo:t.find(".bootstrap-tagsinput"),open:function(){$(this).autocomplete("widget").css("z-index",2e4)},source:function(r,u){socket.emit("topics.autocompleteTags",{query:r.term,cid:n.cid},function(g,h){if(g)return p.error(g);h&&u(h),$(".ui-autocomplete a").attr("data-ajaxify","false")})},select:function(){b(o)}}),v(n.tags,e),e.on("beforeItemAdd",function(r){var u=c&&c<=f.getTags(t.attr("data-uuid")).length,g=utils.cleanUpTag(r.item,config.maximumTagLength),h=g!==r.item;if(r.cancel=h||r.item.length<config.minimumTagLength||r.item.length>config.maximumTagLength||u,r.item.length<config.minimumTagLength)return p.error("[[error:tag-too-short, "+config.minimumTagLength+"]]");if(r.item.length>config.maximumTagLength)return p.error("[[error:tag-too-long, "+config.maximumTagLength+"]]");if(u)return p.error("[[error:too-many-tags, "+c+"]]");h&&e.tagsinput("add",g)});var s=!1,d=!1;e.on("itemRemoved",function(r){if(d){d=!1;return}r.item&&socket.emit("topics.canRemoveTag",{tag:r.item},function(u,g){if(u)return p.error(u);g||(p.error("[[error:cant-remove-system-tag]]"),s=!0,e.tagsinput("add",r.item))})}),e.on("itemAdded",function(r){if(s){s=!1;return}var u=n.hasOwnProperty("cid")?n.cid:ajaxify.data.cid;socket.emit("topics.isTagAllowed",{tag:r.item,cid:u||0},function(g,h){if(g)return p.error(g);if(!h)return d=!0,e.tagsinput("remove",r.item);$(window).trigger("action:tag.added",{cid:u,tagEl:e,tag:r.item}),o.length&&o.autocomplete("close")})})}),o.attr("tabIndex",e.attr("tabIndex")),o.on("blur",function(){b(o)}),$('[component="composer/tag/dropdown"]').on("click","li",function(){var s=$(this).attr("data-tag");return s&&v([s],e),!1})}},f.isEnoughTags=function(t){return f.getTags(t).length>=y},f.minTagCount=function(){return y},f.onChangeCategory=function(t,n,e,o){var s=t.find('[component="composer/tag/dropdown"]');s.length&&(i(t,n,o),s.toggleClass("hidden",!o.tagWhitelist||!o.tagWhitelist.length),o.tagWhitelist&&app.parseAndTranslate("composer","tagWhitelist",{tagWhitelist:o.tagWhitelist},function(d){s.find(".dropdown-menu").html(d)}))};function i(t,n,e){var o=t.find(".tags"),s=t.find(".bootstrap-tagsinput input");s.length&&(e.hasOwnProperty("minTags")&&(y=e.minTags),e.hasOwnProperty("maxTags")&&(c=e.maxTags),e.tagWhitelist&&e.tagWhitelist.length?(s.attr("readonly",""),s.attr("placeholder",""),o.tagsinput("items").slice().forEach(function(d){e.tagWhitelist.indexOf(d)===-1&&o.tagsinput("remove",d)})):(s.removeAttr("readonly"),s.attr("placeholder",t.find("input.tags").attr("placeholder"))),t.find(".tags-container").toggleClass("hidden",e.privileges&&e.privileges.hasOwnProperty("topics:tag")&&!e.privileges["topics:tag"]||c===0&&!n&&!n.tags&&!n.tags.length),e.privileges&&e.privileges.hasOwnProperty("topics:tag")&&!e.privileges["topics:tag"]&&o.tagsinput("removeAll"),$(window).trigger("action:tag.toggleInput",{postContainer:t,tagWhitelist:e.tagWhitelist,tagsInput:s}))}function b(t){var n=jQuery.Event("keypress");n.which=13,n.keyCode=13,setTimeout(function(){t.trigger(n)},100)}function v(t,n){if(t&&t.length)for(var e=0;e<t.length;++e)n.tagsinput("add",t[e])}return f.getTags=function(t){return $('.composer[data-uuid="'+t+'"] .tags').tagsinput("items")},f}.apply(_,w),T!==void 0&&(E.exports=T)}}]);
